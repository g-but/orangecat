64590cd4f9758ebd03764e1161c7809a
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.search = search;
exports.getTrending = getTrending;
exports.clearSearchCache = clearSearchCache;
exports.getSearchSuggestions = getSearchSuggestions;
const client_1 = __importDefault(require("@/services/supabase/client"));
const logger_1 = require("@/utils/logger");
const searchCache = new Map();
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes
const MAX_CACHE_SIZE = 100; // Maximum number of cached entries
const MAX_CACHE_MEMORY = 10 * 1024 * 1024; // 10MB max cache size
// Cache cleanup for memory management
function cleanupCache() {
    if (searchCache.size <= MAX_CACHE_SIZE)
        return;
    // Remove oldest entries
    const entries = Array.from(searchCache.entries())
        .sort((a, b) => a[1].timestamp - b[1].timestamp);
    // Remove oldest 20% of entries
    const toRemove = Math.floor(entries.length * 0.2);
    for (let i = 0; i < toRemove; i++) {
        searchCache.delete(entries[i][0]);
    }
}
// Generate optimized cache key with shorter hash for better performance
function generateCacheKey(options) {
    var _a;
    const keyData = {
        q: (_a = options.query) === null || _a === void 0 ? void 0 : _a.toLowerCase().trim(),
        t: options.type,
        s: options.sortBy,
        f: options.filters,
        l: options.limit,
        o: options.offset
    };
    return JSON.stringify(keyData);
}
// Enhanced cache with hit tracking
function getCachedResult(key) {
    const cached = searchCache.get(key);
    if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {
        // Update hit count for cache analytics
        cached.hitCount++;
        return cached.data;
    }
    // Remove expired entry
    if (cached) {
        searchCache.delete(key);
    }
    return null;
}
// Enhanced cache storage with size tracking
function setCachedResult(key, data) {
    const size = JSON.stringify(data).length;
    searchCache.set(key, {
        data,
        timestamp: Date.now(),
        hitCount: 0,
        size
    });
    cleanupCache();
}
// ==================== OPTIMIZED DATABASE QUERIES ====================
// Calculate relevance score (moved up for better optimization)
function calculateRelevanceScore(result, query) {
    var _a, _b, _c, _d, _e, _f, _g, _h;
    if (!query)
        return 0;
    const lowerQuery = query.toLowerCase();
    let score = 0;
    if (result.type === 'profile') {
        const profile = result.data;
        // Exact username match gets highest score
        if (((_a = profile.username) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === lowerQuery)
            score += 100;
        else if ((_b = profile.username) === null || _b === void 0 ? void 0 : _b.toLowerCase().includes(lowerQuery))
            score += 50;
        // Display name matches
        if (((_c = profile.display_name) === null || _c === void 0 ? void 0 : _c.toLowerCase()) === lowerQuery)
            score += 80;
        else if ((_d = profile.display_name) === null || _d === void 0 ? void 0 : _d.toLowerCase().includes(lowerQuery))
            score += 40;
        // Bio matches
        if ((_e = profile.bio) === null || _e === void 0 ? void 0 : _e.toLowerCase().includes(lowerQuery))
            score += 20;
        // Boost for profiles with avatars (more complete profiles)
        if (profile.avatar_url)
            score += 5;
    }
    else {
        const campaign = result.data;
        // Title matches get high score
        if (campaign.title.toLowerCase() === lowerQuery)
            score += 100;
        else if (campaign.title.toLowerCase().includes(lowerQuery))
            score += 60;
        // Description matches
        if ((_f = campaign.description) === null || _f === void 0 ? void 0 : _f.toLowerCase().includes(lowerQuery))
            score += 30;
        // Category matches
        if ((_g = campaign.category) === null || _g === void 0 ? void 0 : _g.toLowerCase().includes(lowerQuery))
            score += 25;
        // Tag matches
        if ((_h = campaign.tags) === null || _h === void 0 ? void 0 : _h.some(tag => tag.toLowerCase().includes(lowerQuery)))
            score += 20;
        // Boost for active campaigns
        if (campaign.is_active)
            score += 10;
        // Boost for campaigns with funding
        if (campaign.total_funding > 0)
            score += 5;
        // Boost for campaigns with images
        if (campaign.featured_image_url)
            score += 3;
    }
    return score;
}
// Optimized profile search with better indexing usage
async function searchProfiles(query, limit = 20, offset = 0) {
    // Start with minimal columns for better performance
    let profileQuery = client_1.default
        .from('profiles')
        .select('id, username, display_name, bio, avatar_url, created_at');
    if (query) {
        // OPTIMIZATION: Use tsvector for full-text search when available
        // For now, optimize ILIKE queries with proper ordering
        const sanitizedQuery = query.replace(/[%_]/g, '\\$&'); // Escape SQL wildcards
        profileQuery = profileQuery.or(`username.ilike.%${sanitizedQuery}%,display_name.ilike.%${sanitizedQuery}%,bio.ilike.%${sanitizedQuery}%`);
    }
    // OPTIMIZATION: Use created_at index for better performance
    const { data: profiles, error } = await profileQuery
        .order('created_at', { ascending: false })
        .range(offset, offset + limit - 1);
    if (error)
        throw error;
    return profiles || [];
}
// Optimized campaign search with better query structure
async function searchFundingPages(query, filters, limit = 20, offset = 0) {
    // OPTIMIZATION: Only select necessary columns to reduce payload
    let campaignQuery = client_1.default
        .from('funding_pages')
        .select(`
      id, user_id, title, description, category, tags, goal_amount, 
      total_funding, contributor_count, is_active, is_public, 
      featured_image_url, created_at, slug,
      profiles!inner(username, display_name, avatar_url)
    `)
        .eq('is_public', true); // OPTIMIZATION: This should use an index
    if (query) {
        const sanitizedQuery = query.replace(/[%_]/g, '\\$&');
        campaignQuery = campaignQuery.or(`title.ilike.%${sanitizedQuery}%,description.ilike.%${sanitizedQuery}%,category.ilike.%${sanitizedQuery}%`);
    }
    // OPTIMIZATION: Apply most selective filters first
    if (filters) {
        // Most selective filters first for better query performance
        if (filters.isActive !== undefined) {
            campaignQuery = campaignQuery.eq('is_active', filters.isActive);
        }
        if (filters.categories && filters.categories.length > 0) {
            campaignQuery = campaignQuery.in('category', filters.categories);
        }
        if (filters.hasGoal) {
            campaignQuery = campaignQuery.not('goal_amount', 'is', null);
        }
        if (filters.minFunding !== undefined) {
            campaignQuery = campaignQuery.gte('total_funding', filters.minFunding);
        }
        if (filters.maxFunding !== undefined) {
            campaignQuery = campaignQuery.lte('total_funding', filters.maxFunding);
        }
        if (filters.dateRange) {
            campaignQuery = campaignQuery
                .gte('created_at', filters.dateRange.start)
                .lte('created_at', filters.dateRange.end);
        }
    }
    // OPTIMIZATION: Use index-friendly ordering
    const { data: rawCampaigns, error } = await campaignQuery
        .order('created_at', { ascending: false })
        .range(offset, offset + limit - 1);
    if (error)
        throw error;
    // OPTIMIZATION: Minimize data transformation overhead
    const campaigns = (rawCampaigns || []).map(campaign => {
        var _a;
        return (Object.assign(Object.assign({}, campaign), { profiles: ((_a = campaign.profiles) === null || _a === void 0 ? void 0 : _a[0]) || undefined }));
    });
    return campaigns;
}
// OPTIMIZATION: Cached facets with smarter update strategy
let facetsCache = null;
const FACETS_CACHE_DURATION = 10 * 60 * 1000; // 10 minutes for facets
async function getSearchFacets() {
    var _a;
    // Return cached facets if available
    if (facetsCache && Date.now() - facetsCache.timestamp < FACETS_CACHE_DURATION) {
        return facetsCache.data;
    }
    try {
        // OPTIMIZATION: Use Promise.all for parallel queries
        const [categoryData, profilesResult, campaignsResult] = await Promise.all([
            // Only get categories for active public campaigns
            client_1.default
                .from('funding_pages')
                .select('category')
                .eq('is_public', true)
                .eq('is_active', true) // OPTIMIZATION: More selective filter
                .not('category', 'is', null),
            // Use count queries with head:true for better performance
            client_1.default.from('profiles').select('id', { count: 'exact', head: true }),
            client_1.default.from('funding_pages').select('id', { count: 'exact', head: true }).eq('is_public', true)
        ]);
        if (categoryData.error)
            throw categoryData.error;
        // OPTIMIZATION: Use Map for O(1) lookups instead of repeated array operations
        const categoryMap = new Map();
        (_a = categoryData.data) === null || _a === void 0 ? void 0 : _a.forEach(item => {
            if (item.category) {
                categoryMap.set(item.category, (categoryMap.get(item.category) || 0) + 1);
            }
        });
        const categories = Array.from(categoryMap.entries())
            .map(([name, count]) => ({ name, count }))
            .sort((a, b) => b.count - a.count);
        const facets = {
            categories,
            totalProfiles: profilesResult.count || 0,
            totalCampaigns: campaignsResult.count || 0
        };
        // Cache the facets
        facetsCache = {
            data: facets,
            timestamp: Date.now()
        };
        return facets;
    }
    catch (error) {
        logger_1.logger.error('Error getting search facets', error, 'Search');
        return {
            categories: [],
            totalProfiles: 0,
            totalCampaigns: 0
        };
    }
}
// Sort results (optimized for performance)
function sortResults(results, sortBy, query) {
    // OPTIMIZATION: Avoid array copying when possible
    if (results.length <= 1)
        return results;
    return [...results].sort((a, b) => {
        var _a, _b;
        switch (sortBy) {
            case 'relevance':
                if (query) {
                    const scoreA = (_a = a.relevanceScore) !== null && _a !== void 0 ? _a : calculateRelevanceScore(a, query);
                    const scoreB = (_b = b.relevanceScore) !== null && _b !== void 0 ? _b : calculateRelevanceScore(b, query);
                    if (scoreA !== scoreB)
                        return scoreB - scoreA;
                }
                // Fall back to recent for same relevance scores
                return new Date(b.data.created_at).getTime() - new Date(a.data.created_at).getTime();
            case 'recent':
                return new Date(b.data.created_at).getTime() - new Date(a.data.created_at).getTime();
            case 'popular':
                if (a.type === 'campaign' && b.type === 'campaign') {
                    const campaignA = a.data;
                    const campaignB = b.data;
                    return campaignB.contributor_count - campaignA.contributor_count;
                }
                // Profiles don't have popularity metric, fall back to recent
                return new Date(b.data.created_at).getTime() - new Date(a.data.created_at).getTime();
            case 'funding':
                if (a.type === 'campaign' && b.type === 'campaign') {
                    const campaignA = a.data;
                    const campaignB = b.data;
                    return campaignB.total_funding - campaignA.total_funding;
                }
                return new Date(b.data.created_at).getTime() - new Date(a.data.created_at).getTime();
            default:
                return 0;
        }
    });
}
// OPTIMIZATION: Main search function with improved performance
async function search(options) {
    const { query, type, sortBy, filters, limit = 20, offset = 0 } = options;
    // Check cache first with optimized cache key
    const cacheKey = generateCacheKey(options);
    const cachedResult = getCachedResult(cacheKey);
    if (cachedResult) {
        return cachedResult;
    }
    try {
        const results = [];
        let totalCount = 0;
        // OPTIMIZATION: Use Promise.all for parallel searches when type is 'all'
        if (type === 'all') {
            const [profiles, campaigns] = await Promise.all([
                searchProfiles(query, limit, offset).catch(error => {
                    logger_1.logger.warn('Error searching profiles', error, 'Search');
                    return [];
                }),
                searchFundingPages(query, filters, limit, offset).catch(error => {
                    logger_1.logger.warn('Error searching campaigns', error, 'Search');
                    return [];
                })
            ]);
            // Process profiles
            profiles.forEach(profile => {
                const result = { type: 'profile', data: profile };
                if (query) {
                    result.relevanceScore = calculateRelevanceScore(result, query);
                }
                results.push(result);
            });
            // Process campaigns
            campaigns.forEach(campaign => {
                const result = { type: 'campaign', data: campaign };
                if (query) {
                    result.relevanceScore = calculateRelevanceScore(result, query);
                }
                results.push(result);
            });
        }
        else {
            // Single type searches
            if (type === 'profiles') {
                try {
                    const profiles = await searchProfiles(query, limit, offset);
                    profiles.forEach(profile => {
                        const result = { type: 'profile', data: profile };
                        if (query) {
                            result.relevanceScore = calculateRelevanceScore(result, query);
                        }
                        results.push(result);
                    });
                }
                catch (profileError) {
                    logger_1.logger.warn('Error searching profiles', profileError, 'Search');
                }
            }
            if (type === 'campaigns') {
                try {
                    const campaigns = await searchFundingPages(query, filters, limit, offset);
                    campaigns.forEach(campaign => {
                        const result = { type: 'campaign', data: campaign };
                        if (query) {
                            result.relevanceScore = calculateRelevanceScore(result, query);
                        }
                        results.push(result);
                    });
                }
                catch (campaignError) {
                    logger_1.logger.warn('Error searching campaigns', campaignError, 'Search');
                }
            }
        }
        // Sort results
        const sortedResults = sortResults(results, sortBy, query);
        // Apply pagination after sorting (for mixed results)
        const paginatedResults = sortedResults.slice(offset, offset + limit);
        totalCount = sortedResults.length;
        // Get facets only if needed (not for every search)
        let facets;
        if (type === 'all' || type === 'campaigns') {
            try {
                facets = await getSearchFacets();
            }
            catch (facetsError) {
                logger_1.logger.warn('Error getting facets', facetsError, 'Search');
            }
        }
        const response = {
            results: paginatedResults,
            totalCount,
            hasMore: totalCount > offset + limit,
            facets
        };
        // Cache the result
        setCachedResult(cacheKey, response);
        return response;
    }
    catch (error) {
        logger_1.logger.error('Search error', error, 'Search');
        // Return empty results on error
        const errorResponse = {
            results: [],
            totalCount: 0,
            hasMore: false
        };
        return errorResponse;
    }
}
// ==================== REMAINING FUNCTIONS (OPTIMIZED) ====================
// Optimized trending function with better performance
async function getTrending() {
    try {
        const results = [];
        // OPTIMIZATION: Use Promise.all for parallel queries
        const [campaignsData, profilesData] = await Promise.all([
            // Get popular campaigns (by contributor count)
            client_1.default
                .from('funding_pages')
                .select(`
        id, user_id, title, description, category, tags, goal_amount, 
        total_funding, contributor_count, is_active, is_public, 
        featured_image_url, created_at, slug,
        profiles!inner(username, display_name, avatar_url)
      `)
                .eq('is_public', true)
                .eq('is_active', true)
                .order('contributor_count', { ascending: false })
                .limit(10),
            // Get recent profiles
            client_1.default
                .from('profiles')
                .select('id, username, display_name, bio, avatar_url, created_at')
                .order('created_at', { ascending: false })
                .limit(10)
        ]);
        // Process campaigns
        if (!campaignsData.error && campaignsData.data) {
            const popularCampaigns = campaignsData.data.map(campaign => {
                var _a;
                return (Object.assign(Object.assign({}, campaign), { profiles: ((_a = campaign.profiles) === null || _a === void 0 ? void 0 : _a[0]) || undefined }));
            });
            popularCampaigns.forEach(campaign => {
                results.push({ type: 'campaign', data: campaign });
            });
        }
        else if (campaignsData.error) {
            logger_1.logger.warn('Error fetching campaigns for trending', { error: campaignsData.error.message }, 'Search');
        }
        // Process profiles
        if (!profilesData.error && profilesData.data) {
            profilesData.data.forEach(profile => {
                results.push({ type: 'profile', data: profile });
            });
        }
        else if (profilesData.error) {
            logger_1.logger.warn('Error fetching profiles for trending', { error: profilesData.error.message }, 'Search');
        }
        return {
            results,
            totalCount: results.length,
            hasMore: false // Trending is always a fixed set
        };
    }
    catch (error) {
        logger_1.logger.error('Error getting trending content', error, 'Search');
        return {
            results: [],
            totalCount: 0,
            hasMore: false
        };
    }
}
// Clear cache with cleanup
function clearSearchCache() {
    searchCache.clear();
    facetsCache = null;
}
// Optimized search suggestions
async function getSearchSuggestions(query, limit = 5) {
    if (!query || query.length < 2)
        return [];
    try {
        const sanitizedQuery = query.replace(/[%_]/g, '\\$&');
        // OPTIMIZATION: Use Promise.all for parallel suggestion queries
        const [profileSuggestions, campaignSuggestions] = await Promise.all([
            client_1.default
                .from('profiles')
                .select('username, display_name')
                .or(`username.ilike.%${sanitizedQuery}%,display_name.ilike.%${sanitizedQuery}%`)
                .not('username', 'is', null)
                .limit(limit),
            client_1.default
                .from('funding_pages')
                .select('title, category')
                .or(`title.ilike.%${sanitizedQuery}%,category.ilike.%${sanitizedQuery}%`)
                .eq('is_public', true)
                .limit(limit)
        ]);
        const suggestions = new Set();
        // Add profile suggestions
        if (!profileSuggestions.error && profileSuggestions.data) {
            profileSuggestions.data.forEach(profile => {
                if (profile.username)
                    suggestions.add(profile.username);
                if (profile.display_name)
                    suggestions.add(profile.display_name);
            });
        }
        // Add campaign suggestions
        if (!campaignSuggestions.error && campaignSuggestions.data) {
            campaignSuggestions.data.forEach(campaign => {
                if (campaign.title)
                    suggestions.add(campaign.title);
                if (campaign.category)
                    suggestions.add(campaign.category);
            });
        }
        return Array.from(suggestions).slice(0, limit);
    }
    catch (error) {
        logger_1.logger.error('Error getting search suggestions', error, 'Search');
        return [];
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzFDLElBQUksUUFBUSxDQUFDLEtBQUs7b0JBQUUsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUE7Z0JBQ25ELElBQUksUUFBUSxDQUFDLFFBQVE7b0JBQUUsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDM0QsQ0FBQyxDQUFDLENBQUE7UUFDSixDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUE7SUFDaEQsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixlQUFNLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtRQUNqRSxPQUFPLEVBQUUsQ0FBQTtJQUNYLENBQUM7QUFDSCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2cvZGV2L29yYW5nZWNhdC9zcmMvc2VydmljZXMvc2VhcmNoLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzdXBhYmFzZSBmcm9tICdAL3NlcnZpY2VzL3N1cGFiYXNlL2NsaWVudCdcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvdXRpbHMvbG9nZ2VyJ1xuXG4vLyBTZWFyY2ggaW50ZXJmYWNlc1xuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hQcm9maWxlIHtcbiAgaWQ6IHN0cmluZ1xuICB1c2VybmFtZTogc3RyaW5nIHwgbnVsbFxuICBkaXNwbGF5X25hbWU6IHN0cmluZyB8IG51bGxcbiAgYmlvOiBzdHJpbmcgfCBudWxsXG4gIGF2YXRhcl91cmw6IHN0cmluZyB8IG51bGxcbiAgY3JlYXRlZF9hdDogc3RyaW5nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoRnVuZGluZ1BhZ2Uge1xuICBpZDogc3RyaW5nXG4gIHVzZXJfaWQ6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNhdGVnb3J5OiBzdHJpbmcgfCBudWxsXG4gIHRhZ3M6IHN0cmluZ1tdIHwgbnVsbFxuICBnb2FsX2Ftb3VudDogbnVtYmVyIHwgbnVsbFxuICB0b3RhbF9mdW5kaW5nOiBudW1iZXJcbiAgY29udHJpYnV0b3JfY291bnQ6IG51bWJlclxuICBpc19hY3RpdmU6IGJvb2xlYW5cbiAgaXNfcHVibGljOiBib29sZWFuXG4gIGZlYXR1cmVkX2ltYWdlX3VybDogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkX2F0OiBzdHJpbmdcbiAgc2x1Zzogc3RyaW5nIHwgbnVsbFxuICBwcm9maWxlcz86IHtcbiAgICB1c2VybmFtZTogc3RyaW5nIHwgbnVsbFxuICAgIGRpc3BsYXlfbmFtZTogc3RyaW5nIHwgbnVsbFxuICAgIGF2YXRhcl91cmw6IHN0cmluZyB8IG51bGxcbiAgfVxufVxuXG4vLyBSYXcgdHlwZSBmcm9tIFN1cGFiYXNlIChiZWZvcmUgdHJhbnNmb3JtYXRpb24pXG5pbnRlcmZhY2UgUmF3U2VhcmNoRnVuZGluZ1BhZ2Uge1xuICBpZDogc3RyaW5nXG4gIHVzZXJfaWQ6IHN0cmluZ1xuICB0aXRsZTogc3RyaW5nXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsXG4gIGNhdGVnb3J5OiBzdHJpbmcgfCBudWxsXG4gIHRhZ3M6IHN0cmluZ1tdIHwgbnVsbFxuICBnb2FsX2Ftb3VudDogbnVtYmVyIHwgbnVsbFxuICB0b3RhbF9mdW5kaW5nOiBudW1iZXJcbiAgY29udHJpYnV0b3JfY291bnQ6IG51bWJlclxuICBpc19hY3RpdmU6IGJvb2xlYW5cbiAgaXNfcHVibGljOiBib29sZWFuXG4gIGZlYXR1cmVkX2ltYWdlX3VybDogc3RyaW5nIHwgbnVsbFxuICBjcmVhdGVkX2F0OiBzdHJpbmdcbiAgc2x1Zzogc3RyaW5nIHwgbnVsbFxuICBwcm9maWxlczogQXJyYXk8e1xuICAgIHVzZXJuYW1lOiBzdHJpbmcgfCBudWxsXG4gICAgZGlzcGxheV9uYW1lOiBzdHJpbmcgfCBudWxsXG4gICAgYXZhdGFyX3VybDogc3RyaW5nIHwgbnVsbFxuICB9PlxufVxuXG5leHBvcnQgdHlwZSBTZWFyY2hSZXN1bHQgPSB7XG4gIHR5cGU6ICdwcm9maWxlJyB8ICdjYW1wYWlnbidcbiAgZGF0YTogU2VhcmNoUHJvZmlsZSB8IFNlYXJjaEZ1bmRpbmdQYWdlXG4gIHJlbGV2YW5jZVNjb3JlPzogbnVtYmVyXG59XG5cbmV4cG9ydCB0eXBlIFNlYXJjaFR5cGUgPSAnYWxsJyB8ICdwcm9maWxlcycgfCAnY2FtcGFpZ25zJ1xuZXhwb3J0IHR5cGUgU29ydE9wdGlvbiA9ICdyZWxldmFuY2UnIHwgJ3JlY2VudCcgfCAncG9wdWxhcicgfCAnZnVuZGluZydcblxuZXhwb3J0IGludGVyZmFjZSBTZWFyY2hGaWx0ZXJzIHtcbiAgY2F0ZWdvcmllcz86IHN0cmluZ1tdXG4gIGlzQWN0aXZlPzogYm9vbGVhblxuICBoYXNHb2FsPzogYm9vbGVhblxuICBtaW5GdW5kaW5nPzogbnVtYmVyXG4gIG1heEZ1bmRpbmc/OiBudW1iZXJcbiAgZGF0ZVJhbmdlPzoge1xuICAgIHN0YXJ0OiBzdHJpbmdcbiAgICBlbmQ6IHN0cmluZ1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoT3B0aW9ucyB7XG4gIHF1ZXJ5Pzogc3RyaW5nXG4gIHR5cGU6IFNlYXJjaFR5cGVcbiAgc29ydEJ5OiBTb3J0T3B0aW9uXG4gIGZpbHRlcnM/OiBTZWFyY2hGaWx0ZXJzXG4gIGxpbWl0PzogbnVtYmVyXG4gIG9mZnNldD86IG51bWJlclxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlYXJjaFJlc3BvbnNlIHtcbiAgcmVzdWx0czogU2VhcmNoUmVzdWx0W11cbiAgdG90YWxDb3VudDogbnVtYmVyXG4gIGhhc01vcmU6IGJvb2xlYW5cbiAgZmFjZXRzPzoge1xuICAgIGNhdGVnb3JpZXM6IEFycmF5PHsgbmFtZTogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+XG4gICAgdG90YWxQcm9maWxlczogbnVtYmVyXG4gICAgdG90YWxDYW1wYWlnbnM6IG51bWJlclxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09IFBFUkZPUk1BTkNFIE9QVElNSVpBVElPTlMgPT09PT09PT09PT09PT09PT09PT1cblxuLy8gRW5oYW5jZWQgY2FjaGUgd2l0aCBiZXR0ZXIgcGVyZm9ybWFuY2UgY2hhcmFjdGVyaXN0aWNzXG5pbnRlcmZhY2UgQ2FjaGVFbnRyeSB7XG4gIGRhdGE6IFNlYXJjaFJlc3BvbnNlXG4gIHRpbWVzdGFtcDogbnVtYmVyXG4gIGhpdENvdW50OiBudW1iZXJcbiAgc2l6ZTogbnVtYmVyXG59XG5cbmNvbnN0IHNlYXJjaENhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk+KClcbmNvbnN0IENBQ0hFX0RVUkFUSU9OID0gNSAqIDYwICogMTAwMCAvLyA1IG1pbnV0ZXNcbmNvbnN0IE1BWF9DQUNIRV9TSVpFID0gMTAwIC8vIE1heGltdW0gbnVtYmVyIG9mIGNhY2hlZCBlbnRyaWVzXG5jb25zdCBNQVhfQ0FDSEVfTUVNT1JZID0gMTAgKiAxMDI0ICogMTAyNCAvLyAxME1CIG1heCBjYWNoZSBzaXplXG5cbi8vIENhY2hlIGNsZWFudXAgZm9yIG1lbW9yeSBtYW5hZ2VtZW50XG5mdW5jdGlvbiBjbGVhbnVwQ2FjaGUoKTogdm9pZCB7XG4gIGlmIChzZWFyY2hDYWNoZS5zaXplIDw9IE1BWF9DQUNIRV9TSVpFKSByZXR1cm5cbiAgXG4gIC8vIFJlbW92ZSBvbGRlc3QgZW50cmllc1xuICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShzZWFyY2hDYWNoZS5lbnRyaWVzKCkpXG4gICAgLnNvcnQoKGEsIGIpID0+IGFbMV0udGltZXN0YW1wIC0gYlsxXS50aW1lc3RhbXApXG4gIFxuICAvLyBSZW1vdmUgb2xkZXN0IDIwJSBvZiBlbnRyaWVzXG4gIGNvbnN0IHRvUmVtb3ZlID0gTWF0aC5mbG9vcihlbnRyaWVzLmxlbmd0aCAqIDAuMilcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b1JlbW92ZTsgaSsrKSB7XG4gICAgc2VhcmNoQ2FjaGUuZGVsZXRlKGVudHJpZXNbaV1bMF0pXG4gIH1cbn1cblxuLy8gR2VuZXJhdGUgb3B0aW1pemVkIGNhY2hlIGtleSB3aXRoIHNob3J0ZXIgaGFzaCBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG5mdW5jdGlvbiBnZW5lcmF0ZUNhY2hlS2V5KG9wdGlvbnM6IFNlYXJjaE9wdGlvbnMpOiBzdHJpbmcge1xuICBjb25zdCBrZXlEYXRhID0ge1xuICAgIHE6IG9wdGlvbnMucXVlcnk/LnRvTG93ZXJDYXNlKCkudHJpbSgpLFxuICAgIHQ6IG9wdGlvbnMudHlwZSxcbiAgICBzOiBvcHRpb25zLnNvcnRCeSxcbiAgICBmOiBvcHRpb25zLmZpbHRlcnMsXG4gICAgbDogb3B0aW9ucy5saW1pdCxcbiAgICBvOiBvcHRpb25zLm9mZnNldFxuICB9XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShrZXlEYXRhKVxufVxuXG4vLyBFbmhhbmNlZCBjYWNoZSB3aXRoIGhpdCB0cmFja2luZ1xuZnVuY3Rpb24gZ2V0Q2FjaGVkUmVzdWx0KGtleTogc3RyaW5nKTogU2VhcmNoUmVzcG9uc2UgfCBudWxsIHtcbiAgY29uc3QgY2FjaGVkID0gc2VhcmNoQ2FjaGUuZ2V0KGtleSlcbiAgaWYgKGNhY2hlZCAmJiBEYXRlLm5vdygpIC0gY2FjaGVkLnRpbWVzdGFtcCA8IENBQ0hFX0RVUkFUSU9OKSB7XG4gICAgLy8gVXBkYXRlIGhpdCBjb3VudCBmb3IgY2FjaGUgYW5hbHl0aWNzXG4gICAgY2FjaGVkLmhpdENvdW50KytcbiAgICByZXR1cm4gY2FjaGVkLmRhdGFcbiAgfVxuICBcbiAgLy8gUmVtb3ZlIGV4cGlyZWQgZW50cnlcbiAgaWYgKGNhY2hlZCkge1xuICAgIHNlYXJjaENhY2hlLmRlbGV0ZShrZXkpXG4gIH1cbiAgXG4gIHJldHVybiBudWxsXG59XG5cbi8vIEVuaGFuY2VkIGNhY2hlIHN0b3JhZ2Ugd2l0aCBzaXplIHRyYWNraW5nXG5mdW5jdGlvbiBzZXRDYWNoZWRSZXN1bHQoa2V5OiBzdHJpbmcsIGRhdGE6IFNlYXJjaFJlc3BvbnNlKTogdm9pZCB7XG4gIGNvbnN0IHNpemUgPSBKU09OLnN0cmluZ2lmeShkYXRhKS5sZW5ndGhcbiAgXG4gIHNlYXJjaENhY2hlLnNldChrZXksIHtcbiAgICBkYXRhLFxuICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICBoaXRDb3VudDogMCxcbiAgICBzaXplXG4gIH0pXG4gIFxuICBjbGVhbnVwQ2FjaGUoKVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PSBPUFRJTUlaRUQgREFUQUJBU0UgUVVFUklFUyA9PT09PT09PT09PT09PT09PT09PVxuXG4vLyBDYWxjdWxhdGUgcmVsZXZhbmNlIHNjb3JlIChtb3ZlZCB1cCBmb3IgYmV0dGVyIG9wdGltaXphdGlvbilcbmZ1bmN0aW9uIGNhbGN1bGF0ZVJlbGV2YW5jZVNjb3JlKHJlc3VsdDogU2VhcmNoUmVzdWx0LCBxdWVyeTogc3RyaW5nKTogbnVtYmVyIHtcbiAgaWYgKCFxdWVyeSkgcmV0dXJuIDBcbiAgXG4gIGNvbnN0IGxvd2VyUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpXG4gIGxldCBzY29yZSA9IDBcbiAgXG4gIGlmIChyZXN1bHQudHlwZSA9PT0gJ3Byb2ZpbGUnKSB7XG4gICAgY29uc3QgcHJvZmlsZSA9IHJlc3VsdC5kYXRhIGFzIFNlYXJjaFByb2ZpbGVcbiAgICBcbiAgICAvLyBFeGFjdCB1c2VybmFtZSBtYXRjaCBnZXRzIGhpZ2hlc3Qgc2NvcmVcbiAgICBpZiAocHJvZmlsZS51c2VybmFtZT8udG9Mb3dlckNhc2UoKSA9PT0gbG93ZXJRdWVyeSkgc2NvcmUgKz0gMTAwXG4gICAgZWxzZSBpZiAocHJvZmlsZS51c2VybmFtZT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlclF1ZXJ5KSkgc2NvcmUgKz0gNTBcbiAgICBcbiAgICAvLyBEaXNwbGF5IG5hbWUgbWF0Y2hlc1xuICAgIGlmIChwcm9maWxlLmRpc3BsYXlfbmFtZT8udG9Mb3dlckNhc2UoKSA9PT0gbG93ZXJRdWVyeSkgc2NvcmUgKz0gODBcbiAgICBlbHNlIGlmIChwcm9maWxlLmRpc3BsYXlfbmFtZT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlclF1ZXJ5KSkgc2NvcmUgKz0gNDBcbiAgICBcbiAgICAvLyBCaW8gbWF0Y2hlc1xuICAgIGlmIChwcm9maWxlLmJpbz8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlclF1ZXJ5KSkgc2NvcmUgKz0gMjBcbiAgICBcbiAgICAvLyBCb29zdCBmb3IgcHJvZmlsZXMgd2l0aCBhdmF0YXJzIChtb3JlIGNvbXBsZXRlIHByb2ZpbGVzKVxuICAgIGlmIChwcm9maWxlLmF2YXRhcl91cmwpIHNjb3JlICs9IDVcbiAgICBcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBjYW1wYWlnbiA9IHJlc3VsdC5kYXRhIGFzIFNlYXJjaEZ1bmRpbmdQYWdlXG4gICAgXG4gICAgLy8gVGl0bGUgbWF0Y2hlcyBnZXQgaGlnaCBzY29yZVxuICAgIGlmIChjYW1wYWlnbi50aXRsZS50b0xvd2VyQ2FzZSgpID09PSBsb3dlclF1ZXJ5KSBzY29yZSArPSAxMDBcbiAgICBlbHNlIGlmIChjYW1wYWlnbi50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VyUXVlcnkpKSBzY29yZSArPSA2MFxuICAgIFxuICAgIC8vIERlc2NyaXB0aW9uIG1hdGNoZXNcbiAgICBpZiAoY2FtcGFpZ24uZGVzY3JpcHRpb24/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJRdWVyeSkpIHNjb3JlICs9IDMwXG4gICAgXG4gICAgLy8gQ2F0ZWdvcnkgbWF0Y2hlc1xuICAgIGlmIChjYW1wYWlnbi5jYXRlZ29yeT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlclF1ZXJ5KSkgc2NvcmUgKz0gMjVcbiAgICBcbiAgICAvLyBUYWcgbWF0Y2hlc1xuICAgIGlmIChjYW1wYWlnbi50YWdzPy5zb21lKHRhZyA9PiB0YWcudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlclF1ZXJ5KSkpIHNjb3JlICs9IDIwXG4gICAgXG4gICAgLy8gQm9vc3QgZm9yIGFjdGl2ZSBjYW1wYWlnbnNcbiAgICBpZiAoY2FtcGFpZ24uaXNfYWN0aXZlKSBzY29yZSArPSAxMFxuICAgIFxuICAgIC8vIEJvb3N0IGZvciBjYW1wYWlnbnMgd2l0aCBmdW5kaW5nXG4gICAgaWYgKGNhbXBhaWduLnRvdGFsX2Z1bmRpbmcgPiAwKSBzY29yZSArPSA1XG4gICAgXG4gICAgLy8gQm9vc3QgZm9yIGNhbXBhaWducyB3aXRoIGltYWdlc1xuICAgIGlmIChjYW1wYWlnbi5mZWF0dXJlZF9pbWFnZV91cmwpIHNjb3JlICs9IDNcbiAgfVxuICBcbiAgcmV0dXJuIHNjb3JlXG59XG5cbi8vIE9wdGltaXplZCBwcm9maWxlIHNlYXJjaCB3aXRoIGJldHRlciBpbmRleGluZyB1c2FnZVxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoUHJvZmlsZXMoXG4gIHF1ZXJ5Pzogc3RyaW5nLCBcbiAgbGltaXQ6IG51bWJlciA9IDIwLCBcbiAgb2Zmc2V0OiBudW1iZXIgPSAwXG4pOiBQcm9taXNlPFNlYXJjaFByb2ZpbGVbXT4ge1xuICAvLyBTdGFydCB3aXRoIG1pbmltYWwgY29sdW1ucyBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gIGxldCBwcm9maWxlUXVlcnkgPSBzdXBhYmFzZVxuICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgLnNlbGVjdCgnaWQsIHVzZXJuYW1lLCBkaXNwbGF5X25hbWUsIGJpbywgYXZhdGFyX3VybCwgY3JlYXRlZF9hdCcpXG4gIFxuICBpZiAocXVlcnkpIHtcbiAgICAvLyBPUFRJTUlaQVRJT046IFVzZSB0c3ZlY3RvciBmb3IgZnVsbC10ZXh0IHNlYXJjaCB3aGVuIGF2YWlsYWJsZVxuICAgIC8vIEZvciBub3csIG9wdGltaXplIElMSUtFIHF1ZXJpZXMgd2l0aCBwcm9wZXIgb3JkZXJpbmdcbiAgICBjb25zdCBzYW5pdGl6ZWRRdWVyeSA9IHF1ZXJ5LnJlcGxhY2UoL1slX10vZywgJ1xcXFwkJicpIC8vIEVzY2FwZSBTUUwgd2lsZGNhcmRzXG4gICAgcHJvZmlsZVF1ZXJ5ID0gcHJvZmlsZVF1ZXJ5Lm9yKFxuICAgICAgYHVzZXJuYW1lLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSUsZGlzcGxheV9uYW1lLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSUsYmlvLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSVgXG4gICAgKVxuICB9XG4gIFxuICAvLyBPUFRJTUlaQVRJT046IFVzZSBjcmVhdGVkX2F0IGluZGV4IGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgY29uc3QgeyBkYXRhOiBwcm9maWxlcywgZXJyb3IgfSA9IGF3YWl0IHByb2ZpbGVRdWVyeVxuICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgIC5yYW5nZShvZmZzZXQsIG9mZnNldCArIGxpbWl0IC0gMSlcbiAgXG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3JcbiAgcmV0dXJuIHByb2ZpbGVzIHx8IFtdXG59XG5cbi8vIE9wdGltaXplZCBjYW1wYWlnbiBzZWFyY2ggd2l0aCBiZXR0ZXIgcXVlcnkgc3RydWN0dXJlXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hGdW5kaW5nUGFnZXMoXG4gIHF1ZXJ5Pzogc3RyaW5nLFxuICBmaWx0ZXJzPzogU2VhcmNoRmlsdGVycyxcbiAgbGltaXQ6IG51bWJlciA9IDIwLFxuICBvZmZzZXQ6IG51bWJlciA9IDBcbik6IFByb21pc2U8U2VhcmNoRnVuZGluZ1BhZ2VbXT4ge1xuICAvLyBPUFRJTUlaQVRJT046IE9ubHkgc2VsZWN0IG5lY2Vzc2FyeSBjb2x1bW5zIHRvIHJlZHVjZSBwYXlsb2FkXG4gIGxldCBjYW1wYWlnblF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAuZnJvbSgnZnVuZGluZ19wYWdlcycpXG4gICAgLnNlbGVjdChgXG4gICAgICBpZCwgdXNlcl9pZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBjYXRlZ29yeSwgdGFncywgZ29hbF9hbW91bnQsIFxuICAgICAgdG90YWxfZnVuZGluZywgY29udHJpYnV0b3JfY291bnQsIGlzX2FjdGl2ZSwgaXNfcHVibGljLCBcbiAgICAgIGZlYXR1cmVkX2ltYWdlX3VybCwgY3JlYXRlZF9hdCwgc2x1ZyxcbiAgICAgIHByb2ZpbGVzIWlubmVyKHVzZXJuYW1lLCBkaXNwbGF5X25hbWUsIGF2YXRhcl91cmwpXG4gICAgYClcbiAgICAuZXEoJ2lzX3B1YmxpYycsIHRydWUpIC8vIE9QVElNSVpBVElPTjogVGhpcyBzaG91bGQgdXNlIGFuIGluZGV4XG4gIFxuICBpZiAocXVlcnkpIHtcbiAgICBjb25zdCBzYW5pdGl6ZWRRdWVyeSA9IHF1ZXJ5LnJlcGxhY2UoL1slX10vZywgJ1xcXFwkJicpXG4gICAgY2FtcGFpZ25RdWVyeSA9IGNhbXBhaWduUXVlcnkub3IoXG4gICAgICBgdGl0bGUuaWxpa2UuJSR7c2FuaXRpemVkUXVlcnl9JSxkZXNjcmlwdGlvbi5pbGlrZS4lJHtzYW5pdGl6ZWRRdWVyeX0lLGNhdGVnb3J5LmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSVgXG4gICAgKVxuICB9XG4gIFxuICAvLyBPUFRJTUlaQVRJT046IEFwcGx5IG1vc3Qgc2VsZWN0aXZlIGZpbHRlcnMgZmlyc3RcbiAgaWYgKGZpbHRlcnMpIHtcbiAgICAvLyBNb3N0IHNlbGVjdGl2ZSBmaWx0ZXJzIGZpcnN0IGZvciBiZXR0ZXIgcXVlcnkgcGVyZm9ybWFuY2VcbiAgICBpZiAoZmlsdGVycy5pc0FjdGl2ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjYW1wYWlnblF1ZXJ5ID0gY2FtcGFpZ25RdWVyeS5lcSgnaXNfYWN0aXZlJywgZmlsdGVycy5pc0FjdGl2ZSlcbiAgICB9XG4gICAgXG4gICAgaWYgKGZpbHRlcnMuY2F0ZWdvcmllcyAmJiBmaWx0ZXJzLmNhdGVnb3JpZXMubGVuZ3RoID4gMCkge1xuICAgICAgY2FtcGFpZ25RdWVyeSA9IGNhbXBhaWduUXVlcnkuaW4oJ2NhdGVnb3J5JywgZmlsdGVycy5jYXRlZ29yaWVzKVxuICAgIH1cbiAgICBcbiAgICBpZiAoZmlsdGVycy5oYXNHb2FsKSB7XG4gICAgICBjYW1wYWlnblF1ZXJ5ID0gY2FtcGFpZ25RdWVyeS5ub3QoJ2dvYWxfYW1vdW50JywgJ2lzJywgbnVsbClcbiAgICB9XG4gICAgXG4gICAgaWYgKGZpbHRlcnMubWluRnVuZGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjYW1wYWlnblF1ZXJ5ID0gY2FtcGFpZ25RdWVyeS5ndGUoJ3RvdGFsX2Z1bmRpbmcnLCBmaWx0ZXJzLm1pbkZ1bmRpbmcpXG4gICAgfVxuICAgIFxuICAgIGlmIChmaWx0ZXJzLm1heEZ1bmRpbmcgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY2FtcGFpZ25RdWVyeSA9IGNhbXBhaWduUXVlcnkubHRlKCd0b3RhbF9mdW5kaW5nJywgZmlsdGVycy5tYXhGdW5kaW5nKVxuICAgIH1cbiAgICBcbiAgICBpZiAoZmlsdGVycy5kYXRlUmFuZ2UpIHtcbiAgICAgIGNhbXBhaWduUXVlcnkgPSBjYW1wYWlnblF1ZXJ5XG4gICAgICAgIC5ndGUoJ2NyZWF0ZWRfYXQnLCBmaWx0ZXJzLmRhdGVSYW5nZS5zdGFydClcbiAgICAgICAgLmx0ZSgnY3JlYXRlZF9hdCcsIGZpbHRlcnMuZGF0ZVJhbmdlLmVuZClcbiAgICB9XG4gIH1cbiAgXG4gIC8vIE9QVElNSVpBVElPTjogVXNlIGluZGV4LWZyaWVuZGx5IG9yZGVyaW5nXG4gIGNvbnN0IHsgZGF0YTogcmF3Q2FtcGFpZ25zLCBlcnJvciB9ID0gYXdhaXQgY2FtcGFpZ25RdWVyeVxuICAgIC5vcmRlcignY3JlYXRlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgIC5yYW5nZShvZmZzZXQsIG9mZnNldCArIGxpbWl0IC0gMSlcbiAgXG4gIGlmIChlcnJvcikgdGhyb3cgZXJyb3JcbiAgXG4gIC8vIE9QVElNSVpBVElPTjogTWluaW1pemUgZGF0YSB0cmFuc2Zvcm1hdGlvbiBvdmVyaGVhZFxuICBjb25zdCBjYW1wYWlnbnM6IFNlYXJjaEZ1bmRpbmdQYWdlW10gPSAocmF3Q2FtcGFpZ25zIGFzIFJhd1NlYXJjaEZ1bmRpbmdQYWdlW10gfHwgW10pLm1hcChjYW1wYWlnbiA9PiAoe1xuICAgIC4uLmNhbXBhaWduLFxuICAgIHByb2ZpbGVzOiBjYW1wYWlnbi5wcm9maWxlcz8uWzBdIHx8IHVuZGVmaW5lZFxuICB9KSlcbiAgXG4gIHJldHVybiBjYW1wYWlnbnNcbn1cblxuLy8gT1BUSU1JWkFUSU9OOiBDYWNoZWQgZmFjZXRzIHdpdGggc21hcnRlciB1cGRhdGUgc3RyYXRlZ3lcbmxldCBmYWNldHNDYWNoZTogeyBkYXRhOiBTZWFyY2hSZXNwb25zZVsnZmFjZXRzJ107IHRpbWVzdGFtcDogbnVtYmVyIH0gfCBudWxsID0gbnVsbFxuY29uc3QgRkFDRVRTX0NBQ0hFX0RVUkFUSU9OID0gMTAgKiA2MCAqIDEwMDAgLy8gMTAgbWludXRlcyBmb3IgZmFjZXRzXG5cbmFzeW5jIGZ1bmN0aW9uIGdldFNlYXJjaEZhY2V0cygpOiBQcm9taXNlPFNlYXJjaFJlc3BvbnNlWydmYWNldHMnXT4ge1xuICAvLyBSZXR1cm4gY2FjaGVkIGZhY2V0cyBpZiBhdmFpbGFibGVcbiAgaWYgKGZhY2V0c0NhY2hlICYmIERhdGUubm93KCkgLSBmYWNldHNDYWNoZS50aW1lc3RhbXAgPCBGQUNFVFNfQ0FDSEVfRFVSQVRJT04pIHtcbiAgICByZXR1cm4gZmFjZXRzQ2FjaGUuZGF0YVxuICB9XG4gIFxuICB0cnkge1xuICAgIC8vIE9QVElNSVpBVElPTjogVXNlIFByb21pc2UuYWxsIGZvciBwYXJhbGxlbCBxdWVyaWVzXG4gICAgY29uc3QgW2NhdGVnb3J5RGF0YSwgcHJvZmlsZXNSZXN1bHQsIGNhbXBhaWduc1Jlc3VsdF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAvLyBPbmx5IGdldCBjYXRlZ29yaWVzIGZvciBhY3RpdmUgcHVibGljIGNhbXBhaWduc1xuICAgICAgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdmdW5kaW5nX3BhZ2VzJylcbiAgICAgIC5zZWxlY3QoJ2NhdGVnb3J5JylcbiAgICAgIC5lcSgnaXNfcHVibGljJywgdHJ1ZSlcbiAgICAgICAgLmVxKCdpc19hY3RpdmUnLCB0cnVlKSAvLyBPUFRJTUlaQVRJT046IE1vcmUgc2VsZWN0aXZlIGZpbHRlclxuICAgICAgICAubm90KCdjYXRlZ29yeScsICdpcycsIG51bGwpLFxuICAgICAgXG4gICAgICAvLyBVc2UgY291bnQgcXVlcmllcyB3aXRoIGhlYWQ6dHJ1ZSBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXG4gICAgICBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnNlbGVjdCgnaWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLFxuICAgICAgc3VwYWJhc2UuZnJvbSgnZnVuZGluZ19wYWdlcycpLnNlbGVjdCgnaWQnLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pLmVxKCdpc19wdWJsaWMnLCB0cnVlKVxuICAgIF0pXG4gICAgXG4gICAgaWYgKGNhdGVnb3J5RGF0YS5lcnJvcikgdGhyb3cgY2F0ZWdvcnlEYXRhLmVycm9yXG4gICAgXG4gICAgLy8gT1BUSU1JWkFUSU9OOiBVc2UgTWFwIGZvciBPKDEpIGxvb2t1cHMgaW5zdGVhZCBvZiByZXBlYXRlZCBhcnJheSBvcGVyYXRpb25zXG4gICAgY29uc3QgY2F0ZWdvcnlNYXAgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpXG4gICAgY2F0ZWdvcnlEYXRhLmRhdGE/LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBpZiAoaXRlbS5jYXRlZ29yeSkge1xuICAgICAgICBjYXRlZ29yeU1hcC5zZXQoaXRlbS5jYXRlZ29yeSwgKGNhdGVnb3J5TWFwLmdldChpdGVtLmNhdGVnb3J5KSB8fCAwKSArIDEpXG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgICBjb25zdCBjYXRlZ29yaWVzID0gQXJyYXkuZnJvbShjYXRlZ29yeU1hcC5lbnRyaWVzKCkpXG4gICAgICAubWFwKChbbmFtZSwgY291bnRdKSA9PiAoeyBuYW1lLCBjb3VudCB9KSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmNvdW50IC0gYS5jb3VudClcbiAgICBcbiAgICBjb25zdCBmYWNldHMgPSB7XG4gICAgICBjYXRlZ29yaWVzLFxuICAgICAgdG90YWxQcm9maWxlczogcHJvZmlsZXNSZXN1bHQuY291bnQgfHwgMCxcbiAgICAgIHRvdGFsQ2FtcGFpZ25zOiBjYW1wYWlnbnNSZXN1bHQuY291bnQgfHwgMFxuICAgIH1cbiAgICBcbiAgICAvLyBDYWNoZSB0aGUgZmFjZXRzXG4gICAgZmFjZXRzQ2FjaGUgPSB7XG4gICAgICBkYXRhOiBmYWNldHMsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGZhY2V0c1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyBzZWFyY2ggZmFjZXRzJywgZXJyb3IsICdTZWFyY2gnKVxuICAgIHJldHVybiB7XG4gICAgICBjYXRlZ29yaWVzOiBbXSxcbiAgICAgIHRvdGFsUHJvZmlsZXM6IDAsXG4gICAgICB0b3RhbENhbXBhaWduczogMFxuICAgIH1cbiAgfVxufVxuXG4vLyBTb3J0IHJlc3VsdHMgKG9wdGltaXplZCBmb3IgcGVyZm9ybWFuY2UpXG5mdW5jdGlvbiBzb3J0UmVzdWx0cyhyZXN1bHRzOiBTZWFyY2hSZXN1bHRbXSwgc29ydEJ5OiBTb3J0T3B0aW9uLCBxdWVyeT86IHN0cmluZyk6IFNlYXJjaFJlc3VsdFtdIHtcbiAgLy8gT1BUSU1JWkFUSU9OOiBBdm9pZCBhcnJheSBjb3B5aW5nIHdoZW4gcG9zc2libGVcbiAgaWYgKHJlc3VsdHMubGVuZ3RoIDw9IDEpIHJldHVybiByZXN1bHRzXG4gIFxuICByZXR1cm4gWy4uLnJlc3VsdHNdLnNvcnQoKGEsIGIpID0+IHtcbiAgICBzd2l0Y2ggKHNvcnRCeSkge1xuICAgICAgY2FzZSAncmVsZXZhbmNlJzpcbiAgICAgICAgaWYgKHF1ZXJ5KSB7XG4gICAgICAgICAgY29uc3Qgc2NvcmVBID0gYS5yZWxldmFuY2VTY29yZSA/PyBjYWxjdWxhdGVSZWxldmFuY2VTY29yZShhLCBxdWVyeSlcbiAgICAgICAgICBjb25zdCBzY29yZUIgPSBiLnJlbGV2YW5jZVNjb3JlID8/IGNhbGN1bGF0ZVJlbGV2YW5jZVNjb3JlKGIsIHF1ZXJ5KVxuICAgICAgICAgIGlmIChzY29yZUEgIT09IHNjb3JlQikgcmV0dXJuIHNjb3JlQiAtIHNjb3JlQVxuICAgICAgICB9XG4gICAgICAgIC8vIEZhbGwgYmFjayB0byByZWNlbnQgZm9yIHNhbWUgcmVsZXZhbmNlIHNjb3Jlc1xuICAgICAgICByZXR1cm4gbmV3IERhdGUoYi5kYXRhLmNyZWF0ZWRfYXQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEuZGF0YS5jcmVhdGVkX2F0KS5nZXRUaW1lKClcbiAgICAgICAgXG4gICAgICBjYXNlICdyZWNlbnQnOlxuICAgICAgICByZXR1cm4gbmV3IERhdGUoYi5kYXRhLmNyZWF0ZWRfYXQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEuZGF0YS5jcmVhdGVkX2F0KS5nZXRUaW1lKClcbiAgICAgICAgXG4gICAgICBjYXNlICdwb3B1bGFyJzpcbiAgICAgICAgaWYgKGEudHlwZSA9PT0gJ2NhbXBhaWduJyAmJiBiLnR5cGUgPT09ICdjYW1wYWlnbicpIHtcbiAgICAgICAgICBjb25zdCBjYW1wYWlnbkEgPSBhLmRhdGEgYXMgU2VhcmNoRnVuZGluZ1BhZ2VcbiAgICAgICAgICBjb25zdCBjYW1wYWlnbkIgPSBiLmRhdGEgYXMgU2VhcmNoRnVuZGluZ1BhZ2VcbiAgICAgICAgICByZXR1cm4gY2FtcGFpZ25CLmNvbnRyaWJ1dG9yX2NvdW50IC0gY2FtcGFpZ25BLmNvbnRyaWJ1dG9yX2NvdW50XG4gICAgICAgIH1cbiAgICAgICAgLy8gUHJvZmlsZXMgZG9uJ3QgaGF2ZSBwb3B1bGFyaXR5IG1ldHJpYywgZmFsbCBiYWNrIHRvIHJlY2VudFxuICAgICAgICByZXR1cm4gbmV3IERhdGUoYi5kYXRhLmNyZWF0ZWRfYXQpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGEuZGF0YS5jcmVhdGVkX2F0KS5nZXRUaW1lKClcbiAgICAgICAgXG4gICAgICBjYXNlICdmdW5kaW5nJzpcbiAgICAgICAgaWYgKGEudHlwZSA9PT0gJ2NhbXBhaWduJyAmJiBiLnR5cGUgPT09ICdjYW1wYWlnbicpIHtcbiAgICAgICAgICBjb25zdCBjYW1wYWlnbkEgPSBhLmRhdGEgYXMgU2VhcmNoRnVuZGluZ1BhZ2VcbiAgICAgICAgICBjb25zdCBjYW1wYWlnbkIgPSBiLmRhdGEgYXMgU2VhcmNoRnVuZGluZ1BhZ2VcbiAgICAgICAgICByZXR1cm4gY2FtcGFpZ25CLnRvdGFsX2Z1bmRpbmcgLSBjYW1wYWlnbkEudG90YWxfZnVuZGluZ1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShiLmRhdGEuY3JlYXRlZF9hdCkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS5kYXRhLmNyZWF0ZWRfYXQpLmdldFRpbWUoKVxuICAgICAgICBcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAwXG4gICAgfVxuICB9KVxufVxuXG4vLyBPUFRJTUlaQVRJT046IE1haW4gc2VhcmNoIGZ1bmN0aW9uIHdpdGggaW1wcm92ZWQgcGVyZm9ybWFuY2VcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZWFyY2gob3B0aW9uczogU2VhcmNoT3B0aW9ucyk6IFByb21pc2U8U2VhcmNoUmVzcG9uc2U+IHtcbiAgY29uc3Qge1xuICAgIHF1ZXJ5LFxuICAgIHR5cGUsXG4gICAgc29ydEJ5LFxuICAgIGZpbHRlcnMsXG4gICAgbGltaXQgPSAyMCxcbiAgICBvZmZzZXQgPSAwXG4gIH0gPSBvcHRpb25zXG4gIFxuICAvLyBDaGVjayBjYWNoZSBmaXJzdCB3aXRoIG9wdGltaXplZCBjYWNoZSBrZXlcbiAgY29uc3QgY2FjaGVLZXkgPSBnZW5lcmF0ZUNhY2hlS2V5KG9wdGlvbnMpXG4gIGNvbnN0IGNhY2hlZFJlc3VsdCA9IGdldENhY2hlZFJlc3VsdChjYWNoZUtleSlcbiAgaWYgKGNhY2hlZFJlc3VsdCkge1xuICAgIHJldHVybiBjYWNoZWRSZXN1bHRcbiAgfVxuICBcbiAgdHJ5IHtcbiAgICBjb25zdCByZXN1bHRzOiBTZWFyY2hSZXN1bHRbXSA9IFtdXG4gICAgbGV0IHRvdGFsQ291bnQgPSAwXG4gICAgXG4gICAgLy8gT1BUSU1JWkFUSU9OOiBVc2UgUHJvbWlzZS5hbGwgZm9yIHBhcmFsbGVsIHNlYXJjaGVzIHdoZW4gdHlwZSBpcyAnYWxsJ1xuICAgIGlmICh0eXBlID09PSAnYWxsJykge1xuICAgICAgY29uc3QgW3Byb2ZpbGVzLCBjYW1wYWlnbnNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBzZWFyY2hQcm9maWxlcyhxdWVyeSwgbGltaXQsIG9mZnNldCkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIGxvZ2dlci53YXJuKCdFcnJvciBzZWFyY2hpbmcgcHJvZmlsZXMnLCBlcnJvciwgJ1NlYXJjaCcpXG4gICAgICAgICAgcmV0dXJuIFtdXG4gICAgICAgIH0pLFxuICAgICAgICBzZWFyY2hGdW5kaW5nUGFnZXMocXVlcnksIGZpbHRlcnMsIGxpbWl0LCBvZmZzZXQpLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICBsb2dnZXIud2FybignRXJyb3Igc2VhcmNoaW5nIGNhbXBhaWducycsIGVycm9yLCAnU2VhcmNoJylcbiAgICAgICAgICByZXR1cm4gW11cbiAgICAgICAgfSlcbiAgICAgIF0pXG4gICAgICBcbiAgICAgIC8vIFByb2Nlc3MgcHJvZmlsZXNcbiAgICAgIHByb2ZpbGVzLmZvckVhY2gocHJvZmlsZSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdDogU2VhcmNoUmVzdWx0ID0geyB0eXBlOiAncHJvZmlsZScsIGRhdGE6IHByb2ZpbGUgfVxuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICByZXN1bHQucmVsZXZhbmNlU2NvcmUgPSBjYWxjdWxhdGVSZWxldmFuY2VTY29yZShyZXN1bHQsIHF1ZXJ5KVxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpXG4gICAgICB9KVxuICAgICAgXG4gICAgICAvLyBQcm9jZXNzIGNhbXBhaWduc1xuICAgICAgY2FtcGFpZ25zLmZvckVhY2goY2FtcGFpZ24gPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQ6IFNlYXJjaFJlc3VsdCA9IHsgdHlwZTogJ2NhbXBhaWduJywgZGF0YTogY2FtcGFpZ24gfVxuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICByZXN1bHQucmVsZXZhbmNlU2NvcmUgPSBjYWxjdWxhdGVSZWxldmFuY2VTY29yZShyZXN1bHQsIHF1ZXJ5KVxuICAgICAgICB9XG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBTaW5nbGUgdHlwZSBzZWFyY2hlc1xuICAgICAgaWYgKHR5cGUgPT09ICdwcm9maWxlcycpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHByb2ZpbGVzID0gYXdhaXQgc2VhcmNoUHJvZmlsZXMocXVlcnksIGxpbWl0LCBvZmZzZXQpXG4gICAgICAgIHByb2ZpbGVzLmZvckVhY2gocHJvZmlsZSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0OiBTZWFyY2hSZXN1bHQgPSB7IHR5cGU6ICdwcm9maWxlJywgZGF0YTogcHJvZmlsZSB9XG4gICAgICAgICAgaWYgKHF1ZXJ5KSB7XG4gICAgICAgICAgICByZXN1bHQucmVsZXZhbmNlU2NvcmUgPSBjYWxjdWxhdGVSZWxldmFuY2VTY29yZShyZXN1bHQsIHF1ZXJ5KVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHRzLnB1c2gocmVzdWx0KVxuICAgICAgICB9KVxuICAgICAgfSBjYXRjaCAocHJvZmlsZUVycm9yKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKCdFcnJvciBzZWFyY2hpbmcgcHJvZmlsZXMnLCBwcm9maWxlRXJyb3IsICdTZWFyY2gnKVxuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgICAgaWYgKHR5cGUgPT09ICdjYW1wYWlnbnMnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjYW1wYWlnbnMgPSBhd2FpdCBzZWFyY2hGdW5kaW5nUGFnZXMocXVlcnksIGZpbHRlcnMsIGxpbWl0LCBvZmZzZXQpXG4gICAgICAgIGNhbXBhaWducy5mb3JFYWNoKGNhbXBhaWduID0+IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQ6IFNlYXJjaFJlc3VsdCA9IHsgdHlwZTogJ2NhbXBhaWduJywgZGF0YTogY2FtcGFpZ24gfVxuICAgICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgcmVzdWx0LnJlbGV2YW5jZVNjb3JlID0gY2FsY3VsYXRlUmVsZXZhbmNlU2NvcmUocmVzdWx0LCBxdWVyeSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdClcbiAgICAgICAgfSlcbiAgICAgIH0gY2F0Y2ggKGNhbXBhaWduRXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ0Vycm9yIHNlYXJjaGluZyBjYW1wYWlnbnMnLCBjYW1wYWlnbkVycm9yLCAnU2VhcmNoJylcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBTb3J0IHJlc3VsdHNcbiAgICBjb25zdCBzb3J0ZWRSZXN1bHRzID0gc29ydFJlc3VsdHMocmVzdWx0cywgc29ydEJ5LCBxdWVyeSlcbiAgICBcbiAgICAvLyBBcHBseSBwYWdpbmF0aW9uIGFmdGVyIHNvcnRpbmcgKGZvciBtaXhlZCByZXN1bHRzKVxuICAgIGNvbnN0IHBhZ2luYXRlZFJlc3VsdHMgPSBzb3J0ZWRSZXN1bHRzLnNsaWNlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQpXG4gICAgdG90YWxDb3VudCA9IHNvcnRlZFJlc3VsdHMubGVuZ3RoXG4gICAgXG4gICAgLy8gR2V0IGZhY2V0cyBvbmx5IGlmIG5lZWRlZCAobm90IGZvciBldmVyeSBzZWFyY2gpXG4gICAgbGV0IGZhY2V0czogU2VhcmNoUmVzcG9uc2VbJ2ZhY2V0cyddIHwgdW5kZWZpbmVkXG4gICAgaWYgKHR5cGUgPT09ICdhbGwnIHx8IHR5cGUgPT09ICdjYW1wYWlnbnMnKSB7XG4gICAgdHJ5IHtcbiAgICAgIGZhY2V0cyA9IGF3YWl0IGdldFNlYXJjaEZhY2V0cygpXG4gICAgICB9IGNhdGNoIChmYWNldHNFcnJvcikge1xuICAgICAgICBsb2dnZXIud2FybignRXJyb3IgZ2V0dGluZyBmYWNldHMnLCBmYWNldHNFcnJvciwgJ1NlYXJjaCcpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlOiBTZWFyY2hSZXNwb25zZSA9IHtcbiAgICAgIHJlc3VsdHM6IHBhZ2luYXRlZFJlc3VsdHMsXG4gICAgICB0b3RhbENvdW50LFxuICAgICAgaGFzTW9yZTogdG90YWxDb3VudCA+IG9mZnNldCArIGxpbWl0LFxuICAgICAgZmFjZXRzXG4gICAgfVxuICAgIFxuICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICBzZXRDYWNoZWRSZXN1bHQoY2FjaGVLZXksIHJlc3BvbnNlKVxuICAgIFxuICAgIHJldHVybiByZXNwb25zZVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignU2VhcmNoIGVycm9yJywgZXJyb3IsICdTZWFyY2gnKVxuICAgIFxuICAgIC8vIFJldHVybiBlbXB0eSByZXN1bHRzIG9uIGVycm9yXG4gICAgY29uc3QgZXJyb3JSZXNwb25zZTogU2VhcmNoUmVzcG9uc2UgPSB7XG4gICAgICByZXN1bHRzOiBbXSxcbiAgICAgIHRvdGFsQ291bnQ6IDAsXG4gICAgICBoYXNNb3JlOiBmYWxzZVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZXJyb3JSZXNwb25zZVxuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09IFJFTUFJTklORyBGVU5DVElPTlMgKE9QVElNSVpFRCkgPT09PT09PT09PT09PT09PT09PT1cblxuLy8gT3B0aW1pemVkIHRyZW5kaW5nIGZ1bmN0aW9uIHdpdGggYmV0dGVyIHBlcmZvcm1hbmNlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VHJlbmRpbmcoKTogUHJvbWlzZTxTZWFyY2hSZXNwb25zZT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdHM6IFNlYXJjaFJlc3VsdFtdID0gW11cbiAgICBcbiAgICAvLyBPUFRJTUlaQVRJT046IFVzZSBQcm9taXNlLmFsbCBmb3IgcGFyYWxsZWwgcXVlcmllc1xuICAgIGNvbnN0IFtjYW1wYWlnbnNEYXRhLCBwcm9maWxlc0RhdGFdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIC8vIEdldCBwb3B1bGFyIGNhbXBhaWducyAoYnkgY29udHJpYnV0b3IgY291bnQpXG4gICAgICBzdXBhYmFzZVxuICAgICAgLmZyb20oJ2Z1bmRpbmdfcGFnZXMnKVxuICAgICAgLnNlbGVjdChgXG4gICAgICAgIGlkLCB1c2VyX2lkLCB0aXRsZSwgZGVzY3JpcHRpb24sIGNhdGVnb3J5LCB0YWdzLCBnb2FsX2Ftb3VudCwgXG4gICAgICAgIHRvdGFsX2Z1bmRpbmcsIGNvbnRyaWJ1dG9yX2NvdW50LCBpc19hY3RpdmUsIGlzX3B1YmxpYywgXG4gICAgICAgIGZlYXR1cmVkX2ltYWdlX3VybCwgY3JlYXRlZF9hdCwgc2x1ZyxcbiAgICAgICAgcHJvZmlsZXMhaW5uZXIodXNlcm5hbWUsIGRpc3BsYXlfbmFtZSwgYXZhdGFyX3VybClcbiAgICAgIGApXG4gICAgICAuZXEoJ2lzX3B1YmxpYycsIHRydWUpXG4gICAgICAuZXEoJ2lzX2FjdGl2ZScsIHRydWUpXG4gICAgICAub3JkZXIoJ2NvbnRyaWJ1dG9yX2NvdW50JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG4gICAgICAgIC5saW1pdCgxMCksXG4gICAgICBcbiAgICAgIC8vIEdldCByZWNlbnQgcHJvZmlsZXNcbiAgICAgIHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlcycpXG4gICAgICAgIC5zZWxlY3QoJ2lkLCB1c2VybmFtZSwgZGlzcGxheV9uYW1lLCBiaW8sIGF2YXRhcl91cmwsIGNyZWF0ZWRfYXQnKVxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgIC5saW1pdCgxMClcbiAgICBdKVxuICAgIFxuICAgIC8vIFByb2Nlc3MgY2FtcGFpZ25zXG4gICAgaWYgKCFjYW1wYWlnbnNEYXRhLmVycm9yICYmIGNhbXBhaWduc0RhdGEuZGF0YSkge1xuICAgICAgY29uc3QgcG9wdWxhckNhbXBhaWduczogU2VhcmNoRnVuZGluZ1BhZ2VbXSA9IChjYW1wYWlnbnNEYXRhLmRhdGEgYXMgUmF3U2VhcmNoRnVuZGluZ1BhZ2VbXSkubWFwKGNhbXBhaWduID0+ICh7XG4gICAgICAgIC4uLmNhbXBhaWduLFxuICAgICAgICBwcm9maWxlczogY2FtcGFpZ24ucHJvZmlsZXM/LlswXSB8fCB1bmRlZmluZWRcbiAgICAgIH0pKVxuICAgICAgXG4gICAgICBwb3B1bGFyQ2FtcGFpZ25zLmZvckVhY2goY2FtcGFpZ24gPT4ge1xuICAgICAgICByZXN1bHRzLnB1c2goeyB0eXBlOiAnY2FtcGFpZ24nLCBkYXRhOiBjYW1wYWlnbiB9KVxuICAgICAgfSlcbiAgICB9IGVsc2UgaWYgKGNhbXBhaWduc0RhdGEuZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdFcnJvciBmZXRjaGluZyBjYW1wYWlnbnMgZm9yIHRyZW5kaW5nJywgeyBlcnJvcjogY2FtcGFpZ25zRGF0YS5lcnJvci5tZXNzYWdlIH0sICdTZWFyY2gnKVxuICAgIH1cbiAgICBcbiAgICAvLyBQcm9jZXNzIHByb2ZpbGVzXG4gICAgaWYgKCFwcm9maWxlc0RhdGEuZXJyb3IgJiYgcHJvZmlsZXNEYXRhLmRhdGEpIHtcbiAgICAgIHByb2ZpbGVzRGF0YS5kYXRhLmZvckVhY2gocHJvZmlsZSA9PiB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7IHR5cGU6ICdwcm9maWxlJywgZGF0YTogcHJvZmlsZSB9KVxuICAgICAgfSlcbiAgICB9IGVsc2UgaWYgKHByb2ZpbGVzRGF0YS5lcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Vycm9yIGZldGNoaW5nIHByb2ZpbGVzIGZvciB0cmVuZGluZycsIHsgZXJyb3I6IHByb2ZpbGVzRGF0YS5lcnJvci5tZXNzYWdlIH0sICdTZWFyY2gnKVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdWx0cyxcbiAgICAgIHRvdGFsQ291bnQ6IHJlc3VsdHMubGVuZ3RoLFxuICAgICAgaGFzTW9yZTogZmFsc2UgLy8gVHJlbmRpbmcgaXMgYWx3YXlzIGEgZml4ZWQgc2V0XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyB0cmVuZGluZyBjb250ZW50JywgZXJyb3IsICdTZWFyY2gnKVxuICAgIHJldHVybiB7XG4gICAgICByZXN1bHRzOiBbXSxcbiAgICAgIHRvdGFsQ291bnQ6IDAsXG4gICAgICBoYXNNb3JlOiBmYWxzZVxuICAgIH1cbiAgfVxufVxuXG4vLyBDbGVhciBjYWNoZSB3aXRoIGNsZWFudXBcbmV4cG9ydCBmdW5jdGlvbiBjbGVhclNlYXJjaENhY2hlKCk6IHZvaWQge1xuICBzZWFyY2hDYWNoZS5jbGVhcigpXG4gIGZhY2V0c0NhY2hlID0gbnVsbFxufVxuXG4vLyBPcHRpbWl6ZWQgc2VhcmNoIHN1Z2dlc3Rpb25zXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VhcmNoU3VnZ2VzdGlvbnMocXVlcnk6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDUpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIGlmICghcXVlcnkgfHwgcXVlcnkubGVuZ3RoIDwgMikgcmV0dXJuIFtdXG4gIFxuICB0cnkge1xuICAgIGNvbnN0IHNhbml0aXplZFF1ZXJ5ID0gcXVlcnkucmVwbGFjZSgvWyVfXS9nLCAnXFxcXCQmJylcbiAgICBcbiAgICAvLyBPUFRJTUlaQVRJT046IFVzZSBQcm9taXNlLmFsbCBmb3IgcGFyYWxsZWwgc3VnZ2VzdGlvbiBxdWVyaWVzXG4gICAgY29uc3QgW3Byb2ZpbGVTdWdnZXN0aW9ucywgY2FtcGFpZ25TdWdnZXN0aW9uc10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3Byb2ZpbGVzJylcbiAgICAgIC5zZWxlY3QoJ3VzZXJuYW1lLCBkaXNwbGF5X25hbWUnKVxuICAgICAgICAub3IoYHVzZXJuYW1lLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSUsZGlzcGxheV9uYW1lLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSVgKVxuICAgICAgICAubm90KCd1c2VybmFtZScsICdpcycsIG51bGwpXG4gICAgICAgIC5saW1pdChsaW1pdCksXG4gICAgICBcbiAgICAgIHN1cGFiYXNlXG4gICAgICAuZnJvbSgnZnVuZGluZ19wYWdlcycpXG4gICAgICAuc2VsZWN0KCd0aXRsZSwgY2F0ZWdvcnknKVxuICAgICAgICAub3IoYHRpdGxlLmlsaWtlLiUke3Nhbml0aXplZFF1ZXJ5fSUsY2F0ZWdvcnkuaWxpa2UuJSR7c2FuaXRpemVkUXVlcnl9JWApXG4gICAgICAuZXEoJ2lzX3B1YmxpYycsIHRydWUpXG4gICAgICAubGltaXQobGltaXQpXG4gICAgXSlcbiAgICBcbiAgICBjb25zdCBzdWdnZXN0aW9uczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KClcbiAgICBcbiAgICAvLyBBZGQgcHJvZmlsZSBzdWdnZXN0aW9uc1xuICAgIGlmICghcHJvZmlsZVN1Z2dlc3Rpb25zLmVycm9yICYmIHByb2ZpbGVTdWdnZXN0aW9ucy5kYXRhKSB7XG4gICAgICBwcm9maWxlU3VnZ2VzdGlvbnMuZGF0YS5mb3JFYWNoKHByb2ZpbGUgPT4ge1xuICAgICAgICBpZiAocHJvZmlsZS51c2VybmFtZSkgc3VnZ2VzdGlvbnMuYWRkKHByb2ZpbGUudXNlcm5hbWUpXG4gICAgICAgIGlmIChwcm9maWxlLmRpc3BsYXlfbmFtZSkgc3VnZ2VzdGlvbnMuYWRkKHByb2ZpbGUuZGlzcGxheV9uYW1lKVxuICAgICAgfSlcbiAgICB9XG4gICAgXG4gICAgLy8gQWRkIGNhbXBhaWduIHN1Z2dlc3Rpb25zXG4gICAgaWYgKCFjYW1wYWlnblN1Z2dlc3Rpb25zLmVycm9yICYmIGNhbXBhaWduU3VnZ2VzdGlvbnMuZGF0YSkge1xuICAgICAgY2FtcGFpZ25TdWdnZXN0aW9ucy5kYXRhLmZvckVhY2goY2FtcGFpZ24gPT4ge1xuICAgICAgICBpZiAoY2FtcGFpZ24udGl0bGUpIHN1Z2dlc3Rpb25zLmFkZChjYW1wYWlnbi50aXRsZSlcbiAgICAgICAgaWYgKGNhbXBhaWduLmNhdGVnb3J5KSBzdWdnZXN0aW9ucy5hZGQoY2FtcGFpZ24uY2F0ZWdvcnkpXG4gICAgICB9KVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gQXJyYXkuZnJvbShzdWdnZXN0aW9ucykuc2xpY2UoMCwgbGltaXQpXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHNlYXJjaCBzdWdnZXN0aW9ucycsIGVycm9yLCAnU2VhcmNoJylcbiAgICByZXR1cm4gW11cbiAgfVxufSAiXSwidmVyc2lvbiI6M30=
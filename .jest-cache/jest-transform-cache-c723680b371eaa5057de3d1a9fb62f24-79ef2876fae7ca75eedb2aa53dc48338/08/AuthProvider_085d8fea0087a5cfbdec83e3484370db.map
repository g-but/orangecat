{"version":3,"names":["cov_zp47hmqff","actualCoverage","exports","AuthProvider","react_1","s","require","auth_1","Loading_1","__importDefault","user","session","profile","children","f","setInitialAuthState","useAuthStore","storeHydrated","hydrated","isInitialized","useRef","process","env","NODE_ENV","b","useEffect","current","timeout","setTimeout","store","getState","clearTimeout","jsx_runtime_1","jsx","suppressHydrationWarning","default","fullScreen","Fragment"],"sources":["/home/g/dev/orangecat/src/components/AuthProvider.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { useAuthStore } from '@/stores/auth';\nimport Loading from '@/components/Loading';\nimport type { User, Session } from '@supabase/supabase-js';\nimport type { Profile } from '@/types/database';\n\ninterface AuthProviderProps {\n  user: User | null;\n  session: Session | null;\n  profile: Profile | null;\n  children: React.ReactNode;\n}\n\nexport function AuthProvider({ user, session, profile, children }: AuthProviderProps) {\n  const setInitialAuthState = useAuthStore((s) => s.setInitialAuthState);\n  const storeHydrated = useAuthStore((s) => s.hydrated);\n  const isInitialized = useRef(false);\n\n  if (process.env.NODE_ENV === 'development') {\n    // REMOVED: console.log statement for security\n  }\n\n  useEffect(() => {\n    // Initialize the store only once with the server-provided state.\n    if (!isInitialized.current) {\n      if (process.env.NODE_ENV === 'development') {\n        // REMOVED: console.log statement for security\n      }\n      setInitialAuthState(user, session, profile);\n      isInitialized.current = true;\n    }\n  }, [user, session, profile, setInitialAuthState]);\n\n  // Add a timeout to prevent infinite loading\n  useEffect(() => {\n    if (!storeHydrated) {\n      const timeout = setTimeout(() => {\n        // REMOVED: console.log statement for security\n        // Force hydration immediately if not hydrated (reduced timeout)\n        const store = useAuthStore.getState();\n        if (!store.hydrated) {\n          store.setInitialAuthState(user, session, profile);\n        }\n      }, 100); // FIXED: Much shorter timeout (100ms)\n\n      return () => clearTimeout(timeout);\n    }\n  }, [storeHydrated, user, session, profile]);\n\n  // Show loading only briefly, not indefinitely\n  if (!storeHydrated) {\n    if (process.env.NODE_ENV === 'development') {\n      // REMOVED: console.log statement for security\n    }\n    return <div suppressHydrationWarning><Loading fullScreen /></div>;\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    // REMOVED: console.log statement for security\n  }\n  return <>{children}</>;\n} "],"mappings":"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","ignoreList":[]}
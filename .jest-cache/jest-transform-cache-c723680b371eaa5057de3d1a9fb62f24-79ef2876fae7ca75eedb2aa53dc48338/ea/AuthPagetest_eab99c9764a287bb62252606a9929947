f8dd136ce7625565d49383040615f159
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
jest.mock('next/navigation', () => ({
    useRouter: () => ({ push: jest.fn() }),
    useSearchParams: () => ({
        get: (key) => (key === 'mode' ? mode : null),
    }),
}));
// Mock toast notifications to avoid side-effects in the test environment
jest.mock('sonner', () => ({ toast: { loading: jest.fn(), error: jest.fn(), success: jest.fn() } }));
jest.mock('@/hooks/useAuth', () => ({
    useAuth: () => ({
        signIn: (...args) => signInMock(...args),
        signUp: (...args) => signUpMock(...args),
        isLoading: false,
        hydrated: true,
        session: null,
        profile: null,
    }),
    useRedirectIfAuthenticated: () => ({ isLoading: false }),
}));
jest.mock('@/services/supabase/client', () => ({
    __esModule: true,
    default: { auth: {} },
}));
const react_1 = __importDefault(require("react"));
const user_event_1 = __importDefault(require("@testing-library/user-event"));
const utils_1 = require("../utils");
// Dynamically control the auth page mode via query param mock
let mode = 'register';
// Mock useAuth and related hook behaviour
const signInMock = jest.fn().mockResolvedValue({ data: { user: { id: '1', email: 'a@b.com' }, session: {} }, error: null });
const signUpMock = jest.fn().mockResolvedValue({ data: { user: { id: '2', email: 'a@b.com' }, session: {} }, error: null });
// Import after mocks are set up â€“ resolve default/named compatibly
// eslint-disable-next-line @typescript-eslint/no-var-requires
const AuthPageModule = require('@/app/auth/page');
const AuthPage = (AuthPageModule && (AuthPageModule.default || AuthPageModule.AuthPage)) || AuthPageModule;
describe('AuthPage component', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    it('shows error when passwords do not match during registration', async () => {
        // Debug export shape
        // eslint-disable-next-line no-console
        console.log('AuthPage export typeof:', typeof AuthPage, 'keys:', Object.keys(AuthPageModule || {}));
        mode = 'register';
        const user = user_event_1.default.setup();
        (0, utils_1.render)((0, jsx_runtime_1.jsx)(AuthPage, {}));
        await user.type(utils_1.screen.getByLabelText('Email address'), 'test@example.com');
        await user.type(utils_1.screen.getByLabelText('Password'), 'password1');
        await user.type(utils_1.screen.getByLabelText('Confirm Password'), 'password2');
        await user.click(utils_1.screen.getByRole('button', { name: /Create account/i }));
        expect(await utils_1.screen.findByText(/Passwords do not match/i)).toBeInTheDocument();
        expect(signUpMock).not.toHaveBeenCalled();
    });
    it('invokes signIn on valid login submission', async () => {
        mode = 'login';
        const user = user_event_1.default.setup();
        (0, utils_1.render)((0, jsx_runtime_1.jsx)(AuthPage, {}));
        await user.type(utils_1.screen.getByLabelText('Email address'), 'login@example.com');
        await user.type(utils_1.screen.getByLabelText('Password'), 'super-secret');
        await user.click(utils_1.screen.getByRole('button', { name: /Sign in/i }));
        await (0, utils_1.waitFor)(() => expect(signInMock).toHaveBeenCalledWith('login@example.com', 'super-secret'));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDLGdCQUFnQixFQUFFLENBQUE7SUFDM0MsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDeEQsSUFBSSxHQUFHLE9BQU8sQ0FBQTtRQUNkLE1BQU0sSUFBSSxHQUFHLG9CQUFTLENBQUMsS0FBSyxFQUFFLENBQUE7UUFDOUIsSUFBQSxjQUFNLEVBQUMsdUJBQUMsUUFBUSxLQUFHLENBQUMsQ0FBQTtRQUVwQixNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBTSxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsRUFBRSxtQkFBbUIsQ0FBQyxDQUFBO1FBQzVFLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFBO1FBRWxFLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFFbEUsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsb0JBQW9CLENBQUMsbUJBQW1CLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQTtJQUNuRyxDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2cvZGV2L29yYW5nZWNhdC90ZXN0cy9hdXRoL0F1dGhQYWdlLnRlc3QudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB1c2VyRXZlbnQgZnJvbSAnQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50J1xuaW1wb3J0IHsgcmVuZGVyLCBzY3JlZW4sIHdhaXRGb3IgfSBmcm9tICcuLi91dGlscydcblxuLy8gRHluYW1pY2FsbHkgY29udHJvbCB0aGUgYXV0aCBwYWdlIG1vZGUgdmlhIHF1ZXJ5IHBhcmFtIG1vY2tcbmxldCBtb2RlOiAnbG9naW4nIHwgJ3JlZ2lzdGVyJyA9ICdyZWdpc3RlcidcblxuamVzdC5tb2NrKCduZXh0L25hdmlnYXRpb24nLCAoKSA9PiAoe1xuICB1c2VSb3V0ZXI6ICgpID0+ICh7IHB1c2g6IGplc3QuZm4oKSB9KSxcbiAgdXNlU2VhcmNoUGFyYW1zOiAoKSA9PiAoe1xuICAgIGdldDogKGtleTogc3RyaW5nKSA9PiAoa2V5ID09PSAnbW9kZScgPyBtb2RlIDogbnVsbCksXG4gIH0pLFxufSkpXG5cbi8vIE1vY2sgdG9hc3Qgbm90aWZpY2F0aW9ucyB0byBhdm9pZCBzaWRlLWVmZmVjdHMgaW4gdGhlIHRlc3QgZW52aXJvbm1lbnRcbmplc3QubW9jaygnc29ubmVyJywgKCkgPT4gKHsgdG9hc3Q6IHsgbG9hZGluZzogamVzdC5mbigpLCBlcnJvcjogamVzdC5mbigpLCBzdWNjZXNzOiBqZXN0LmZuKCkgfSB9KSlcblxuLy8gTW9jayB1c2VBdXRoIGFuZCByZWxhdGVkIGhvb2sgYmVoYXZpb3VyXG5jb25zdCBzaWduSW5Nb2NrID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgZGF0YTogeyB1c2VyOiB7IGlkOiAnMScsIGVtYWlsOiAnYUBiLmNvbScgfSwgc2Vzc2lvbjoge30gfSwgZXJyb3I6IG51bGwgfSlcbmNvbnN0IHNpZ25VcE1vY2sgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBkYXRhOiB7IHVzZXI6IHsgaWQ6ICcyJywgZW1haWw6ICdhQGIuY29tJyB9LCBzZXNzaW9uOiB7fSB9LCBlcnJvcjogbnVsbCB9KVxuXG5qZXN0Lm1vY2soJ0AvaG9va3MvdXNlQXV0aCcsICgpID0+ICh7XG4gIHVzZUF1dGg6ICgpID0+ICh7XG4gICAgc2lnbkluOiAoLi4uYXJnczogdW5rbm93bltdKSA9PiBzaWduSW5Nb2NrKC4uLmFyZ3MpLFxuICAgIHNpZ25VcDogKC4uLmFyZ3M6IHVua25vd25bXSkgPT4gc2lnblVwTW9jayguLi5hcmdzKSxcbiAgICBpc0xvYWRpbmc6IGZhbHNlLFxuICAgIGh5ZHJhdGVkOiB0cnVlLFxuICAgIHNlc3Npb246IG51bGwsXG4gICAgcHJvZmlsZTogbnVsbCxcbiAgfSksXG4gIHVzZVJlZGlyZWN0SWZBdXRoZW50aWNhdGVkOiAoKSA9PiAoeyBpc0xvYWRpbmc6IGZhbHNlIH0pLFxufSkpXG5cbmplc3QubW9jaygnQC9zZXJ2aWNlcy9zdXBhYmFzZS9jbGllbnQnLCAoKSA9PiAoe1xuICBfX2VzTW9kdWxlOiB0cnVlLFxuICBkZWZhdWx0OiB7IGF1dGg6IHt9IH0sXG59KSlcblxuLy8gSW1wb3J0IGFmdGVyIG1vY2tzIGFyZSBzZXQgdXAg4oCTIHJlc29sdmUgZGVmYXVsdC9uYW1lZCBjb21wYXRpYmx5XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXZhci1yZXF1aXJlc1xuY29uc3QgQXV0aFBhZ2VNb2R1bGUgPSByZXF1aXJlKCdAL2FwcC9hdXRoL3BhZ2UnKVxuY29uc3QgQXV0aFBhZ2UgPSAoQXV0aFBhZ2VNb2R1bGUgJiYgKEF1dGhQYWdlTW9kdWxlLmRlZmF1bHQgfHwgQXV0aFBhZ2VNb2R1bGUuQXV0aFBhZ2UpKSB8fCBBdXRoUGFnZU1vZHVsZVxuXG5kZXNjcmliZSgnQXV0aFBhZ2UgY29tcG9uZW50JywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKVxuICB9KVxuXG4gIGl0KCdzaG93cyBlcnJvciB3aGVuIHBhc3N3b3JkcyBkbyBub3QgbWF0Y2ggZHVyaW5nIHJlZ2lzdHJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAvLyBEZWJ1ZyBleHBvcnQgc2hhcGVcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgIGNvbnNvbGUubG9nKCdBdXRoUGFnZSBleHBvcnQgdHlwZW9mOicsIHR5cGVvZiBBdXRoUGFnZSwgJ2tleXM6JywgT2JqZWN0LmtleXMoQXV0aFBhZ2VNb2R1bGUgfHwge30pKVxuICAgIG1vZGUgPSAncmVnaXN0ZXInXG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgcmVuZGVyKDxBdXRoUGFnZSAvPilcblxuICAgIGF3YWl0IHVzZXIudHlwZShzY3JlZW4uZ2V0QnlMYWJlbFRleHQoJ0VtYWlsIGFkZHJlc3MnKSwgJ3Rlc3RAZXhhbXBsZS5jb20nKVxuICAgIGF3YWl0IHVzZXIudHlwZShzY3JlZW4uZ2V0QnlMYWJlbFRleHQoJ1Bhc3N3b3JkJyksICdwYXNzd29yZDEnKVxuICAgIGF3YWl0IHVzZXIudHlwZShzY3JlZW4uZ2V0QnlMYWJlbFRleHQoJ0NvbmZpcm0gUGFzc3dvcmQnKSwgJ3Bhc3N3b3JkMicpXG5cbiAgICBhd2FpdCB1c2VyLmNsaWNrKHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL0NyZWF0ZSBhY2NvdW50L2kgfSkpXG5cbiAgICBleHBlY3QoYXdhaXQgc2NyZWVuLmZpbmRCeVRleHQoL1Bhc3N3b3JkcyBkbyBub3QgbWF0Y2gvaSkpLnRvQmVJblRoZURvY3VtZW50KClcbiAgICBleHBlY3Qoc2lnblVwTW9jaykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICB9KVxuXG4gIGl0KCdpbnZva2VzIHNpZ25JbiBvbiB2YWxpZCBsb2dpbiBzdWJtaXNzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIG1vZGUgPSAnbG9naW4nXG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgcmVuZGVyKDxBdXRoUGFnZSAvPilcblxuICAgIGF3YWl0IHVzZXIudHlwZShzY3JlZW4uZ2V0QnlMYWJlbFRleHQoJ0VtYWlsIGFkZHJlc3MnKSwgJ2xvZ2luQGV4YW1wbGUuY29tJylcbiAgICBhd2FpdCB1c2VyLnR5cGUoc2NyZWVuLmdldEJ5TGFiZWxUZXh0KCdQYXNzd29yZCcpLCAnc3VwZXItc2VjcmV0JylcblxuICAgIGF3YWl0IHVzZXIuY2xpY2soc2NyZWVuLmdldEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvU2lnbiBpbi9pIH0pKVxuXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiBleHBlY3Qoc2lnbkluTW9jaykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2xvZ2luQGV4YW1wbGUuY29tJywgJ3N1cGVyLXNlY3JldCcpKVxuICB9KVxufSkgIl0sInZlcnNpb24iOjN9
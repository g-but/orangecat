{"version":3,"names":["exports","GET","server_1","cov_11v4q42qan","s","require","server_2","request","f","requestUrl","URL","url","code","searchParams","get","type","next","b","supabase","createServerClient","error","auth","exchangeCodeForSession","NextResponse","redirect","origin","encodeURIComponent","message","target"],"sources":["/home/g/dev/orangecat/src/app/auth/callback/route.ts"],"sourcesContent":["import { createServerClient } from '@/services/supabase/server'\nimport { NextResponse } from 'next/server'\n\nexport async function GET(request: Request) {\n  const requestUrl = new URL(request.url)\n  const code = requestUrl.searchParams.get('code')\n  const type = requestUrl.searchParams.get('type')\n  const next = requestUrl.searchParams.get('next') || '/'\n\n  if (code) {\n    try {\n      const supabase = await createServerClient()\n      const { error } = await supabase.auth.exchangeCodeForSession(code)\n      \n      if (error) {\n        // For password reset, redirect to reset page with error\n        if (type === 'recovery') {\n          return NextResponse.redirect(\n            `${requestUrl.origin}/auth/reset-password?error=${encodeURIComponent(error.message)}`\n          )\n        }\n        return NextResponse.redirect(\n          `${requestUrl.origin}/auth?error=${encodeURIComponent(error.message)}`\n        )\n      }\n\n      // For password reset flow, redirect to reset password page after successful code exchange\n      if (type === 'recovery') {\n        const target = requestUrl.searchParams.get('next') || '/auth/reset-password'\n        return NextResponse.redirect(`${requestUrl.origin}${target}`)\n      }\n\n      // For regular auth flow, redirect to the next page\n      return NextResponse.redirect(`${requestUrl.origin}${next}`)\n    } catch (error) {\n      // For password reset, redirect to reset page with error\n      if (type === 'recovery') {\n        return NextResponse.redirect(\n          `${requestUrl.origin}/auth/reset-password?error=${encodeURIComponent('An unexpected error occurred during password reset')}`\n        )\n      }\n      return NextResponse.redirect(\n        `${requestUrl.origin}/auth?error=${encodeURIComponent('An unexpected error occurred during authentication')}`\n      )\n    }\n  }\n\n  // Return the user to an error page with instructions\n  return NextResponse.redirect(\n    `${requestUrl.origin}/auth?error=${encodeURIComponent('No code provided')}`\n  )\n} "],"mappings":"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","ignoreList":[]}
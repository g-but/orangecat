de0485854eeba8c314d776cfa924f73a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isValidLightningAddressLegacy = exports.isValidBitcoinAddressLegacy = exports.sanitizeBioForDisplay = exports.isValidBio = exports.isValidUsername = exports.isValidLightningAddress = exports.isValidBitcoinAddress = void 0;
exports.normalizeUrl = normalizeUrl;
exports.validateUrl = validateUrl;
exports.isValidUrl = isValidUrl;
const verification_1 = require("./verification");
// Pre-compiled regex patterns for performance (avoid creating new regex objects on each call)
const BECH32_FORMAT_REGEX = /^bc1[02-9ac-hj-np-z]+$/;
const BASE58_FORMAT_REGEX = /^[13][1-9A-HJ-NP-Za-km-z]+$/;
const LIGHTNING_FORMAT_REGEX = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
// Enhanced Bitcoin address validation with comprehensive security
const isValidBitcoinAddress = (address) => {
    if (!address) {
        return { valid: false, error: 'Bitcoin address required' };
    }
    // 1. Prevent testnet addresses on mainnet (check before format validation)
    if (address.startsWith('tb1') || address.startsWith('bcrt1')) {
        return { valid: false, error: 'Testnet addresses not allowed' };
    }
    // 2. Check for known burn addresses FIRST (before format validation)
    const burnAddresses = [
        '1111111111111111111114oLvT2',
        '1BitcoinEaterAddressDontSendf59kuE',
        'bc1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq9424r'
    ];
    if (burnAddresses.includes(address)) {
        return { valid: false, error: 'Burn addresses not allowed' };
    }
    // 3. Basic format validation with proper character sets
    let formatRegex;
    if (address.startsWith('bc1')) {
        // Bech32 addresses: lowercase only, proper bech32 character set  
        // Valid bech32 chars: 0-9 and a-z except 1, b, i, o 
        formatRegex = BECH32_FORMAT_REGEX;
    }
    else if (address.startsWith('1') || address.startsWith('3')) {
        // Base58 addresses: exclude 0, O, I, l to prevent confusion
        formatRegex = BASE58_FORMAT_REGEX;
    }
    else {
        return { valid: false, error: 'Invalid Bitcoin address format' };
    }
    if (!formatRegex.test(address)) {
        return { valid: false, error: 'Invalid Bitcoin address format' };
    }
    // 3.5. Additional validation for specific invalid patterns
    if (address.startsWith('bc1')) {
        // Reject addresses with invalid bech32 patterns
        // But allow Taproot addresses (bc1p) to have different rules
        if (address.startsWith('bc1q') && address.endsWith('0')) {
            return { valid: false, error: 'Invalid Bitcoin address format' };
        }
        if (address.includes('0I') || address.includes('Ol')) {
            return { valid: false, error: 'Invalid Bitcoin address format' };
        }
    }
    else {
        // Reject Base58 addresses with confusing character combinations
        if (address.includes('0O') || address.includes('Il') || address.includes('I0')) {
            return { valid: false, error: 'Invalid Bitcoin address format' };
        }
    }
    // 4. Length validation by address type
    if (address.startsWith('bc1')) {
        // Bech32 (SegWit) addresses - more strict validation
        // P2WPKH: exactly 42 chars, P2WSH: exactly 62 chars, Taproot: exactly 62 chars
        // Anything else in between is likely invalid
        if (address.length < 42 || address.length > 62) {
            return { valid: false, error: 'Invalid bech32 address length' };
        }
        // Additional check: reject addresses that are not standard lengths
        if (address.length !== 42 && address.length !== 62) {
            return { valid: false, error: 'Invalid bech32 address length' };
        }
    }
    else if (address.startsWith('3')) {
        // P2SH addresses (SegWit wrapped)
        if (address.length !== 34) {
            return { valid: false, error: 'Invalid P2SH address length' };
        }
    }
    else if (address.startsWith('1')) {
        // Legacy P2PKH addresses
        if (address.length !== 34) {
            return { valid: false, error: 'Invalid P2PKH address length' };
        }
    }
    return { valid: true };
};
exports.isValidBitcoinAddress = isValidBitcoinAddress;
// Enhanced Lightning address validation with security checks
const isValidLightningAddress = (address) => {
    if (!address) {
        return { valid: false, error: 'Lightning address required' };
    }
    // 1. Prevent local/private addresses (check before format validation)
    const domain = address.split('@')[1];
    if (domain) {
        const forbiddenDomains = ['localhost', '127.0.0.1', '0.0.0.0', '10.', '192.168.', '172.'];
        if (forbiddenDomains.some(forbidden => domain.includes(forbidden))) {
            return { valid: false, error: 'Local addresses not allowed' };
        }
    }
    // 2. Basic format validation
    if (!LIGHTNING_FORMAT_REGEX.test(address)) {
        return { valid: false, error: 'Invalid Lightning address format' };
    }
    // 3. Domain length validation
    if (domain && domain.length > 253) {
        return { valid: false, error: 'Domain name too long' };
    }
    // 4. Prevent obviously suspicious domains
    const suspiciousDomains = ['tempmail', 'guerrillamail', '10minutemail', 'throwaway'];
    if (domain && suspiciousDomains.some(suspicious => domain.toLowerCase().includes(suspicious))) {
        return { valid: false, error: 'Temporary email domains not allowed' };
    }
    return { valid: true };
};
exports.isValidLightningAddress = isValidLightningAddress;
// Enhanced username validation with anti-impersonation protection
const isValidUsername = (username) => {
    if (!username) {
        return { valid: false, error: 'Username required' };
    }
    // 1. Length validation
    if (username.length < 3) {
        return { valid: false, error: 'Username must be at least 3 characters long' };
    }
    if (username.length > 30) {
        return { valid: false, error: 'Username must be 30 characters or less' };
    }
    // 2. Check for Unicode attacks and character substitutions FIRST
    // Check for non-ASCII characters that could be lookalikes
    if (!/^[\x00-\x7F]*$/.test(username)) {
        return { valid: false, error: 'Cyrillic, Greek, and other non-ASCII characters not allowed' };
    }
    // 3. Character validation (after Unicode check)
    const usernameRegex = /^[a-zA-Z0-9_-]+$/;
    if (!usernameRegex.test(username)) {
        return { valid: false, error: 'Username can only contain letters, numbers, hyphens, and underscores' };
    }
    // 4. Check for protected usernames using the verification system
    const protectionCheck = (0, verification_1.isProtectedUsername)(username);
    if (protectionCheck.isProtected) {
        return {
            valid: false,
            error: protectionCheck.reason || 'Username is protected',
            suggestedAlternatives: protectionCheck.suggestedAlternatives
        };
    }
    // 5. Reserved usernames (platform-specific)
    const reservedUsernames = [
        'admin', 'administrator', 'root', 'mod', 'moderator', 'support',
        'help', 'api', 'www', 'mail', 'email', 'official', 'verified',
        'staff', 'team', 'orangecat', 'orange-cat', 'orange_cat'
    ];
    if (reservedUsernames.includes(username.toLowerCase())) {
        return { valid: false, error: 'Username is reserved' };
    }
    // 6. Check for character substitution patterns that might be celebrity impersonation
    // Common substitutions: 0->o, 3->e, 4->a, 1->i, 5->s, etc.
    const substitutionMap = {
        '0': 'o', '3': 'e', '4': 'a', '1': 'i', '5': 's', '6': 'g', '7': 't', '9': 'g'
    };
    // Create a version with substitutions reversed to check against protected names
    let substitutionReversed = username.toLowerCase();
    for (const [num, letter] of Object.entries(substitutionMap)) {
        substitutionReversed = substitutionReversed.replace(new RegExp(num, 'g'), letter);
    }
    // If the substitution-reversed version is protected, block it
    if (substitutionReversed !== username.toLowerCase()) {
        const celebrityCheck = (0, verification_1.isProtectedUsername)(substitutionReversed);
        if (celebrityCheck.isProtected) {
            return {
                valid: false,
                error: 'Username resembles protected celebrity name',
                suggestedAlternatives: celebrityCheck.suggestedAlternatives
            };
        }
    }
    return { valid: true };
};
exports.isValidUsername = isValidUsername;
// Enhanced bio content validation and sanitization
const isValidBio = (bio) => {
    if (!bio) {
        return { valid: true }; // Bio is optional
    }
    // 1. Length limits
    if (bio.length > 500) {
        return { valid: false, error: 'Bio must be under 500 characters' };
    }
    // 2. HTML/Script injection prevention
    const dangerousPatterns = [
        /<script[^>]*>.*?<\/script>/gi,
        /javascript:/gi,
        /on\w+\s*=/gi, // onclick, onload, etc.
        /<iframe/gi,
        /<object/gi,
        /<embed/gi,
        /<link/gi,
        /<meta/gi
    ];
    for (const pattern of dangerousPatterns) {
        if (pattern.test(bio)) {
            return { valid: false, error: 'Bio contains prohibited content' };
        }
    }
    // 3. Prevent alternative Bitcoin address injection
    const btcAddressPattern = /\b(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,62}\b/g;
    const foundAddresses = bio.match(btcAddressPattern);
    if (foundAddresses && foundAddresses.length > 0) {
        return { valid: false, error: 'Bitcoin addresses not allowed in bio' };
    }
    // 4. Prevent verification badge spoofing (check before authority terms)
    const verificationSpoof = /(verified|official|certified|authentic).*[✓✔☑]|[✓✔☑].*(verified|official|certified|authentic)/gi;
    if (verificationSpoof.test(bio)) {
        return { valid: false, error: 'Verification claims not allowed' };
    }
    // 5. Prevent authority impersonation
    const authorityTerms = [
        'official bitcoin', 'bitcoin foundation', 'bitcoin core',
        'satoshi nakamoto', 'bitcoin developer', 'core developer',
        'lightning labs', 'blockstream', 'bitcoin.org'
    ];
    const bioLower = bio.toLowerCase();
    for (const term of authorityTerms) {
        if (bioLower.includes(term)) {
            return { valid: false, error: 'Authority claims not allowed in bio' };
        }
    }
    // 6. Use verification system for additional impersonation checks
    const impersonationCheck = (0, verification_1.validateBioForImpersonation)(bio);
    if (!impersonationCheck.valid) {
        return impersonationCheck;
    }
    // 7. Additional celebrity impersonation detection
    const celebrityImpersonationPatterns = [
        /i am (elon|jack|satoshi|michael|andreas)/i,
        /this is (elon|jack|satoshi|michael|andreas)/i,
        /real (elon|jack|satoshi|michael|andreas)/i,
        /actual (elon|jack|satoshi|michael|andreas)/i,
        /genuine (elon|jack|satoshi|michael|andreas)/i,
        /not fake.*i am/i
    ];
    for (const pattern of celebrityImpersonationPatterns) {
        if (pattern.test(bio)) {
            return { valid: false, error: 'Celebrity impersonation claims not allowed' };
        }
    }
    return { valid: true };
};
exports.isValidBio = isValidBio;
// Client-side sanitization for bio display (additional security layer)
const sanitizeBioForDisplay = (bio) => {
    if (!bio)
        return '';
    return bio
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#x27;')
        .replace(/\//g, '&#x2F;');
};
exports.sanitizeBioForDisplay = sanitizeBioForDisplay;
// Legacy compatibility functions (maintain existing API)
const isValidBitcoinAddressLegacy = (address) => {
    const result = (0, exports.isValidBitcoinAddress)(address);
    return result.valid;
};
exports.isValidBitcoinAddressLegacy = isValidBitcoinAddressLegacy;
const isValidLightningAddressLegacy = (address) => {
    const result = (0, exports.isValidLightningAddress)(address);
    return result.valid;
};
exports.isValidLightningAddressLegacy = isValidLightningAddressLegacy;
// URL validation utilities for seamless user experience
function normalizeUrl(url) {
    if (!url.trim())
        return '';
    let normalized = url.trim();
    // Remove any surrounding quotes or spaces
    normalized = normalized.replace(/^["'\s]+|["'\s]+$/g, '');
    // If it doesn't start with a protocol, add https://
    if (normalized && !normalized.match(/^https?:\/\//i)) {
        normalized = `https://${normalized}`;
    }
    return normalized;
}
function validateUrl(url) {
    if (!url.trim()) {
        return { isValid: true, normalized: '' }; // Empty is valid (optional field)
    }
    const normalized = normalizeUrl(url);
    try {
        const urlObj = new URL(normalized);
        // Check if it's a valid HTTP/HTTPS URL
        if (!['http:', 'https:'].includes(urlObj.protocol)) {
            return {
                isValid: false,
                normalized,
                error: 'URL must use http:// or https://'
            };
        }
        // Check if hostname exists
        if (!urlObj.hostname || urlObj.hostname.length < 3) {
            return {
                isValid: false,
                normalized,
                error: 'Please enter a valid domain name'
            };
        }
        return { isValid: true, normalized };
    }
    catch (error) {
        return {
            isValid: false,
            normalized,
            error: 'Please enter a valid URL'
        };
    }
}
function isValidUrl(url) {
    return validateUrl(url).isValid;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUssRUFBRSwwQkFBMEI7U0FDbEMsQ0FBQTtJQUNILENBQUM7QUFDSCxDQUFDO0FBRUQsU0FBZ0IsVUFBVSxDQUFDLEdBQVc7SUFDcEMsT0FBTyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFBO0FBQ2pDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy91dGlscy92YWxpZGF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGlzUHJvdGVjdGVkVXNlcm5hbWUsIHZhbGlkYXRlQmlvRm9ySW1wZXJzb25hdGlvbiB9IGZyb20gJy4vdmVyaWZpY2F0aW9uJztcblxuLy8gUHJlLWNvbXBpbGVkIHJlZ2V4IHBhdHRlcm5zIGZvciBwZXJmb3JtYW5jZSAoYXZvaWQgY3JlYXRpbmcgbmV3IHJlZ2V4IG9iamVjdHMgb24gZWFjaCBjYWxsKVxuY29uc3QgQkVDSDMyX0ZPUk1BVF9SRUdFWCA9IC9eYmMxWzAyLTlhYy1oai1ucC16XSskLztcbmNvbnN0IEJBU0U1OF9GT1JNQVRfUkVHRVggPSAvXlsxM11bMS05QS1ISi1OUC1aYS1rbS16XSskLztcbmNvbnN0IExJR0hUTklOR19GT1JNQVRfUkVHRVggPSAvXlthLXpBLVowLTkuXyUrLV0rQFthLXpBLVowLTkuLV0rXFwuW2EtekEtWl17Mix9JC87XG5cbi8vIEVuaGFuY2VkIEJpdGNvaW4gYWRkcmVzcyB2YWxpZGF0aW9uIHdpdGggY29tcHJlaGVuc2l2ZSBzZWN1cml0eVxuZXhwb3J0IGNvbnN0IGlzVmFsaWRCaXRjb2luQWRkcmVzcyA9IChhZGRyZXNzOiBzdHJpbmcpOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9ID0+IHtcbiAgaWYgKCFhZGRyZXNzKSB7XG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0JpdGNvaW4gYWRkcmVzcyByZXF1aXJlZCcgfTtcbiAgfVxuXG4gIC8vIDEuIFByZXZlbnQgdGVzdG5ldCBhZGRyZXNzZXMgb24gbWFpbm5ldCAoY2hlY2sgYmVmb3JlIGZvcm1hdCB2YWxpZGF0aW9uKVxuICBpZiAoYWRkcmVzcy5zdGFydHNXaXRoKCd0YjEnKSB8fCBhZGRyZXNzLnN0YXJ0c1dpdGgoJ2JjcnQxJykpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGVzdG5ldCBhZGRyZXNzZXMgbm90IGFsbG93ZWQnIH07XG4gIH1cblxuICAvLyAyLiBDaGVjayBmb3Iga25vd24gYnVybiBhZGRyZXNzZXMgRklSU1QgKGJlZm9yZSBmb3JtYXQgdmFsaWRhdGlvbilcbiAgY29uc3QgYnVybkFkZHJlc3NlcyA9IFtcbiAgICAnMTExMTExMTExMTExMTExMTExMTExNG9MdlQyJyxcbiAgICAnMUJpdGNvaW5FYXRlckFkZHJlc3NEb250U2VuZGY1OWt1RScsXG4gICAgJ2JjMXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcTk0MjRyJ1xuICBdO1xuICBpZiAoYnVybkFkZHJlc3Nlcy5pbmNsdWRlcyhhZGRyZXNzKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdCdXJuIGFkZHJlc3NlcyBub3QgYWxsb3dlZCcgfTtcbiAgfVxuXG4gIC8vIDMuIEJhc2ljIGZvcm1hdCB2YWxpZGF0aW9uIHdpdGggcHJvcGVyIGNoYXJhY3RlciBzZXRzXG4gIGxldCBmb3JtYXRSZWdleDogUmVnRXhwO1xuICBcbiAgaWYgKGFkZHJlc3Muc3RhcnRzV2l0aCgnYmMxJykpIHtcbiAgICAvLyBCZWNoMzIgYWRkcmVzc2VzOiBsb3dlcmNhc2Ugb25seSwgcHJvcGVyIGJlY2gzMiBjaGFyYWN0ZXIgc2V0ICBcbiAgICAvLyBWYWxpZCBiZWNoMzIgY2hhcnM6IDAtOSBhbmQgYS16IGV4Y2VwdCAxLCBiLCBpLCBvIFxuICAgIGZvcm1hdFJlZ2V4ID0gQkVDSDMyX0ZPUk1BVF9SRUdFWDtcbiAgfSBlbHNlIGlmIChhZGRyZXNzLnN0YXJ0c1dpdGgoJzEnKSB8fCBhZGRyZXNzLnN0YXJ0c1dpdGgoJzMnKSkge1xuICAgIC8vIEJhc2U1OCBhZGRyZXNzZXM6IGV4Y2x1ZGUgMCwgTywgSSwgbCB0byBwcmV2ZW50IGNvbmZ1c2lvblxuICAgIGZvcm1hdFJlZ2V4ID0gQkFTRTU4X0ZPUk1BVF9SRUdFWDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBCaXRjb2luIGFkZHJlc3MgZm9ybWF0JyB9O1xuICB9XG4gIFxuICBpZiAoIWZvcm1hdFJlZ2V4LnRlc3QoYWRkcmVzcykpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBCaXRjb2luIGFkZHJlc3MgZm9ybWF0JyB9O1xuICB9XG5cbiAgLy8gMy41LiBBZGRpdGlvbmFsIHZhbGlkYXRpb24gZm9yIHNwZWNpZmljIGludmFsaWQgcGF0dGVybnNcbiAgaWYgKGFkZHJlc3Muc3RhcnRzV2l0aCgnYmMxJykpIHtcbiAgICAvLyBSZWplY3QgYWRkcmVzc2VzIHdpdGggaW52YWxpZCBiZWNoMzIgcGF0dGVybnNcbiAgICAvLyBCdXQgYWxsb3cgVGFwcm9vdCBhZGRyZXNzZXMgKGJjMXApIHRvIGhhdmUgZGlmZmVyZW50IHJ1bGVzXG4gICAgaWYgKGFkZHJlc3Muc3RhcnRzV2l0aCgnYmMxcScpICYmIGFkZHJlc3MuZW5kc1dpdGgoJzAnKSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgQml0Y29pbiBhZGRyZXNzIGZvcm1hdCcgfTtcbiAgICB9XG4gICAgaWYgKGFkZHJlc3MuaW5jbHVkZXMoJzBJJykgfHwgYWRkcmVzcy5pbmNsdWRlcygnT2wnKSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgQml0Y29pbiBhZGRyZXNzIGZvcm1hdCcgfTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gUmVqZWN0IEJhc2U1OCBhZGRyZXNzZXMgd2l0aCBjb25mdXNpbmcgY2hhcmFjdGVyIGNvbWJpbmF0aW9uc1xuICAgIGlmIChhZGRyZXNzLmluY2x1ZGVzKCcwTycpIHx8IGFkZHJlc3MuaW5jbHVkZXMoJ0lsJykgfHwgYWRkcmVzcy5pbmNsdWRlcygnSTAnKSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgQml0Y29pbiBhZGRyZXNzIGZvcm1hdCcgfTtcbiAgICB9XG4gIH1cblxuICAvLyA0LiBMZW5ndGggdmFsaWRhdGlvbiBieSBhZGRyZXNzIHR5cGVcbiAgaWYgKGFkZHJlc3Muc3RhcnRzV2l0aCgnYmMxJykpIHtcbiAgICAvLyBCZWNoMzIgKFNlZ1dpdCkgYWRkcmVzc2VzIC0gbW9yZSBzdHJpY3QgdmFsaWRhdGlvblxuICAgIC8vIFAyV1BLSDogZXhhY3RseSA0MiBjaGFycywgUDJXU0g6IGV4YWN0bHkgNjIgY2hhcnMsIFRhcHJvb3Q6IGV4YWN0bHkgNjIgY2hhcnNcbiAgICAvLyBBbnl0aGluZyBlbHNlIGluIGJldHdlZW4gaXMgbGlrZWx5IGludmFsaWRcbiAgICBpZiAoYWRkcmVzcy5sZW5ndGggPCA0MiB8fCBhZGRyZXNzLmxlbmd0aCA+IDYyKSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBiZWNoMzIgYWRkcmVzcyBsZW5ndGgnIH07XG4gICAgfVxuICAgIC8vIEFkZGl0aW9uYWwgY2hlY2s6IHJlamVjdCBhZGRyZXNzZXMgdGhhdCBhcmUgbm90IHN0YW5kYXJkIGxlbmd0aHNcbiAgICBpZiAoYWRkcmVzcy5sZW5ndGggIT09IDQyICYmIGFkZHJlc3MubGVuZ3RoICE9PSA2Mikge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgYmVjaDMyIGFkZHJlc3MgbGVuZ3RoJyB9O1xuICAgIH1cbiAgfSBlbHNlIGlmIChhZGRyZXNzLnN0YXJ0c1dpdGgoJzMnKSkge1xuICAgIC8vIFAyU0ggYWRkcmVzc2VzIChTZWdXaXQgd3JhcHBlZClcbiAgICBpZiAoYWRkcmVzcy5sZW5ndGggIT09IDM0KSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBQMlNIIGFkZHJlc3MgbGVuZ3RoJyB9O1xuICAgIH1cbiAgfSBlbHNlIGlmIChhZGRyZXNzLnN0YXJ0c1dpdGgoJzEnKSkge1xuICAgIC8vIExlZ2FjeSBQMlBLSCBhZGRyZXNzZXNcbiAgICBpZiAoYWRkcmVzcy5sZW5ndGggIT09IDM0KSB7XG4gICAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBQMlBLSCBhZGRyZXNzIGxlbmd0aCcgfTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9O1xufTtcblxuLy8gRW5oYW5jZWQgTGlnaHRuaW5nIGFkZHJlc3MgdmFsaWRhdGlvbiB3aXRoIHNlY3VyaXR5IGNoZWNrc1xuZXhwb3J0IGNvbnN0IGlzVmFsaWRMaWdodG5pbmdBZGRyZXNzID0gKGFkZHJlc3M6IHN0cmluZyk6IHsgdmFsaWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0gPT4ge1xuICBpZiAoIWFkZHJlc3MpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnTGlnaHRuaW5nIGFkZHJlc3MgcmVxdWlyZWQnIH07XG4gIH1cblxuICAvLyAxLiBQcmV2ZW50IGxvY2FsL3ByaXZhdGUgYWRkcmVzc2VzIChjaGVjayBiZWZvcmUgZm9ybWF0IHZhbGlkYXRpb24pXG4gIGNvbnN0IGRvbWFpbiA9IGFkZHJlc3Muc3BsaXQoJ0AnKVsxXTtcbiAgaWYgKGRvbWFpbikge1xuICAgIGNvbnN0IGZvcmJpZGRlbkRvbWFpbnMgPSBbJ2xvY2FsaG9zdCcsICcxMjcuMC4wLjEnLCAnMC4wLjAuMCcsICcxMC4nLCAnMTkyLjE2OC4nLCAnMTcyLiddO1xuICAgIGlmIChmb3JiaWRkZW5Eb21haW5zLnNvbWUoZm9yYmlkZGVuID0+IGRvbWFpbi5pbmNsdWRlcyhmb3JiaWRkZW4pKSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0xvY2FsIGFkZHJlc3NlcyBub3QgYWxsb3dlZCcgfTtcbiAgICB9XG4gIH1cblxuICAvLyAyLiBCYXNpYyBmb3JtYXQgdmFsaWRhdGlvblxuICBpZiAoIUxJR0hUTklOR19GT1JNQVRfUkVHRVgudGVzdChhZGRyZXNzKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIExpZ2h0bmluZyBhZGRyZXNzIGZvcm1hdCcgfTtcbiAgfVxuXG4gIC8vIDMuIERvbWFpbiBsZW5ndGggdmFsaWRhdGlvblxuICBpZiAoZG9tYWluICYmIGRvbWFpbi5sZW5ndGggPiAyNTMpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnRG9tYWluIG5hbWUgdG9vIGxvbmcnIH07XG4gIH1cblxuICAvLyA0LiBQcmV2ZW50IG9idmlvdXNseSBzdXNwaWNpb3VzIGRvbWFpbnNcbiAgY29uc3Qgc3VzcGljaW91c0RvbWFpbnMgPSBbJ3RlbXBtYWlsJywgJ2d1ZXJyaWxsYW1haWwnLCAnMTBtaW51dGVtYWlsJywgJ3Rocm93YXdheSddO1xuICBpZiAoZG9tYWluICYmIHN1c3BpY2lvdXNEb21haW5zLnNvbWUoc3VzcGljaW91cyA9PiBkb21haW4udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzdXNwaWNpb3VzKSkpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVGVtcG9yYXJ5IGVtYWlsIGRvbWFpbnMgbm90IGFsbG93ZWQnIH07XG4gIH1cblxuICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9O1xufTtcblxuLy8gRW5oYW5jZWQgdXNlcm5hbWUgdmFsaWRhdGlvbiB3aXRoIGFudGktaW1wZXJzb25hdGlvbiBwcm90ZWN0aW9uXG5leHBvcnQgY29uc3QgaXNWYWxpZFVzZXJuYW1lID0gKHVzZXJuYW1lOiBzdHJpbmcpOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZzsgc3VnZ2VzdGVkQWx0ZXJuYXRpdmVzPzogc3RyaW5nW10gfSA9PiB7XG4gIGlmICghdXNlcm5hbWUpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnVXNlcm5hbWUgcmVxdWlyZWQnIH07XG4gIH1cblxuICAvLyAxLiBMZW5ndGggdmFsaWRhdGlvblxuICBpZiAodXNlcm5hbWUubGVuZ3RoIDwgMykge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdVc2VybmFtZSBtdXN0IGJlIGF0IGxlYXN0IDMgY2hhcmFjdGVycyBsb25nJyB9O1xuICB9XG4gIGlmICh1c2VybmFtZS5sZW5ndGggPiAzMCkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdVc2VybmFtZSBtdXN0IGJlIDMwIGNoYXJhY3RlcnMgb3IgbGVzcycgfTtcbiAgfVxuXG4gIC8vIDIuIENoZWNrIGZvciBVbmljb2RlIGF0dGFja3MgYW5kIGNoYXJhY3RlciBzdWJzdGl0dXRpb25zIEZJUlNUXG4gIC8vIENoZWNrIGZvciBub24tQVNDSUkgY2hhcmFjdGVycyB0aGF0IGNvdWxkIGJlIGxvb2thbGlrZXNcbiAgaWYgKCEvXltcXHgwMC1cXHg3Rl0qJC8udGVzdCh1c2VybmFtZSkpIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnQ3lyaWxsaWMsIEdyZWVrLCBhbmQgb3RoZXIgbm9uLUFTQ0lJIGNoYXJhY3RlcnMgbm90IGFsbG93ZWQnIH07XG4gIH1cblxuICAvLyAzLiBDaGFyYWN0ZXIgdmFsaWRhdGlvbiAoYWZ0ZXIgVW5pY29kZSBjaGVjaylcbiAgY29uc3QgdXNlcm5hbWVSZWdleCA9IC9eW2EtekEtWjAtOV8tXSskLztcbiAgaWYgKCF1c2VybmFtZVJlZ2V4LnRlc3QodXNlcm5hbWUpKSB7XG4gICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ1VzZXJuYW1lIGNhbiBvbmx5IGNvbnRhaW4gbGV0dGVycywgbnVtYmVycywgaHlwaGVucywgYW5kIHVuZGVyc2NvcmVzJyB9O1xuICB9XG5cbiAgLy8gNC4gQ2hlY2sgZm9yIHByb3RlY3RlZCB1c2VybmFtZXMgdXNpbmcgdGhlIHZlcmlmaWNhdGlvbiBzeXN0ZW1cbiAgY29uc3QgcHJvdGVjdGlvbkNoZWNrID0gaXNQcm90ZWN0ZWRVc2VybmFtZSh1c2VybmFtZSk7XG4gIGlmIChwcm90ZWN0aW9uQ2hlY2suaXNQcm90ZWN0ZWQpIHtcbiAgICByZXR1cm4geyBcbiAgICAgIHZhbGlkOiBmYWxzZSwgXG4gICAgICBlcnJvcjogcHJvdGVjdGlvbkNoZWNrLnJlYXNvbiB8fCAnVXNlcm5hbWUgaXMgcHJvdGVjdGVkJyxcbiAgICAgIHN1Z2dlc3RlZEFsdGVybmF0aXZlczogcHJvdGVjdGlvbkNoZWNrLnN1Z2dlc3RlZEFsdGVybmF0aXZlc1xuICAgIH07XG4gIH1cblxuICAvLyA1LiBSZXNlcnZlZCB1c2VybmFtZXMgKHBsYXRmb3JtLXNwZWNpZmljKVxuICBjb25zdCByZXNlcnZlZFVzZXJuYW1lcyA9IFtcbiAgICAnYWRtaW4nLCAnYWRtaW5pc3RyYXRvcicsICdyb290JywgJ21vZCcsICdtb2RlcmF0b3InLCAnc3VwcG9ydCcsXG4gICAgJ2hlbHAnLCAnYXBpJywgJ3d3dycsICdtYWlsJywgJ2VtYWlsJywgJ29mZmljaWFsJywgJ3ZlcmlmaWVkJywgXG4gICAgJ3N0YWZmJywgJ3RlYW0nLCAnb3JhbmdlY2F0JywgJ29yYW5nZS1jYXQnLCAnb3JhbmdlX2NhdCdcbiAgXTtcbiAgXG4gIGlmIChyZXNlcnZlZFVzZXJuYW1lcy5pbmNsdWRlcyh1c2VybmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdVc2VybmFtZSBpcyByZXNlcnZlZCcgfTtcbiAgfVxuXG4gIC8vIDYuIENoZWNrIGZvciBjaGFyYWN0ZXIgc3Vic3RpdHV0aW9uIHBhdHRlcm5zIHRoYXQgbWlnaHQgYmUgY2VsZWJyaXR5IGltcGVyc29uYXRpb25cbiAgLy8gQ29tbW9uIHN1YnN0aXR1dGlvbnM6IDAtPm8sIDMtPmUsIDQtPmEsIDEtPmksIDUtPnMsIGV0Yy5cbiAgY29uc3Qgc3Vic3RpdHV0aW9uTWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICcwJzogJ28nLCAnMyc6ICdlJywgJzQnOiAnYScsICcxJzogJ2knLCAnNSc6ICdzJywgJzYnOiAnZycsICc3JzogJ3QnLCAnOSc6ICdnJ1xuICB9O1xuICBcbiAgLy8gQ3JlYXRlIGEgdmVyc2lvbiB3aXRoIHN1YnN0aXR1dGlvbnMgcmV2ZXJzZWQgdG8gY2hlY2sgYWdhaW5zdCBwcm90ZWN0ZWQgbmFtZXNcbiAgbGV0IHN1YnN0aXR1dGlvblJldmVyc2VkID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgZm9yIChjb25zdCBbbnVtLCBsZXR0ZXJdIG9mIE9iamVjdC5lbnRyaWVzKHN1YnN0aXR1dGlvbk1hcCkpIHtcbiAgICBzdWJzdGl0dXRpb25SZXZlcnNlZCA9IHN1YnN0aXR1dGlvblJldmVyc2VkLnJlcGxhY2UobmV3IFJlZ0V4cChudW0sICdnJyksIGxldHRlcik7XG4gIH1cbiAgXG4gIC8vIElmIHRoZSBzdWJzdGl0dXRpb24tcmV2ZXJzZWQgdmVyc2lvbiBpcyBwcm90ZWN0ZWQsIGJsb2NrIGl0XG4gIGlmIChzdWJzdGl0dXRpb25SZXZlcnNlZCAhPT0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKSkge1xuICAgIGNvbnN0IGNlbGVicml0eUNoZWNrID0gaXNQcm90ZWN0ZWRVc2VybmFtZShzdWJzdGl0dXRpb25SZXZlcnNlZCk7XG4gICAgaWYgKGNlbGVicml0eUNoZWNrLmlzUHJvdGVjdGVkKSB7XG4gICAgICByZXR1cm4geyBcbiAgICAgICAgdmFsaWQ6IGZhbHNlLCBcbiAgICAgICAgZXJyb3I6ICdVc2VybmFtZSByZXNlbWJsZXMgcHJvdGVjdGVkIGNlbGVicml0eSBuYW1lJyxcbiAgICAgICAgc3VnZ2VzdGVkQWx0ZXJuYXRpdmVzOiBjZWxlYnJpdHlDaGVjay5zdWdnZXN0ZWRBbHRlcm5hdGl2ZXNcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUgfTtcbn07XG5cbi8vIEVuaGFuY2VkIGJpbyBjb250ZW50IHZhbGlkYXRpb24gYW5kIHNhbml0aXphdGlvblxuZXhwb3J0IGNvbnN0IGlzVmFsaWRCaW8gPSAoYmlvOiBzdHJpbmcpOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcj86IHN0cmluZyB9ID0+IHtcbiAgaWYgKCFiaW8pIHtcbiAgICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9OyAvLyBCaW8gaXMgb3B0aW9uYWxcbiAgfVxuXG4gIC8vIDEuIExlbmd0aCBsaW1pdHNcbiAgaWYgKGJpby5sZW5ndGggPiA1MDApIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnQmlvIG11c3QgYmUgdW5kZXIgNTAwIGNoYXJhY3RlcnMnIH07XG4gIH1cblxuICAvLyAyLiBIVE1ML1NjcmlwdCBpbmplY3Rpb24gcHJldmVudGlvblxuICBjb25zdCBkYW5nZXJvdXNQYXR0ZXJucyA9IFtcbiAgICAvPHNjcmlwdFtePl0qPi4qPzxcXC9zY3JpcHQ+L2dpLFxuICAgIC9qYXZhc2NyaXB0Oi9naSxcbiAgICAvb25cXHcrXFxzKj0vZ2ksICAvLyBvbmNsaWNrLCBvbmxvYWQsIGV0Yy5cbiAgICAvPGlmcmFtZS9naSxcbiAgICAvPG9iamVjdC9naSxcbiAgICAvPGVtYmVkL2dpLFxuICAgIC88bGluay9naSxcbiAgICAvPG1ldGEvZ2lcbiAgXTtcblxuICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgZGFuZ2Vyb3VzUGF0dGVybnMpIHtcbiAgICBpZiAocGF0dGVybi50ZXN0KGJpbykpIHtcbiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdCaW8gY29udGFpbnMgcHJvaGliaXRlZCBjb250ZW50JyB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIDMuIFByZXZlbnQgYWx0ZXJuYXRpdmUgQml0Y29pbiBhZGRyZXNzIGluamVjdGlvblxuICBjb25zdCBidGNBZGRyZXNzUGF0dGVybiA9IC9cXGIoYmMxfFsxM10pW2EtekEtSEotTlAtWjAtOV17MjUsNjJ9XFxiL2c7XG4gIGNvbnN0IGZvdW5kQWRkcmVzc2VzID0gYmlvLm1hdGNoKGJ0Y0FkZHJlc3NQYXR0ZXJuKTtcbiAgaWYgKGZvdW5kQWRkcmVzc2VzICYmIGZvdW5kQWRkcmVzc2VzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4geyB2YWxpZDogZmFsc2UsIGVycm9yOiAnQml0Y29pbiBhZGRyZXNzZXMgbm90IGFsbG93ZWQgaW4gYmlvJyB9O1xuICB9XG5cbiAgLy8gNC4gUHJldmVudCB2ZXJpZmljYXRpb24gYmFkZ2Ugc3Bvb2ZpbmcgKGNoZWNrIGJlZm9yZSBhdXRob3JpdHkgdGVybXMpXG4gIGNvbnN0IHZlcmlmaWNhdGlvblNwb29mID0gLyh2ZXJpZmllZHxvZmZpY2lhbHxjZXJ0aWZpZWR8YXV0aGVudGljKS4qW+Kck+KclOKYkV18W+Kck+KclOKYkV0uKih2ZXJpZmllZHxvZmZpY2lhbHxjZXJ0aWZpZWR8YXV0aGVudGljKS9naTtcbiAgaWYgKHZlcmlmaWNhdGlvblNwb29mLnRlc3QoYmlvKSkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdWZXJpZmljYXRpb24gY2xhaW1zIG5vdCBhbGxvd2VkJyB9O1xuICB9XG5cbiAgLy8gNS4gUHJldmVudCBhdXRob3JpdHkgaW1wZXJzb25hdGlvblxuICBjb25zdCBhdXRob3JpdHlUZXJtcyA9IFtcbiAgICAnb2ZmaWNpYWwgYml0Y29pbicsICdiaXRjb2luIGZvdW5kYXRpb24nLCAnYml0Y29pbiBjb3JlJyxcbiAgICAnc2F0b3NoaSBuYWthbW90bycsICdiaXRjb2luIGRldmVsb3BlcicsICdjb3JlIGRldmVsb3BlcicsIFxuICAgICdsaWdodG5pbmcgbGFicycsICdibG9ja3N0cmVhbScsICdiaXRjb2luLm9yZydcbiAgXTtcblxuICBjb25zdCBiaW9Mb3dlciA9IGJpby50b0xvd2VyQ2FzZSgpO1xuICBmb3IgKGNvbnN0IHRlcm0gb2YgYXV0aG9yaXR5VGVybXMpIHtcbiAgICBpZiAoYmlvTG93ZXIuaW5jbHVkZXModGVybSkpIHtcbiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICdBdXRob3JpdHkgY2xhaW1zIG5vdCBhbGxvd2VkIGluIGJpbycgfTtcbiAgICB9XG4gIH1cblxuICAvLyA2LiBVc2UgdmVyaWZpY2F0aW9uIHN5c3RlbSBmb3IgYWRkaXRpb25hbCBpbXBlcnNvbmF0aW9uIGNoZWNrc1xuICBjb25zdCBpbXBlcnNvbmF0aW9uQ2hlY2sgPSB2YWxpZGF0ZUJpb0ZvckltcGVyc29uYXRpb24oYmlvKTtcbiAgaWYgKCFpbXBlcnNvbmF0aW9uQ2hlY2sudmFsaWQpIHtcbiAgICByZXR1cm4gaW1wZXJzb25hdGlvbkNoZWNrO1xuICB9XG5cbiAgLy8gNy4gQWRkaXRpb25hbCBjZWxlYnJpdHkgaW1wZXJzb25hdGlvbiBkZXRlY3Rpb25cbiAgY29uc3QgY2VsZWJyaXR5SW1wZXJzb25hdGlvblBhdHRlcm5zID0gW1xuICAgIC9pIGFtIChlbG9ufGphY2t8c2F0b3NoaXxtaWNoYWVsfGFuZHJlYXMpL2ksXG4gICAgL3RoaXMgaXMgKGVsb258amFja3xzYXRvc2hpfG1pY2hhZWx8YW5kcmVhcykvaSxcbiAgICAvcmVhbCAoZWxvbnxqYWNrfHNhdG9zaGl8bWljaGFlbHxhbmRyZWFzKS9pLFxuICAgIC9hY3R1YWwgKGVsb258amFja3xzYXRvc2hpfG1pY2hhZWx8YW5kcmVhcykvaSxcbiAgICAvZ2VudWluZSAoZWxvbnxqYWNrfHNhdG9zaGl8bWljaGFlbHxhbmRyZWFzKS9pLFxuICAgIC9ub3QgZmFrZS4qaSBhbS9pXG4gIF07XG5cbiAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGNlbGVicml0eUltcGVyc29uYXRpb25QYXR0ZXJucykge1xuICAgIGlmIChwYXR0ZXJuLnRlc3QoYmlvKSkge1xuICAgICAgcmV0dXJuIHsgdmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0NlbGVicml0eSBpbXBlcnNvbmF0aW9uIGNsYWltcyBub3QgYWxsb3dlZCcgfTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyB2YWxpZDogdHJ1ZSB9O1xufTtcblxuLy8gQ2xpZW50LXNpZGUgc2FuaXRpemF0aW9uIGZvciBiaW8gZGlzcGxheSAoYWRkaXRpb25hbCBzZWN1cml0eSBsYXllcilcbmV4cG9ydCBjb25zdCBzYW5pdGl6ZUJpb0ZvckRpc3BsYXkgPSAoYmlvOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICBpZiAoIWJpbykgcmV0dXJuICcnO1xuICBcbiAgcmV0dXJuIGJpb1xuICAgIC5yZXBsYWNlKC88L2csICcmbHQ7JylcbiAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXG4gICAgLnJlcGxhY2UoL1wiL2csICcmcXVvdDsnKVxuICAgIC5yZXBsYWNlKC8nL2csICcmI3gyNzsnKVxuICAgIC5yZXBsYWNlKC9cXC8vZywgJyYjeDJGOycpO1xufTtcblxuLy8gTGVnYWN5IGNvbXBhdGliaWxpdHkgZnVuY3Rpb25zIChtYWludGFpbiBleGlzdGluZyBBUEkpXG5leHBvcnQgY29uc3QgaXNWYWxpZEJpdGNvaW5BZGRyZXNzTGVnYWN5ID0gKGFkZHJlc3M6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICBjb25zdCByZXN1bHQgPSBpc1ZhbGlkQml0Y29pbkFkZHJlc3MoYWRkcmVzcyk7XG4gIHJldHVybiByZXN1bHQudmFsaWQ7XG59O1xuXG5leHBvcnQgY29uc3QgaXNWYWxpZExpZ2h0bmluZ0FkZHJlc3NMZWdhY3kgPSAoYWRkcmVzczogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IGlzVmFsaWRMaWdodG5pbmdBZGRyZXNzKGFkZHJlc3MpO1xuICByZXR1cm4gcmVzdWx0LnZhbGlkO1xufTtcblxuLy8gVVJMIHZhbGlkYXRpb24gdXRpbGl0aWVzIGZvciBzZWFtbGVzcyB1c2VyIGV4cGVyaWVuY2VcblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVVybCh1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gIGlmICghdXJsLnRyaW0oKSkgcmV0dXJuICcnXG4gIFxuICBsZXQgbm9ybWFsaXplZCA9IHVybC50cmltKClcbiAgXG4gIC8vIFJlbW92ZSBhbnkgc3Vycm91bmRpbmcgcXVvdGVzIG9yIHNwYWNlc1xuICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5yZXBsYWNlKC9eW1wiJ1xcc10rfFtcIidcXHNdKyQvZywgJycpXG4gIFxuICAvLyBJZiBpdCBkb2Vzbid0IHN0YXJ0IHdpdGggYSBwcm90b2NvbCwgYWRkIGh0dHBzOi8vXG4gIGlmIChub3JtYWxpemVkICYmICFub3JtYWxpemVkLm1hdGNoKC9eaHR0cHM/OlxcL1xcLy9pKSkge1xuICAgIG5vcm1hbGl6ZWQgPSBgaHR0cHM6Ly8ke25vcm1hbGl6ZWR9YFxuICB9XG4gIFxuICByZXR1cm4gbm9ybWFsaXplZFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVVcmwodXJsOiBzdHJpbmcpOiB7IGlzVmFsaWQ6IGJvb2xlYW47IG5vcm1hbGl6ZWQ6IHN0cmluZzsgZXJyb3I/OiBzdHJpbmcgfSB7XG4gIGlmICghdXJsLnRyaW0oKSkge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IHRydWUsIG5vcm1hbGl6ZWQ6ICcnIH0gLy8gRW1wdHkgaXMgdmFsaWQgKG9wdGlvbmFsIGZpZWxkKVxuICB9XG4gIFxuICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplVXJsKHVybClcbiAgXG4gIHRyeSB7XG4gICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTChub3JtYWxpemVkKVxuICAgIFxuICAgIC8vIENoZWNrIGlmIGl0J3MgYSB2YWxpZCBIVFRQL0hUVFBTIFVSTFxuICAgIGlmICghWydodHRwOicsICdodHRwczonXS5pbmNsdWRlcyh1cmxPYmoucHJvdG9jb2wpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgbm9ybWFsaXplZCxcbiAgICAgICAgZXJyb3I6ICdVUkwgbXVzdCB1c2UgaHR0cDovLyBvciBodHRwczovLydcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgaWYgaG9zdG5hbWUgZXhpc3RzXG4gICAgaWYgKCF1cmxPYmouaG9zdG5hbWUgfHwgdXJsT2JqLmhvc3RuYW1lLmxlbmd0aCA8IDMpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICBub3JtYWxpemVkLFxuICAgICAgICBlcnJvcjogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGRvbWFpbiBuYW1lJ1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlLCBub3JtYWxpemVkIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICBub3JtYWxpemVkLFxuICAgICAgZXJyb3I6ICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBVUkwnXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ZhbGlkVXJsKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWxpZGF0ZVVybCh1cmwpLmlzVmFsaWRcbn0gIl0sInZlcnNpb24iOjN9
704d163dd247718ca713598132fb4aca
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock dependencies
globals_1.jest.mock('../profile/reader', () => ({
    ProfileReader: {
        getProfile: globals_1.jest.fn(),
        getProfiles: globals_1.jest.fn(),
        searchProfiles: globals_1.jest.fn(),
        getAllProfiles: globals_1.jest.fn(),
        incrementProfileViews: globals_1.jest.fn(),
    }
}));
globals_1.jest.mock('../profile/writer', () => ({
    ProfileWriter: {
        updateProfile: globals_1.jest.fn(),
        createProfile: globals_1.jest.fn(),
        updateAnalytics: globals_1.jest.fn(),
        deleteProfile: globals_1.jest.fn(),
        fallbackUpdate: globals_1.jest.fn(),
    }
}));
/**
 * PROFILE SERVICE - COMPREHENSIVE TEST COVERAGE
 *
 * This test suite provides comprehensive coverage for the ProfileService,
 * testing all user profile operations, authentication flows, error handling,
 * fallback mechanisms, and edge cases.
 *
 * Created: 2025-01-08
 * Last Modified: 2025-01-08
 * Last Modified Summary: Comprehensive ProfileService tests with fallback testing
 */
const profileService_1 = require("../profileService");
const reader_1 = require("../profile/reader");
const writer_1 = require("../profile/writer");
const mockedProfileReader = globals_1.jest.mocked(reader_1.ProfileReader);
const mockedProfileWriter = globals_1.jest.mocked(writer_1.ProfileWriter);
describe('👤 Profile Service - Comprehensive Coverage', () => {
    beforeEach(() => {
        globals_1.jest.clearAllMocks();
    });
    describe('🎯 Service Architecture', () => {
        test('should export ProfileService class', () => {
            expect(profileService_1.ProfileService).toBeDefined();
            expect(typeof profileService_1.ProfileService).toBe('function');
        });
        test('should have all required static methods', () => {
            expect(typeof profileService_1.ProfileService.getProfile).toBe('function');
            expect(typeof profileService_1.ProfileService.updateProfile).toBe('function');
            expect(typeof profileService_1.ProfileService.createProfile).toBe('function');
            // Note: updatePassword is a legacy method not using the reader/writer pattern
            expect(typeof profileService_1.ProfileService.updatePassword).toBe('function');
            expect(typeof profileService_1.ProfileService.fallbackProfileUpdate).toBe('function');
        });
    });
    describe('👤 Get Profile Operations', () => {
        test('should retrieve profile successfully', async () => {
            const mockProfile = {
                id: 'user-123',
                username: 'testuser',
                full_name: 'Test User',
                display_name: 'Test User',
                avatar_url: 'http://example.com/avatar.png',
                website: 'http://example.com',
                created_at: '2024-01-01T00:00:00.000Z',
                updated_at: '2024-01-01T00:00:00.000Z',
                // Add other required fields for ScalableProfile
                bio: null,
                banner_url: null,
                bitcoin_address: null,
                lightning_address: null,
                email: null,
                phone: null,
                location: null,
                timezone: null,
                language: null,
                currency: null,
                bitcoin_public_key: null,
                lightning_node_id: null,
                payment_preferences: null,
                bitcoin_balance: null,
                lightning_balance: null,
                profile_views: null,
                follower_count: null,
                following_count: null,
                campaign_count: null,
                total_raised: null,
                total_donated: null,
                verification_status: 'unverified',
                verification_level: null,
                kyc_status: 'none',
                two_factor_enabled: null,
                last_login_at: null,
                login_count: null,
                theme_preferences: null,
                custom_css: null,
                profile_color: null,
                cover_image_url: null,
                profile_badges: null,
                status: 'active',
                last_active_at: null,
                profile_completed_at: null,
                onboarding_completed: null,
                terms_accepted_at: null,
                privacy_policy_accepted_at: null,
                social_links: null,
                preferences: null,
                metadata: null,
                verification_data: null,
                privacy_settings: null
            };
            mockedProfileReader.getProfile.mockResolvedValue(mockProfile);
            const result = await profileService_1.ProfileService.getProfile('user-123');
            expect(result).toEqual(mockProfile);
            expect(mockedProfileReader.getProfile).toHaveBeenCalledWith('user-123');
        });
        test('should handle profile not found', async () => {
            mockedProfileReader.getProfile.mockResolvedValue(null);
            const result = await profileService_1.ProfileService.getProfile('nonexistent-user');
            expect(result).toBeNull();
        });
        test('should handle database connection errors', async () => {
            const errorMessage = 'Connection failed';
            mockedProfileReader.getProfile.mockRejectedValue(new Error(errorMessage));
            await expect(profileService_1.ProfileService.getProfile('user-123')).rejects.toThrow(errorMessage);
        });
        test('should handle empty user ID gracefully', async () => {
            // An empty ID should not throw, but return null as per service logic.
            mockedProfileReader.getProfile.mockResolvedValue(null);
            const result = await profileService_1.ProfileService.getProfile('');
            expect(result).toBeNull();
            expect(mockedProfileReader.getProfile).toHaveBeenCalledWith('');
        });
    });
    describe('✏️ Update Profile Operations', () => {
        test('should update profile successfully', async () => {
            var _a;
            const userId = 'user-123';
            const formData = {
                username: 'newusername',
                full_name: 'New Name',
                bio: 'Updated bio'
            };
            const mockResponse = {
                success: true,
                data: Object.assign({ id: userId }, formData)
            };
            mockedProfileWriter.updateProfile.mockResolvedValue(mockResponse);
            const result = await profileService_1.ProfileService.updateProfile(userId, formData);
            expect(result.success).toBe(true);
            expect(result.data).toBeDefined();
            expect((_a = result.data) === null || _a === void 0 ? void 0 : _a.username).toBe('newusername');
            expect(mockedProfileWriter.updateProfile).toHaveBeenCalledWith(userId, formData);
        });
        test('should return error on update failure', async () => {
            const userId = 'user-123';
            const formData = { username: 'failuser' };
            const mockResponse = {
                success: false,
                error: 'Failed to update'
            };
            mockedProfileWriter.updateProfile.mockResolvedValue(mockResponse);
            const result = await profileService_1.ProfileService.updateProfile(userId, formData);
            expect(result.success).toBe(false);
            expect(result.data).toBeUndefined();
            expect(result.error).toBe('Failed to update');
        });
    });
    describe('➕ Create Profile Operations', () => {
        test('should create profile successfully', async () => {
            var _a;
            const userId = 'user-456';
            const formData = {
                username: 'newbie',
                full_name: 'Newbie User'
            };
            const mockResponse = {
                success: true,
                data: Object.assign({ id: userId }, formData)
            };
            mockedProfileWriter.createProfile.mockResolvedValue(mockResponse);
            const result = await profileService_1.ProfileService.createProfile(userId, formData);
            expect(result.success).toBe(true);
            expect(result.data).toBeDefined();
            expect((_a = result.data) === null || _a === void 0 ? void 0 : _a.username).toBe('newbie');
        });
    });
    describe('🗑️ Delete Profile Operations', () => {
        test('should delete profile successfully', async () => {
            const userId = 'user-789';
            const mockResponse = { success: true };
            mockedProfileWriter.deleteProfile.mockResolvedValue(mockResponse);
            const result = await profileService_1.ProfileService.deleteProfile(userId);
            expect(result.success).toBe(true);
            expect(result.data).toBeUndefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy9zZXJ2aWNlcy9fX3Rlc3RzX18vcHJvZmlsZVNlcnZpY2UuY29tcHJlaGVuc2l2ZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBWUEsMkNBQW9DO0FBR3BDLG9CQUFvQjtBQUNwQixjQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDcEMsYUFBYSxFQUFFO1FBQ2IsVUFBVSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDckIsV0FBVyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDdEIsY0FBYyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDekIsY0FBYyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7UUFDekIscUJBQXFCLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtLQUNqQztDQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUosY0FBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3BDLGFBQWEsRUFBRTtRQUNiLGFBQWEsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGFBQWEsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGVBQWUsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQzFCLGFBQWEsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO1FBQ3hCLGNBQWMsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0tBQzFCO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFsQ0o7Ozs7Ozs7Ozs7R0FVRztBQUNILHNEQUFrRDtBQXlCbEQsOENBQWtEO0FBQ2xELDhDQUFrRDtBQUVsRCxNQUFNLG1CQUFtQixHQUFHLGNBQUksQ0FBQyxNQUFNLENBQUMsc0JBQWEsQ0FBQyxDQUFDO0FBQ3ZELE1BQU0sbUJBQW1CLEdBQUcsY0FBSSxDQUFDLE1BQU0sQ0FBQyxzQkFBYSxDQUFDLENBQUM7QUFFdkQsUUFBUSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcs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QUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy9zZXJ2aWNlcy9fX3Rlc3RzX18vcHJvZmlsZVNlcnZpY2UuY29tcHJlaGVuc2l2ZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUFJPRklMRSBTRVJWSUNFIC0gQ09NUFJFSEVOU0lWRSBURVNUIENPVkVSQUdFXG4gKiBcbiAqIFRoaXMgdGVzdCBzdWl0ZSBwcm92aWRlcyBjb21wcmVoZW5zaXZlIGNvdmVyYWdlIGZvciB0aGUgUHJvZmlsZVNlcnZpY2UsXG4gKiB0ZXN0aW5nIGFsbCB1c2VyIHByb2ZpbGUgb3BlcmF0aW9ucywgYXV0aGVudGljYXRpb24gZmxvd3MsIGVycm9yIGhhbmRsaW5nLFxuICogZmFsbGJhY2sgbWVjaGFuaXNtcywgYW5kIGVkZ2UgY2FzZXMuXG4gKiBcbiAqIENyZWF0ZWQ6IDIwMjUtMDEtMDhcbiAqIExhc3QgTW9kaWZpZWQ6IDIwMjUtMDEtMDhcbiAqIExhc3QgTW9kaWZpZWQgU3VtbWFyeTogQ29tcHJlaGVuc2l2ZSBQcm9maWxlU2VydmljZSB0ZXN0cyB3aXRoIGZhbGxiYWNrIHRlc3RpbmdcbiAqL1xuaW1wb3J0IHsgUHJvZmlsZVNlcnZpY2UgfSBmcm9tICcuLi9wcm9maWxlU2VydmljZSdcbmltcG9ydCB7IGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJ1xuaW1wb3J0IHR5cGUgeyBTY2FsYWJsZVByb2ZpbGUsIFNjYWxhYmxlUHJvZmlsZUZvcm1EYXRhIH0gZnJvbSAnLi4vcHJvZmlsZS90eXBlcyc7XG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJy4uL3Byb2ZpbGUvcmVhZGVyJywgKCkgPT4gKHtcbiAgUHJvZmlsZVJlYWRlcjoge1xuICAgIGdldFByb2ZpbGU6IGplc3QuZm4oKSxcbiAgICBnZXRQcm9maWxlczogamVzdC5mbigpLFxuICAgIHNlYXJjaFByb2ZpbGVzOiBqZXN0LmZuKCksXG4gICAgZ2V0QWxsUHJvZmlsZXM6IGplc3QuZm4oKSxcbiAgICBpbmNyZW1lbnRQcm9maWxlVmlld3M6IGplc3QuZm4oKSxcbiAgfVxufSkpO1xuXG5qZXN0Lm1vY2soJy4uL3Byb2ZpbGUvd3JpdGVyJywgKCkgPT4gKHtcbiAgUHJvZmlsZVdyaXRlcjoge1xuICAgIHVwZGF0ZVByb2ZpbGU6IGplc3QuZm4oKSxcbiAgICBjcmVhdGVQcm9maWxlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlQW5hbHl0aWNzOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlUHJvZmlsZTogamVzdC5mbigpLFxuICAgIGZhbGxiYWNrVXBkYXRlOiBqZXN0LmZuKCksXG4gIH1cbn0pKTtcblxuaW1wb3J0IHsgUHJvZmlsZVJlYWRlciB9IGZyb20gJy4uL3Byb2ZpbGUvcmVhZGVyJztcbmltcG9ydCB7IFByb2ZpbGVXcml0ZXIgfSBmcm9tICcuLi9wcm9maWxlL3dyaXRlcic7XG5cbmNvbnN0IG1vY2tlZFByb2ZpbGVSZWFkZXIgPSBqZXN0Lm1vY2tlZChQcm9maWxlUmVhZGVyKTtcbmNvbnN0IG1vY2tlZFByb2ZpbGVXcml0ZXIgPSBqZXN0Lm1vY2tlZChQcm9maWxlV3JpdGVyKTtcblxuZGVzY3JpYmUoJ/CfkaQgUHJvZmlsZSBTZXJ2aWNlIC0gQ29tcHJlaGVuc2l2ZSBDb3ZlcmFnZScsICgpID0+IHtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ/Cfjq8gU2VydmljZSBBcmNoaXRlY3R1cmUnLCAoKSA9PiB7XG4gICAgXG4gICAgdGVzdCgnc2hvdWxkIGV4cG9ydCBQcm9maWxlU2VydmljZSBjbGFzcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChQcm9maWxlU2VydmljZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgUHJvZmlsZVNlcnZpY2UpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBhbGwgcmVxdWlyZWQgc3RhdGljIG1ldGhvZHMnLCAoKSA9PiB7XG4gICAgICBleHBlY3QodHlwZW9mIFByb2ZpbGVTZXJ2aWNlLmdldFByb2ZpbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIFByb2ZpbGVTZXJ2aWNlLnVwZGF0ZVByb2ZpbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIFByb2ZpbGVTZXJ2aWNlLmNyZWF0ZVByb2ZpbGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgICAvLyBOb3RlOiB1cGRhdGVQYXNzd29yZCBpcyBhIGxlZ2FjeSBtZXRob2Qgbm90IHVzaW5nIHRoZSByZWFkZXIvd3JpdGVyIHBhdHRlcm5cbiAgICAgIGV4cGVjdCh0eXBlb2YgUHJvZmlsZVNlcnZpY2UudXBkYXRlUGFzc3dvcmQpLnRvQmUoJ2Z1bmN0aW9uJyk7IFxuICAgICAgZXhwZWN0KHR5cGVvZiBQcm9maWxlU2VydmljZS5mYWxsYmFja1Byb2ZpbGVVcGRhdGUpLnRvQmUoJ2Z1bmN0aW9uJyk7XG4gICAgfSk7XG5cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ/CfkaQgR2V0IFByb2ZpbGUgT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBcbiAgICB0ZXN0KCdzaG91bGQgcmV0cmlldmUgcHJvZmlsZSBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvZmlsZTogU2NhbGFibGVQcm9maWxlID0ge1xuICAgICAgICBpZDogJ3VzZXItMTIzJyxcbiAgICAgICAgdXNlcm5hbWU6ICd0ZXN0dXNlcicsXG4gICAgICAgIGZ1bGxfbmFtZTogJ1Rlc3QgVXNlcicsXG4gICAgICAgIGRpc3BsYXlfbmFtZTogJ1Rlc3QgVXNlcicsXG4gICAgICAgIGF2YXRhcl91cmw6ICdodHRwOi8vZXhhbXBsZS5jb20vYXZhdGFyLnBuZycsXG4gICAgICAgIHdlYnNpdGU6ICdodHRwOi8vZXhhbXBsZS5jb20nLFxuICAgICAgICBjcmVhdGVkX2F0OiAnMjAyNC0wMS0wMVQwMDowMDowMC4wMDBaJyxcbiAgICAgICAgdXBkYXRlZF9hdDogJzIwMjQtMDEtMDFUMDA6MDA6MDAuMDAwWicsXG4gICAgICAgIC8vIEFkZCBvdGhlciByZXF1aXJlZCBmaWVsZHMgZm9yIFNjYWxhYmxlUHJvZmlsZVxuICAgICAgICBiaW86IG51bGwsXG4gICAgICAgIGJhbm5lcl91cmw6IG51bGwsXG4gICAgICAgIGJpdGNvaW5fYWRkcmVzczogbnVsbCxcbiAgICAgICAgbGlnaHRuaW5nX2FkZHJlc3M6IG51bGwsXG4gICAgICAgIGVtYWlsOiBudWxsLFxuICAgICAgICBwaG9uZTogbnVsbCxcbiAgICAgICAgbG9jYXRpb246IG51bGwsXG4gICAgICAgIHRpbWV6b25lOiBudWxsLFxuICAgICAgICBsYW5ndWFnZTogbnVsbCxcbiAgICAgICAgY3VycmVuY3k6IG51bGwsXG4gICAgICAgIGJpdGNvaW5fcHVibGljX2tleTogbnVsbCxcbiAgICAgICAgbGlnaHRuaW5nX25vZGVfaWQ6IG51bGwsXG4gICAgICAgIHBheW1lbnRfcHJlZmVyZW5jZXM6IG51bGwsXG4gICAgICAgIGJpdGNvaW5fYmFsYW5jZTogbnVsbCxcbiAgICAgICAgbGlnaHRuaW5nX2JhbGFuY2U6IG51bGwsXG4gICAgICAgIHByb2ZpbGVfdmlld3M6IG51bGwsXG4gICAgICAgIGZvbGxvd2VyX2NvdW50OiBudWxsLFxuICAgICAgICBmb2xsb3dpbmdfY291bnQ6IG51bGwsXG4gICAgICAgIGNhbXBhaWduX2NvdW50OiBudWxsLFxuICAgICAgICB0b3RhbF9yYWlzZWQ6IG51bGwsXG4gICAgICAgIHRvdGFsX2RvbmF0ZWQ6IG51bGwsXG4gICAgICAgIHZlcmlmaWNhdGlvbl9zdGF0dXM6ICd1bnZlcmlmaWVkJyxcbiAgICAgICAgdmVyaWZpY2F0aW9uX2xldmVsOiBudWxsLFxuICAgICAgICBreWNfc3RhdHVzOiAnbm9uZScsXG4gICAgICAgIHR3b19mYWN0b3JfZW5hYmxlZDogbnVsbCxcbiAgICAgICAgbGFzdF9sb2dpbl9hdDogbnVsbCxcbiAgICAgICAgbG9naW5fY291bnQ6IG51bGwsXG4gICAgICAgIHRoZW1lX3ByZWZlcmVuY2VzOiBudWxsLFxuICAgICAgICBjdXN0b21fY3NzOiBudWxsLFxuICAgICAgICBwcm9maWxlX2NvbG9yOiBudWxsLFxuICAgICAgICBjb3Zlcl9pbWFnZV91cmw6IG51bGwsXG4gICAgICAgIHByb2ZpbGVfYmFkZ2VzOiBudWxsLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICBsYXN0X2FjdGl2ZV9hdDogbnVsbCxcbiAgICAgICAgcHJvZmlsZV9jb21wbGV0ZWRfYXQ6IG51bGwsXG4gICAgICAgIG9uYm9hcmRpbmdfY29tcGxldGVkOiBudWxsLFxuICAgICAgICB0ZXJtc19hY2NlcHRlZF9hdDogbnVsbCxcbiAgICAgICAgcHJpdmFjeV9wb2xpY3lfYWNjZXB0ZWRfYXQ6IG51bGwsXG4gICAgICAgIHNvY2lhbF9saW5rczogbnVsbCxcbiAgICAgICAgcHJlZmVyZW5jZXM6IG51bGwsXG4gICAgICAgIG1ldGFkYXRhOiBudWxsLFxuICAgICAgICB2ZXJpZmljYXRpb25fZGF0YTogbnVsbCxcbiAgICAgICAgcHJpdmFjeV9zZXR0aW5nczogbnVsbFxuICAgICAgfTtcblxuICAgICAgbW9ja2VkUHJvZmlsZVJlYWRlci5nZXRQcm9maWxlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9maWxlKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZmlsZVNlcnZpY2UuZ2V0UHJvZmlsZSgndXNlci0xMjMnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUHJvZmlsZSk7XG4gICAgICBleHBlY3QobW9ja2VkUHJvZmlsZVJlYWRlci5nZXRQcm9maWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndXNlci0xMjMnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcHJvZmlsZSBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrZWRQcm9maWxlUmVhZGVyLmdldFByb2ZpbGUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2ZpbGVTZXJ2aWNlLmdldFByb2ZpbGUoJ25vbmV4aXN0ZW50LXVzZXInKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZU51bGwoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgY29ubmVjdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSAnQ29ubmVjdGlvbiBmYWlsZWQnO1xuICAgICAgbW9ja2VkUHJvZmlsZVJlYWRlci5nZXRQcm9maWxlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFByb2ZpbGVTZXJ2aWNlLmdldFByb2ZpbGUoJ3VzZXItMTIzJykpLnJlamVjdHMudG9UaHJvdyhlcnJvck1lc3NhZ2UpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSB1c2VyIElEIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBbiBlbXB0eSBJRCBzaG91bGQgbm90IHRocm93LCBidXQgcmV0dXJuIG51bGwgYXMgcGVyIHNlcnZpY2UgbG9naWMuXG4gICAgICBtb2NrZWRQcm9maWxlUmVhZGVyLmdldFByb2ZpbGUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2ZpbGVTZXJ2aWNlLmdldFByb2ZpbGUoJycpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KG1vY2tlZFByb2ZpbGVSZWFkZXIuZ2V0UHJvZmlsZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJycpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfinI/vuI8gVXBkYXRlIFByb2ZpbGUgT3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBcbiAgICB0ZXN0KCdzaG91bGQgdXBkYXRlIHByb2ZpbGUgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcklkID0gJ3VzZXItMTIzJztcbiAgICAgIGNvbnN0IGZvcm1EYXRhOiBTY2FsYWJsZVByb2ZpbGVGb3JtRGF0YSA9IHtcbiAgICAgICAgdXNlcm5hbWU6ICduZXd1c2VybmFtZScsXG4gICAgICAgIGZ1bGxfbmFtZTogJ05ldyBOYW1lJyxcbiAgICAgICAgYmlvOiAnVXBkYXRlZCBiaW8nXG4gICAgICB9O1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgZGF0YTogeyBpZDogdXNlcklkLCAuLi5mb3JtRGF0YSB9IGFzIFNjYWxhYmxlUHJvZmlsZVxuICAgICAgfTtcbiAgICAgIG1vY2tlZFByb2ZpbGVXcml0ZXIudXBkYXRlUHJvZmlsZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzcG9uc2UpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9maWxlU2VydmljZS51cGRhdGVQcm9maWxlKHVzZXJJZCwgZm9ybURhdGEpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmRhdGE/LnVzZXJuYW1lKS50b0JlKCduZXd1c2VybmFtZScpO1xuICAgICAgZXhwZWN0KG1vY2tlZFByb2ZpbGVXcml0ZXIudXBkYXRlUHJvZmlsZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgodXNlcklkLCBmb3JtRGF0YSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGVycm9yIG9uIHVwZGF0ZSBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1c2VySWQgPSAndXNlci0xMjMnO1xuICAgICAgICBjb25zdCBmb3JtRGF0YTogU2NhbGFibGVQcm9maWxlRm9ybURhdGEgPSB7IHVzZXJuYW1lOiAnZmFpbHVzZXInIH07XG4gICAgICAgIGNvbnN0IG1vY2tSZXNwb25zZSA9IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gdXBkYXRlJ1xuICAgICAgICB9O1xuICAgICAgICBtb2NrZWRQcm9maWxlV3JpdGVyLnVwZGF0ZVByb2ZpbGUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3BvbnNlKTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9maWxlU2VydmljZS51cGRhdGVQcm9maWxlKHVzZXJJZCwgZm9ybURhdGEpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0JlKCdGYWlsZWQgdG8gdXBkYXRlJyk7XG4gICAgfSk7XG5cbiAgfSk7XG4gIFxuICBkZXNjcmliZSgn4p6VIENyZWF0ZSBQcm9maWxlIE9wZXJhdGlvbnMnLCAoKSA9PiB7XG5cbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIHByb2ZpbGUgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1c2VySWQgPSAndXNlci00NTYnO1xuICAgICAgICBjb25zdCBmb3JtRGF0YTogU2NhbGFibGVQcm9maWxlRm9ybURhdGEgPSB7XG4gICAgICAgICAgICB1c2VybmFtZTogJ25ld2JpZScsXG4gICAgICAgICAgICBmdWxsX25hbWU6ICdOZXdiaWUgVXNlcidcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlID0ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IHsgaWQ6IHVzZXJJZCwgLi4uZm9ybURhdGEgfSBhcyBTY2FsYWJsZVByb2ZpbGVcbiAgICAgICAgfTtcbiAgICAgICAgbW9ja2VkUHJvZmlsZVdyaXRlci5jcmVhdGVQcm9maWxlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNwb25zZSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZmlsZVNlcnZpY2UuY3JlYXRlUHJvZmlsZSh1c2VySWQsIGZvcm1EYXRhKTtcblxuICAgICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuZGF0YSkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhPy51c2VybmFtZSkudG9CZSgnbmV3YmllJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCfwn5eR77iPIERlbGV0ZSBQcm9maWxlIE9wZXJhdGlvbnMnLCAoKSA9PiB7XG5cbiAgICB0ZXN0KCdzaG91bGQgZGVsZXRlIHByb2ZpbGUgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCB1c2VySWQgPSAndXNlci03ODknO1xuICAgICAgICBjb25zdCBtb2NrUmVzcG9uc2UgPSB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICAgICAgbW9ja2VkUHJvZmlsZVdyaXRlci5kZWxldGVQcm9maWxlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXNwb25zZSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9maWxlU2VydmljZS5kZWxldGVQcm9maWxlKHVzZXJJZCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbn0pOyAiXSwidmVyc2lvbiI6M30=
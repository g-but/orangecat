{"file":"/home/g/dev/orangecat/src/services/campaigns/__tests__/campaignService.comprehensive.test.ts","mappings":"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","names":[],"sources":["/home/g/dev/orangecat/src/services/campaigns/__tests__/campaignService.comprehensive.test.ts"],"sourcesContent":["/**\n * Campaign Service Integration Tests - FIXED MOCKING INFRASTRUCTURE\n * \n * CRITICAL BUSINESS LOGIC COVERAGE for Bitcoin Campaign Platform\n * Testing core campaign creation, management, and publishing flows\n * \n * INFRASTRUCTURE FIXES:\n * - Proper dependency injection for Supabase client\n * - Comprehensive mock chain patterns\n * - Isolated test environment\n */\n\n// Mock the createBrowserClient factory function\njest.mock('@supabase/ssr', () => ({\n  createBrowserClient: jest.fn()\n}))\n\nimport { CampaignService } from '../index'\nimport { createBrowserClient } from '@supabase/ssr'\n\ndescribe('ðŸš€ CampaignService - Comprehensive Coverage', () => {\n  let campaignService: CampaignService\n  let localStorageMock: Record<string, string>\n  let mockSupabase: any\n  let mockInsert: jest.Mock\n  let mockUpdate: jest.Mock\n\n  const userId = 'test-user-123'\n  const campaignId = 'campaign-456'\n  \n  const mockDbCampaign = {\n    id: campaignId,\n    user_id: userId,\n    title: 'Test Campaign',\n    description: 'Test Description',\n    bitcoin_address: 'bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4',\n    lightning_address: 'test@getalby.com',\n    website_url: 'https://example.com',\n    goal_amount: 50000,\n    category: 'technology',\n    tags: ['bitcoin'],\n    currency: 'BTC',\n    is_active: false,\n    is_public: false,\n    total_funding: 0,\n    contributor_count: 0,\n    created_at: '2024-01-01T00:00:00.000Z',\n    updated_at: '2024-01-01T00:00:00.000Z'\n  }\n\n  const formData = {\n    title: 'Test Campaign',\n    description: 'Test Description',\n    bitcoin_address: 'bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4',\n    lightning_address: 'test@getalby.com',\n    website_url: 'https://example.com',\n    goal_amount: 50000,\n    categories: ['technology', 'bitcoin']\n  }\n\n  beforeEach(() => {\n    jest.clearAllMocks()\n    \n    // Setup localStorage mock\n    localStorageMock = {}\n    Storage.prototype.getItem = jest.fn((key) => localStorageMock[key] || null)\n    Storage.prototype.setItem = jest.fn((key, value) => {\n      localStorageMock[key] = value\n    })\n    Storage.prototype.removeItem = jest.fn((key) => {\n      delete localStorageMock[key]\n    })\n\n    // Create mock functions that we can track\n    mockInsert = jest.fn(() => ({\n      select: jest.fn(() => ({\n        single: jest.fn(() => Promise.resolve({ data: mockDbCampaign, error: null }))\n      }))\n    }))\n\n    mockUpdate = jest.fn(() => ({\n      eq: jest.fn(() => ({\n        eq: jest.fn(() => ({\n          select: jest.fn(() => ({\n            single: jest.fn(() => Promise.resolve({ data: {...mockDbCampaign, is_active: true, is_public: true}, error: null }))\n          }))\n        }))\n      }))\n    }))\n\n    // Setup mock Supabase with working chains\n    mockSupabase = {\n      from: jest.fn(() => ({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: [mockDbCampaign], error: null })),\n            single: jest.fn(() => Promise.resolve({ data: mockDbCampaign, error: null }))\n          }))\n        })),\n        insert: mockInsert,\n        update: mockUpdate\n      }))\n    }\n\n    campaignService = new CampaignService(mockSupabase)\n  })\n\n  describe('ðŸ“Š Campaign Loading - Critical User Flow', () => {\n    it('should load campaigns from database successfully', async () => {\n      const mockCampaigns = [mockDbCampaign]\n      \n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: mockCampaigns, error: null }))\n          }))\n        }))\n      })\n\n      const campaigns = await campaignService.getAllCampaigns(userId)\n\n      expect(campaigns).toHaveLength(1)\n      expect(campaigns[0].source).toBe('database')\n      expect(campaigns[0].isDraft).toBe(true) // is_active: false, is_public: false\n      expect(mockSupabase.from).toHaveBeenCalledWith('funding_pages')\n    })\n\n    it('should handle database errors gracefully', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: null, error: new Error('Database connection failed') }))\n          }))\n        }))\n      })\n\n      await expect(campaignService.getAllCampaigns(userId)).rejects.toThrow('Database connection failed')\n    })\n\n    it('should merge local drafts with database campaigns', async () => {\n      // Set up local draft\n      localStorageMock[`funding-draft-${userId}`] = JSON.stringify({\n        formData: { title: 'Local Draft', description: 'Local description' },\n        currentStep: 2,\n        draftId: campaignId,\n        lastSaved: new Date().toISOString()\n      })\n\n      const mockCampaigns = [mockDbCampaign]\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: mockCampaigns, error: null }))\n          }))\n        }))\n      })\n\n      const campaigns = await campaignService.getAllCampaigns(userId)\n\n      // Should merge local draft with database version\n      expect(campaigns).toHaveLength(1)\n      expect(campaigns[0].title).toBe('Local Draft') // Local takes priority\n      expect(campaigns[0].source).toBe('local')\n    })\n  })\n\n  describe('ðŸ’¾ Draft Saving - Data Integrity Critical', () => {\n    it('should save draft to localStorage immediately', async () => {\n      await campaignService.saveDraft(userId, formData, 1)\n\n      // Check localStorage was called\n      expect(Storage.prototype.setItem).toHaveBeenCalled()\n      const savedData = JSON.parse(localStorageMock[`funding-draft-${userId}`])\n      expect(savedData.formData.title).toBe(formData.title)\n      expect(savedData.currentStep).toBe(1)\n    })\n\n    it('should create new draft in database', async () => {\n      const draftId = await campaignService.saveDraft(userId, formData, 1)\n\n      expect(draftId).toBe(campaignId)\n      expect(mockSupabase.from).toHaveBeenCalledWith('funding_pages')\n      \n      // Verify insert was called with correct data\n      const insertCall = mockSupabase.from().insert\n      expect(insertCall).toHaveBeenCalledWith(\n        expect.objectContaining({\n          user_id: userId,\n          title: formData.title,\n          is_active: false,\n          is_public: false\n        })\n      )\n    })\n\n    it('should update existing draft in database', async () => {\n      const existingDraftId = 'existing-123'\n      \n      mockSupabase.from.mockReturnValue({\n        update: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            eq: jest.fn(() => ({\n              select: jest.fn(() => ({\n                single: jest.fn(() => Promise.resolve({ data: mockDbCampaign, error: null }))\n              }))\n            }))\n          }))\n        }))\n      })\n\n      await campaignService.saveDraft(userId, formData, 2, existingDraftId)\n\n      const updateCall = mockSupabase.from().update\n      expect(updateCall).toHaveBeenCalledWith(\n        expect.objectContaining({\n          title: formData.title,\n          description: formData.description\n        })\n      )\n    })\n\n    it('should handle draft save errors without losing local data', async () => {\n      mockSupabase.from.mockReturnValue({\n        insert: jest.fn(() => ({\n          select: jest.fn(() => ({\n            single: jest.fn(() => Promise.resolve({ data: null, error: new Error('Network error') }))\n          }))\n        }))\n      })\n\n      await expect(campaignService.saveDraft(userId, formData, 1)).rejects.toThrow('Network error')\n\n      // But local data should still be saved\n      const savedDraft = JSON.parse(localStorageMock[`funding-draft-${userId}`] || '{}')\n      expect(savedDraft.formData?.title).toBe(formData.title)\n    })\n\n    it('should handle malformed goal amounts', async () => {\n      const malformedData = {\n        ...formData,\n        goal_amount: 'invalid-number' as any\n      }\n\n      await campaignService.saveDraft(userId, malformedData, 1)\n\n      expect(mockInsert).toHaveBeenCalledWith(\n        expect.objectContaining({\n          goal_amount: null // Should convert invalid numbers to null\n        })\n      )\n    })\n  })\n\n  describe('ðŸš€ Campaign Publishing - Business Critical', () => {\n    it('should publish campaign successfully', async () => {\n      const publishedCampaign = await campaignService.publishCampaign(userId, campaignId, formData)\n\n      expect(publishedCampaign.isActive).toBe(true)\n      expect(publishedCampaign.isDraft).toBe(false)\n      expect(publishedCampaign.isPaused).toBe(false)\n      \n      const updateCall = mockSupabase.from().update\n      expect(updateCall).toHaveBeenCalledWith(\n        expect.objectContaining({\n          is_active: true,\n          is_public: true\n        })\n      )\n    })\n\n    it('should clear local draft after successful publish', async () => {\n      // Set up local draft\n      localStorageMock[`funding-draft-${userId}`] = JSON.stringify({ formData })\n\n      await campaignService.publishCampaign(userId, campaignId, formData)\n\n      // Local draft should be cleared\n      expect(localStorageMock[`funding-draft-${userId}`]).toBeUndefined()\n    })\n\n    it('should handle publish errors without clearing local draft', async () => {\n      // Set up local draft\n      localStorageMock[`funding-draft-${userId}`] = JSON.stringify({ formData })\n\n      mockSupabase.from.mockReturnValue({\n        update: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            eq: jest.fn(() => ({\n              select: jest.fn(() => ({\n                single: jest.fn(() => Promise.resolve({ data: null, error: new Error('Publish failed') }))\n              }))\n            }))\n          }))\n        }))\n      })\n\n      await expect(campaignService.publishCampaign(userId, campaignId, {})).rejects.toThrow('Publish failed')\n\n      // Local draft should be preserved\n      expect(localStorageMock[`funding-draft-${userId}`]).not.toBeNull()\n    })\n  })\n\n  describe('ðŸ” Campaign Filtering - User Experience', () => {\n    it('should filter drafts correctly', async () => {\n      const mockCampaigns = [\n        { ...mockDbCampaign, id: '1', is_active: false, is_public: false },\n        { ...mockDbCampaign, id: '2', is_active: true, is_public: true },\n        { ...mockDbCampaign, id: '3', is_active: false, is_public: true }\n      ]\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: mockCampaigns, error: null }))\n          }))\n        }))\n      })\n\n      const campaigns = await campaignService.getAllCampaigns(userId)\n      const filtered = await campaignService.filterCampaigns(campaigns, { status: 'draft' })\n\n      expect(filtered).toHaveLength(1)\n      expect(filtered[0].isDraft).toBe(true)\n    })\n\n    it('should filter active campaigns correctly', async () => {\n      const mockCampaigns = [\n        { ...mockDbCampaign, id: '1', is_active: false, is_public: false },\n        { ...mockDbCampaign, id: '2', is_active: true, is_public: true },\n        { ...mockDbCampaign, id: '3', is_active: false, is_public: true }\n      ]\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: mockCampaigns, error: null }))\n          }))\n        }))\n      })\n\n      const campaigns = await campaignService.getAllCampaigns(userId)\n      const filtered = await campaignService.filterCampaigns(campaigns, { status: 'active' })\n\n      expect(filtered).toHaveLength(1)\n      expect(filtered[0].isActive).toBe(true)\n    })\n\n    it('should filter paused campaigns correctly', async () => {\n      const mockCampaigns = [\n        { ...mockDbCampaign, id: '1', is_active: false, is_public: false },\n        { ...mockDbCampaign, id: '2', is_active: true, is_public: true },\n        { ...mockDbCampaign, id: '3', is_active: false, is_public: true }\n      ]\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: mockCampaigns, error: null }))\n          }))\n        }))\n      })\n\n      const campaigns = await campaignService.getAllCampaigns(userId)\n      const filtered = await campaignService.filterCampaigns(campaigns, { status: 'paused' })\n\n      expect(filtered).toHaveLength(1)\n      expect(filtered[0].isPaused).toBe(true)\n    })\n\n    it('should return all campaigns when filter is \"all\"', async () => {\n      const mockCampaigns = [\n        { ...mockDbCampaign, id: '1', is_active: false, is_public: false },\n        { ...mockDbCampaign, id: '2', is_active: true, is_public: true }\n      ]\n\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.resolve({ data: mockCampaigns, error: null }))\n          }))\n        }))\n      })\n\n      const campaigns = await campaignService.getAllCampaigns(userId)\n      const filtered = await campaignService.filterCampaigns(campaigns, { status: 'all' })\n\n      expect(filtered).toHaveLength(2)\n    })\n  })\n\n  describe('ðŸ› ï¸ Local Draft Management - Data Safety', () => {\n    it('should detect local draft existence', () => {\n      localStorageMock[`funding-draft-${userId}`] = JSON.stringify({ formData })\n\n      const hasLocalDraft = campaignService.hasLocalDraft(userId)\n      expect(hasLocalDraft).toBe(true)\n    })\n\n    it('should retrieve local draft correctly', () => {\n      const draftData = { formData, currentStep: 2 }\n      localStorageMock[`funding-draft-${userId}`] = JSON.stringify(draftData)\n\n      const localDraft = campaignService.getLocalDraft(userId)\n      expect(localDraft).toBeTruthy()\n      expect(localDraft?.formData.title).toBe(formData.title)\n      expect(localDraft?.currentStep).toBe(2)\n    })\n\n    it('should clear local draft completely', () => {\n      localStorageMock[`funding-draft-${userId}`] = JSON.stringify({ formData })\n\n      campaignService.clearLocalDraft(userId)\n      expect(localStorageMock[`funding-draft-${userId}`]).toBeUndefined()\n    })\n\n    it('should handle corrupted localStorage data gracefully', () => {\n      localStorageMock[`funding-draft-${userId}`] = 'invalid-json-data'\n\n      const localDraft = campaignService.getLocalDraft(userId)\n      expect(localDraft).toBe(null)\n    })\n  })\n\n  describe('âš ï¸ Edge Cases and Error Scenarios', () => {\n    it('should handle empty user ID', async () => {\n      await expect(campaignService.getAllCampaigns('')).rejects.toThrow('User ID is required')\n    })\n\n    it('should handle null/undefined form data', async () => {\n      await expect(campaignService.saveDraft(userId, null as any, 1)).rejects.toThrow()\n    })\n\n    it('should handle network timeouts gracefully', async () => {\n      mockSupabase.from.mockReturnValue({\n        select: jest.fn(() => ({\n          eq: jest.fn(() => ({\n            order: jest.fn(() => Promise.reject(new Error('Network timeout')))\n          }))\n        }))\n      })\n\n      await expect(campaignService.getAllCampaigns(userId)).rejects.toThrow('Network timeout')\n    })\n\n    it('should maintain data consistency during concurrent saves', async () => {\n      const promises = [\n        campaignService.saveDraft(userId, formData, 1),\n        campaignService.saveDraft(userId, formData, 2)\n      ]\n\n      // Both should complete without interfering with each other\n      const results = await Promise.allSettled(promises)\n      expect(results.every(r => r.status === 'fulfilled')).toBe(true)\n    })\n  })\n\n  describe('ðŸ”§ Singleton Pattern - Memory Management', () => {\n    it('should always return the same instance', () => {\n      const instance1 = CampaignService.getInstance()\n      const instance2 = CampaignService.getInstance()\n\n      expect(instance1).toBe(instance2)\n    })\n  })\n})"],"version":3}
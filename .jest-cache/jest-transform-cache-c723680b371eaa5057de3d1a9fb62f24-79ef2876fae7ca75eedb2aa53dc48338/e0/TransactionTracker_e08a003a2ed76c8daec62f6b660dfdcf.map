{"version":3,"names":["cov_1wd5c49wao","actualCoverage","exports","default","TransactionTracker","react_1","s","require","ssr_1","useAuth_1","sonner_1","Card_1","__importDefault","fundingPageId","isOwner","onBalanceUpdate","f","user","useAuth","transactions","setTransactions","useState","loading","setLoading","error","setError","supabase","createBrowserClient","process","env","NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","fetchTransactions","useCallback","data","from","select","eq","order","ascending","b","totalBalance","reduce","sum","tx","amount","err","Error","message","toast","useEffect","channel","on","event","schema","table","filter","subscribe","removeChannel","jsx_runtime_1","jsx","children","className","jsxs","length","map","Date","created_at","toLocaleDateString","id"],"sources":["/home/g/dev/orangecat/src/components/funding/TransactionTracker.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { createBrowserClient } from '@supabase/ssr'\nimport { useAuth } from '@/hooks/useAuth'\nimport { toast } from 'sonner'\nimport Card from '@/components/ui/Card'\n\ninterface TransactionTrackerProps {\n  fundingPageId: string\n  isOwner: boolean\n  onBalanceUpdate: (newBalance: number) => void\n}\n\nexport default function TransactionTracker({ fundingPageId, isOwner, onBalanceUpdate }: TransactionTrackerProps) {\n  const { user } = useAuth()\n  const [transactions, setTransactions] = useState<any[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  const supabase = createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  )\n\n  const fetchTransactions = useCallback(async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      const { data, error } = await supabase\n        .from('transactions')\n        .select('*')\n        .eq('funding_page_id', fundingPageId)\n        .order('created_at', { ascending: false })\n\n      if (error) throw error\n\n      setTransactions(data || [])\n      \n      // Calculate total balance\n      const totalBalance = data?.reduce((sum, tx) => sum + (tx.amount || 0), 0) || 0\n      onBalanceUpdate(totalBalance)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to fetch transactions')\n      toast.error('Failed to fetch transactions')\n    } finally {\n      setLoading(false)\n    }\n  }, [fundingPageId, onBalanceUpdate, supabase])\n\n  useEffect(() => {\n    fetchTransactions()\n\n    // Subscribe to new transactions\n    const channel = supabase\n      .channel('transactions')\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'transactions',\n          filter: `funding_page_id=eq.${fundingPageId}`\n        },\n        () => {\n          fetchTransactions()\n        }\n      )\n      .subscribe()\n\n    return () => {\n      supabase.removeChannel(channel)\n    }\n  }, [fetchTransactions, fundingPageId, supabase])\n\n  if (loading) {\n    return (\n      <Card>\n        <div className=\"p-4\">\n          <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-tiffany-600 border-t-transparent\" />\n        </div>\n      </Card>\n    )\n  }\n\n  if (error) {\n    return (\n      <Card>\n        <div className=\"p-4 text-red-500\">{error}</div>\n      </Card>\n    )\n  }\n\n  return (\n    <Card>\n      <div className=\"p-4\">\n        <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Recent Transactions</h3>\n        {transactions.length === 0 ? (\n          <p className=\"text-gray-500\">No transactions yet</p>\n        ) : (\n          <div className=\"space-y-4\">\n            {transactions.map((tx) => (\n              <div key={tx.id} className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-900\">\n                    {isOwner ? 'Anonymous Donor' : 'You'}\n                  </p>\n                  <p className=\"text-sm text-gray-500\">\n                    {new Date(tx.created_at).toLocaleDateString()}\n                  </p>\n                </div>\n                <p className=\"text-sm font-medium text-tiffany-600\">\n                  {tx.amount} sats\n                </p>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </Card>\n  )\n} "],"mappings":"AAAA,YAAY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAgBH;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAFTE,OAAA,CAAAC,OAAA,GAAAC,kBAAA;;;;AAZA,MAAAC,OAAA;AAAA;AAAA,CAAAL,cAAA,GAAAM,CAAA,OAAAC,OAAA;AACA,MAAAC,KAAA;AAAA;AAAA,CAAAR,cAAA,GAAAM,CAAA,OAAAC,OAAA;AACA,MAAAE,SAAA;AAAA;AAAA,CAAAT,cAAA,GAAAM,CAAA,OAAAC,OAAA;AACA,MAAAG,QAAA;AAAA;AAAA,CAAAV,cAAA,GAAAM,CAAA,OAAAC,OAAA;AACA,MAAAI,MAAA;AAAA;AAAA,CAAAX,cAAA,GAAAM,CAAA,OAAAM,eAAA,CAAAL,OAAA;AAQA,SAAwBH,kBAAkBA,CAAC;EAAES,aAAa;EAAEC,OAAO;EAAEC;AAAe,CAA2B;EAAA;EAAAf,cAAA,GAAAgB,CAAA;EAC7G,MAAM;IAAEC;EAAI,CAAE;EAAA;EAAA,CAAAjB,cAAA,GAAAM,CAAA,QAAG,IAAAG,SAAA,CAAAS,OAAO,GAAE;EAC1B,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC;EAAA;EAAA,CAAApB,cAAA,GAAAM,CAAA,QAAG,IAAAD,OAAA,CAAAgB,QAAQ,EAAQ,EAAE,CAAC;EAC3D,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC;EAAA;EAAA,CAAAvB,cAAA,GAAAM,CAAA,QAAG,IAAAD,OAAA,CAAAgB,QAAQ,EAAC,IAAI,CAAC;EAC5C,MAAM,CAACG,KAAK,EAAEC,QAAQ,CAAC;EAAA;EAAA,CAAAzB,cAAA,GAAAM,CAAA,QAAG,IAAAD,OAAA,CAAAgB,QAAQ,EAAgB,IAAI,CAAC;EAEvD,MAAMK,QAAQ;EAAA;EAAA,CAAA1B,cAAA,GAAAM,CAAA,QAAG,IAAAE,KAAA,CAAAmB,mBAAmB,EAClCC,OAAO,CAACC,GAAG,CAACC,wBAAyB,EACrCF,OAAO,CAACC,GAAG,CAACE,6BAA8B,CAC3C;EAED,MAAMC,iBAAiB;EAAA;EAAA,CAAAhC,cAAA,GAAAM,CAAA,QAAG,IAAAD,OAAA,CAAA4B,WAAW,EAAC,YAAW;IAAA;IAAAjC,cAAA,GAAAgB,CAAA;IAAAhB,cAAA,GAAAM,CAAA;IAC/C,IAAI;MAAA;MAAAN,cAAA,GAAAM,CAAA;MACFiB,UAAU,CAAC,IAAI,CAAC;MAAA;MAAAvB,cAAA,GAAAM,CAAA;MAChBmB,QAAQ,CAAC,IAAI,CAAC;MAEd,MAAM;QAAES,IAAI;QAAEV;MAAK,CAAE;MAAA;MAAA,CAAAxB,cAAA,GAAAM,CAAA,QAAG,MAAMoB,QAAQ,CACnCS,IAAI,CAAC,cAAc,CAAC,CACpBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,iBAAiB,EAAExB,aAAa,CAAC,CACpCyB,KAAK,CAAC,YAAY,EAAE;QAAEC,SAAS,EAAE;MAAK,CAAE,CAAC;MAAA;MAAAvC,cAAA,GAAAM,CAAA;MAE5C,IAAIkB,KAAK,EAAE;QAAA;QAAAxB,cAAA,GAAAwC,CAAA;QAAAxC,cAAA,GAAAM,CAAA;QAAA,MAAMkB,KAAK;MAAA;MAAA;MAAA;QAAAxB,cAAA,GAAAwC,CAAA;MAAA;MAAAxC,cAAA,GAAAM,CAAA;MAEtBc,eAAe;MAAC;MAAA,CAAApB,cAAA,GAAAwC,CAAA,UAAAN,IAAI;MAAA;MAAA,CAAAlC,cAAA,GAAAwC,CAAA,UAAI,EAAE,EAAC;MAE3B;MACA,MAAMC,YAAY;MAAA;MAAA,CAAAzC,cAAA,GAAAM,CAAA;MAAG;MAAA,CAAAN,cAAA,GAAAwC,CAAA;MAAA;MAAA,CAAAxC,cAAA,GAAAwC,CAAA,UAAAN,IAAI;MAAA;MAAA,CAAAlC,cAAA,GAAAwC,CAAA,UAAJN,IAAI;MAAA;MAAA,CAAAlC,cAAA,GAAAwC,CAAA;MAAA;MAAA,CAAAxC,cAAA,GAAAwC,CAAA,UAAJN,IAAI,CAAEQ,MAAM,CAAC,CAACC,GAAG,EAAEC,EAAE,KAAK;QAAA;QAAA5C,cAAA,GAAAgB,CAAA;QAAAhB,cAAA,GAAAM,CAAA;QAAA,OAAAqC,GAAG;QAAI;QAAA,CAAA3C,cAAA,GAAAwC,CAAA,UAAAI,EAAE,CAACC,MAAM;QAAA;QAAA,CAAA7C,cAAA,GAAAwC,CAAA,UAAI,CAAC,EAAC;MAAD,CAAC,EAAE,CAAC,CAAC;MAAA;MAAA,CAAAxC,cAAA,GAAAwC,CAAA,UAAI,CAAC;MAAA;MAAAxC,cAAA,GAAAM,CAAA;MAC9ES,eAAe,CAAC0B,YAAY,CAAC;IAC/B,CAAC,CAAC,OAAOK,GAAG,EAAE;MAAA;MAAA9C,cAAA,GAAAM,CAAA;MACZmB,QAAQ,CAACqB,GAAG,YAAYC,KAAK;MAAA;MAAA,CAAA/C,cAAA,GAAAwC,CAAA,UAAGM,GAAG,CAACE,OAAO;MAAA;MAAA,CAAAhD,cAAA,GAAAwC,CAAA,UAAG,8BAA8B,EAAC;MAAA;MAAAxC,cAAA,GAAAM,CAAA;MAC7EI,QAAA,CAAAuC,KAAK,CAACzB,KAAK,CAAC,8BAA8B,CAAC;IAC7C,CAAC,SAAS;MAAA;MAAAxB,cAAA,GAAAM,CAAA;MACRiB,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC,EAAE,CAACV,aAAa,EAAEE,eAAe,EAAEW,QAAQ,CAAC,CAAC;EAAA;EAAA1B,cAAA,GAAAM,CAAA;EAE9C,IAAAD,OAAA,CAAA6C,SAAS,EAAC,MAAK;IAAA;IAAAlD,cAAA,GAAAgB,CAAA;IAAAhB,cAAA,GAAAM,CAAA;IACb0B,iBAAiB,EAAE;IAEnB;IACA,MAAMmB,OAAO;IAAA;IAAA,CAAAnD,cAAA,GAAAM,CAAA,QAAGoB,QAAQ,CACrByB,OAAO,CAAC,cAAc,CAAC,CACvBC,EAAE,CACD,kBAAkB,EAClB;MACEC,KAAK,EAAE,QAAQ;MACfC,MAAM,EAAE,QAAQ;MAChBC,KAAK,EAAE,cAAc;MACrBC,MAAM,EAAE,sBAAsB3C,aAAa;KAC5C,EACD,MAAK;MAAA;MAAAb,cAAA,GAAAgB,CAAA;MAAAhB,cAAA,GAAAM,CAAA;MACH0B,iBAAiB,EAAE;IACrB,CAAC,CACF,CACAyB,SAAS,EAAE;IAAA;IAAAzD,cAAA,GAAAM,CAAA;IAEd,OAAO,MAAK;MAAA;MAAAN,cAAA,GAAAgB,CAAA;MAAAhB,cAAA,GAAAM,CAAA;MACVoB,QAAQ,CAACgC,aAAa,CAACP,OAAO,CAAC;IACjC,CAAC;EACH,CAAC,EAAE,CAACnB,iBAAiB,EAAEnB,aAAa,EAAEa,QAAQ,CAAC,CAAC;EAAA;EAAA1B,cAAA,GAAAM,CAAA;EAEhD,IAAIgB,OAAO,EAAE;IAAA;IAAAtB,cAAA,GAAAwC,CAAA;IAAAxC,cAAA,GAAAM,CAAA;IACX,OACE,IAAAqD,aAAA,CAAAC,GAAA,EAACjD,MAAA,CAAAR,OAAI;MAAA0D,QAAA,EACH,IAAAF,aAAA,CAAAC,GAAA;QAAKE,SAAS,EAAC,KAAK;QAAAD,QAAA,EAClB,IAAAF,aAAA,CAAAC,GAAA;UAAKE,SAAS,EAAC;QAAoF;MAAG;IAClG,EACD;EAEX,CAAC;EAAA;EAAA;IAAA9D,cAAA,GAAAwC,CAAA;EAAA;EAAAxC,cAAA,GAAAM,CAAA;EAED,IAAIkB,KAAK,EAAE;IAAA;IAAAxB,cAAA,GAAAwC,CAAA;IAAAxC,cAAA,GAAAM,CAAA;IACT,OACE,IAAAqD,aAAA,CAAAC,GAAA,EAACjD,MAAA,CAAAR,OAAI;MAAA0D,QAAA,EACH,IAAAF,aAAA,CAAAC,GAAA;QAAKE,SAAS,EAAC,kBAAkB;QAAAD,QAAA,EAAErC;MAAK;IAAO,EAC1C;EAEX,CAAC;EAAA;EAAA;IAAAxB,cAAA,GAAAwC,CAAA;EAAA;EAAAxC,cAAA,GAAAM,CAAA;EAED,OACE,IAAAqD,aAAA,CAAAC,GAAA,EAACjD,MAAA,CAAAR,OAAI;IAAA0D,QAAA,EACH,IAAAF,aAAA,CAAAI,IAAA;MAAKD,SAAS,EAAC,KAAK;MAAAD,QAAA,GAClB,IAAAF,aAAA,CAAAC,GAAA;QAAIE,SAAS,EAAC,wCAAwC;QAAAD,QAAA;MAAA,EAAyB,EAC9E1C,YAAY,CAAC6C,MAAM,KAAK,CAAC;MAAA;MAAA,CAAAhE,cAAA,GAAAwC,CAAA,WACxB,IAAAmB,aAAA,CAAAC,GAAA;QAAGE,SAAS,EAAC,eAAe;QAAAD,QAAA;MAAA,EAAwB;MAAA;MAAA,CAAA7D,cAAA,GAAAwC,CAAA,WAEpD,IAAAmB,aAAA,CAAAC,GAAA;QAAKE,SAAS,EAAC,WAAW;QAAAD,QAAA,EACvB1C,YAAY,CAAC8C,GAAG,CAAErB,EAAE,IACnB;UAAA;UAAA5C,cAAA,GAAAgB,CAAA;UAAAhB,cAAA,GAAAM,CAAA;UAAA,WAAAqD,aAAA,CAAAI,IAAA;YAAiBD,SAAS,EAAC,mCAAmC;YAAAD,QAAA,GAC5D,IAAAF,aAAA,CAAAI,IAAA;cAAAF,QAAA,GACE,IAAAF,aAAA,CAAAC,GAAA;gBAAGE,SAAS,EAAC,mCAAmC;gBAAAD,QAAA,EAC7C/C,OAAO;gBAAA;gBAAA,CAAAd,cAAA,GAAAwC,CAAA,WAAG,iBAAiB;gBAAA;gBAAA,CAAAxC,cAAA,GAAAwC,CAAA,WAAG,KAAK;cAAA,EAClC,EACJ,IAAAmB,aAAA,CAAAC,GAAA;gBAAGE,SAAS,EAAC,uBAAuB;gBAAAD,QAAA,EACjC,IAAIK,IAAI,CAACtB,EAAE,CAACuB,UAAU,CAAC,CAACC,kBAAkB;cAAE,EAC3C;YAAA,EACA,EACN,IAAAT,aAAA,CAAAI,IAAA;cAAGD,SAAS,EAAC,sCAAsC;cAAAD,QAAA,GAChDjB,EAAE,CAACC,MAAM;YAAA,EACR;UAAA,GAXID,EAAE,CAACyB,EAAE,CAYT;QAZS,CAahB;MAAC,EACE,CACP;IAAA;EACG,EACD;AAEX","ignoreList":[]}
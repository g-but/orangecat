0692bbe757928c8f93a85eb6709e6f92
"use strict";
/**
 * PROFILE SERVICE - MODULAR ARCHITECTURE
 *
 * Created: 2025-01-09
 * Last Modified: 2025-01-09
 * Last Modified Summary: ‚úÖ REFACTORED from 808-line monolith to modular architecture - Option A Phase 1 Complete
 *
 * BEFORE: 808 lines in single file (102% over 400-line limit)
 * AFTER: 6 focused modules with single responsibilities
 *
 * Architecture Benefits:
 * - Single Responsibility Principle
 * - Better testability
 * - Easier maintenance
 * - Improved code reuse
 * - Clear separation of concerns
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProfileService = exports.ProfileWriter = exports.ProfileReader = exports.ProfileMapper = void 0;
// Export all modules
var mapper_1 = require("./mapper");
Object.defineProperty(exports, "ProfileMapper", { enumerable: true, get: function () { return mapper_1.ProfileMapper; } });
var reader_1 = require("./reader");
Object.defineProperty(exports, "ProfileReader", { enumerable: true, get: function () { return reader_1.ProfileReader; } });
var writer_1 = require("./writer");
Object.defineProperty(exports, "ProfileWriter", { enumerable: true, get: function () { return writer_1.ProfileWriter; } });
// Main service class that combines all operations
const client_1 = __importDefault(require("@/services/supabase/client"));
const reader_2 = require("./reader");
const writer_2 = require("./writer");
class ProfileService {
    // =====================================================================
    // üìñ READ OPERATIONS
    // =====================================================================
    static async getProfile(userId) {
        // TODO: Re-enable logger after Jest mocking is fixed
        // logger.debug('ProfileService.getProfile called', { userId }, 'ProfileService');
        return reader_2.ProfileReader.getProfile(userId);
    }
    static async getProfiles(options = {}) {
        return reader_2.ProfileReader.getProfiles(options);
    }
    static async searchProfiles(searchTerm, limit = 20, offset = 0) {
        return reader_2.ProfileReader.searchProfiles(searchTerm, limit, offset);
    }
    static async getAllProfiles() {
        return reader_2.ProfileReader.getAllProfiles();
    }
    static async incrementProfileViews(userId) {
        return reader_2.ProfileReader.incrementProfileViews(userId);
    }
    // =====================================================================
    // ‚úèÔ∏è WRITE OPERATIONS
    // =====================================================================
    static async updateProfile(userId, formData) {
        return writer_2.ProfileWriter.updateProfile(userId, formData);
    }
    static async createProfile(userId, formData) {
        return writer_2.ProfileWriter.createProfile(userId, formData);
    }
    static async updateAnalytics(userId, analytics) {
        return writer_2.ProfileWriter.updateAnalytics(userId, analytics);
    }
    static async deleteProfile(userId) {
        return writer_2.ProfileWriter.deleteProfile(userId);
    }
    static async fallbackProfileUpdate(userId, updates) {
        return writer_2.ProfileWriter.fallbackUpdate(userId, updates);
    }
    // =====================================================================
    // üîê LEGACY COMPATIBILITY METHODS
    // =====================================================================
    static async updatePassword(newPassword) {
        try {
            const result = await client_1.default.auth.updateUser({ password: newPassword });
            if (result && result.error) {
                return { success: false, error: result.error.message || String(result.error) };
            }
            return { success: true };
        }
        catch (err) {
            // Network/authentication or other runtime errors
            const message = (err === null || err === void 0 ? void 0 : err.message) || 'Unexpected error';
            return { success: false, error: message };
        }
    }
}
exports.ProfileService = ProfileService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy9zZXJ2aWNlcy9wcm9maWxlL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7OztHQWdCRzs7Ozs7O0FBVUgscUJBQXFCO0FBQ3JCLG1DQUF5QztBQUFoQyx1R0FBQSxhQUFhLE9BQUE7QUFDdEIsbUNBQXlDO0FBQWhDLHVHQUFBLGFBQWEsT0FBQTtBQUN0QixtQ0FBeUM7QUFBaEMsdUdBQUEsYUFBYSxPQUFBO0FBRXRCLGtEQUFrRDtBQUNsRCx3RUFBa0Q7QUFDbEQscUNBQXlDO0FBQ3pDLHFDQUF5QztBQUl6QyxNQUFhLGNBQWM7SUFDekIsd0VBQXdFO0lBQ3hFLHFCQUFxQjtJQUNyQix3RUFBd0U7SUFFeEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBYztRQUNwQyxxREFBcUQ7UUFDckQsa0ZBQWtGO1FBQ2xGLE9BQU8sc0JBQWEsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVELE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFVBS3JCLEVBQUU7UUFDSixPQUFPLHNCQUFhLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FDekIsVUFBa0IsRUFDbEIsUUFBZ0IsRUFBRSxFQUNsQixTQUFpQixDQUFDO1FBRWxCLE9BQU8sc0JBQWEsQ0FBQyxjQUFjLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjO1FBQ3pCLE9BQU8sc0JBQWEsQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN4QyxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxNQUFjO1FBQy9DLE9BQU8sc0JBQWEsQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsd0VBQXdFO0lBQ3hFLHNCQUFzQjtJQUN0Qix3RUFBd0U7SUFFeEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQ3hCLE1BQWMsRUFDZCxRQUFpQztRQUVqQyxPQUFPLHNCQUFhLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQ3hCLE1BQWMsRUFDZCxRQUFpQztRQUVqQyxPQUFPLHNCQUFhLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQzFCLE1BQWMsRUFDZCxTQUEyQjtRQUUzQixPQUFPLHNCQUFhLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBYztRQUN2QyxPQUFPLHNCQUFhLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdDLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUNoQyxNQUFjLEVBQ2QsT0FBNEI7UUFFNUIsT0FBTyxzQkFBYSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELHdFQUF3RTtJQUN4RSxrQ0FBa0M7SUFDbEMsd0VBQXdFO0lBRXhFLE1BQU0sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLFdBQW1CO1FBQzdDLElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUE7WUFFeEUsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUMzQixPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFBO1lBQ2hGLENBQUM7WUFFRCxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFBO1FBQzFCLENBQUM7UUFBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2IsaURBQWlEO1lBQ2pELE1BQU0sT0FBTyxHQUFHLENBQUMsR0FBYSxhQUFiLEdBQUcsdUJBQUgsR0FBRyxDQUFZLE9BQU8sS0FBSSxrQkFBa0IsQ0FBQTtZQUM3RCxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUE7UUFDM0MsQ0FBQztJQUNILENBQUM7Q0FDRjtBQTNGRCx3Q0EyRkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy9zZXJ2aWNlcy9wcm9maWxlL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUFJPRklMRSBTRVJWSUNFIC0gTU9EVUxBUiBBUkNISVRFQ1RVUkVcbiAqIFxuICogQ3JlYXRlZDogMjAyNS0wMS0wOVxuICogTGFzdCBNb2RpZmllZDogMjAyNS0wMS0wOVxuICogTGFzdCBNb2RpZmllZCBTdW1tYXJ5OiDinIUgUkVGQUNUT1JFRCBmcm9tIDgwOC1saW5lIG1vbm9saXRoIHRvIG1vZHVsYXIgYXJjaGl0ZWN0dXJlIC0gT3B0aW9uIEEgUGhhc2UgMSBDb21wbGV0ZVxuICogXG4gKiBCRUZPUkU6IDgwOCBsaW5lcyBpbiBzaW5nbGUgZmlsZSAoMTAyJSBvdmVyIDQwMC1saW5lIGxpbWl0KVxuICogQUZURVI6IDYgZm9jdXNlZCBtb2R1bGVzIHdpdGggc2luZ2xlIHJlc3BvbnNpYmlsaXRpZXNcbiAqIFxuICogQXJjaGl0ZWN0dXJlIEJlbmVmaXRzOlxuICogLSBTaW5nbGUgUmVzcG9uc2liaWxpdHkgUHJpbmNpcGxlXG4gKiAtIEJldHRlciB0ZXN0YWJpbGl0eVxuICogLSBFYXNpZXIgbWFpbnRlbmFuY2VcbiAqIC0gSW1wcm92ZWQgY29kZSByZXVzZVxuICogLSBDbGVhciBzZXBhcmF0aW9uIG9mIGNvbmNlcm5zXG4gKi9cblxuLy8gRXhwb3J0IGFsbCB0eXBlc1xuZXhwb3J0IHR5cGUge1xuICBTY2FsYWJsZVByb2ZpbGUsXG4gIFNjYWxhYmxlUHJvZmlsZUZvcm1EYXRhLFxuICBQcm9maWxlQW5hbHl0aWNzLFxuICBQcm9maWxlU2VydmljZVJlc3BvbnNlXG59IGZyb20gJy4vdHlwZXMnO1xuXG4vLyBFeHBvcnQgYWxsIG1vZHVsZXNcbmV4cG9ydCB7IFByb2ZpbGVNYXBwZXIgfSBmcm9tICcuL21hcHBlcic7XG5leHBvcnQgeyBQcm9maWxlUmVhZGVyIH0gZnJvbSAnLi9yZWFkZXInO1xuZXhwb3J0IHsgUHJvZmlsZVdyaXRlciB9IGZyb20gJy4vd3JpdGVyJztcblxuLy8gTWFpbiBzZXJ2aWNlIGNsYXNzIHRoYXQgY29tYmluZXMgYWxsIG9wZXJhdGlvbnNcbmltcG9ydCBzdXBhYmFzZSBmcm9tICdAL3NlcnZpY2VzL3N1cGFiYXNlL2NsaWVudCc7XG5pbXBvcnQgeyBQcm9maWxlUmVhZGVyIH0gZnJvbSAnLi9yZWFkZXInO1xuaW1wb3J0IHsgUHJvZmlsZVdyaXRlciB9IGZyb20gJy4vd3JpdGVyJztcbmltcG9ydCB0eXBlIHsgU2NhbGFibGVQcm9maWxlLCBTY2FsYWJsZVByb2ZpbGVGb3JtRGF0YSwgUHJvZmlsZUFuYWx5dGljcywgUHJvZmlsZVNlcnZpY2VSZXNwb25zZSB9IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuXG5leHBvcnQgY2xhc3MgUHJvZmlsZVNlcnZpY2Uge1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g8J+TliBSRUFEIE9QRVJBVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIFxuICBzdGF0aWMgYXN5bmMgZ2V0UHJvZmlsZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8U2NhbGFibGVQcm9maWxlIHwgbnVsbD4ge1xuICAgIC8vIFRPRE86IFJlLWVuYWJsZSBsb2dnZXIgYWZ0ZXIgSmVzdCBtb2NraW5nIGlzIGZpeGVkXG4gICAgLy8gbG9nZ2VyLmRlYnVnKCdQcm9maWxlU2VydmljZS5nZXRQcm9maWxlIGNhbGxlZCcsIHsgdXNlcklkIH0sICdQcm9maWxlU2VydmljZScpO1xuICAgIHJldHVybiBQcm9maWxlUmVhZGVyLmdldFByb2ZpbGUodXNlcklkKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRQcm9maWxlcyhvcHRpb25zOiB7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIG9yZGVyQnk/OiBzdHJpbmc7XG4gICAgb3JkZXJEaXJlY3Rpb24/OiAnYXNjJyB8ICdkZXNjJztcbiAgfSA9IHt9KTogUHJvbWlzZTxTY2FsYWJsZVByb2ZpbGVbXT4ge1xuICAgIHJldHVybiBQcm9maWxlUmVhZGVyLmdldFByb2ZpbGVzKG9wdGlvbnMpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIHNlYXJjaFByb2ZpbGVzKFxuICAgIHNlYXJjaFRlcm06IHN0cmluZyxcbiAgICBsaW1pdDogbnVtYmVyID0gMjAsXG4gICAgb2Zmc2V0OiBudW1iZXIgPSAwXG4gICk6IFByb21pc2U8U2NhbGFibGVQcm9maWxlW10+IHtcbiAgICByZXR1cm4gUHJvZmlsZVJlYWRlci5zZWFyY2hQcm9maWxlcyhzZWFyY2hUZXJtLCBsaW1pdCwgb2Zmc2V0KTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBnZXRBbGxQcm9maWxlcygpOiBQcm9taXNlPFNjYWxhYmxlUHJvZmlsZVtdPiB7XG4gICAgcmV0dXJuIFByb2ZpbGVSZWFkZXIuZ2V0QWxsUHJvZmlsZXMoKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBpbmNyZW1lbnRQcm9maWxlVmlld3ModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gUHJvZmlsZVJlYWRlci5pbmNyZW1lbnRQcm9maWxlVmlld3ModXNlcklkKTtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDinI/vuI8gV1JJVEUgT1BFUkFUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBzdGF0aWMgYXN5bmMgdXBkYXRlUHJvZmlsZShcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBmb3JtRGF0YTogU2NhbGFibGVQcm9maWxlRm9ybURhdGFcbiAgKTogUHJvbWlzZTxQcm9maWxlU2VydmljZVJlc3BvbnNlPFNjYWxhYmxlUHJvZmlsZT4+IHtcbiAgICByZXR1cm4gUHJvZmlsZVdyaXRlci51cGRhdGVQcm9maWxlKHVzZXJJZCwgZm9ybURhdGEpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGNyZWF0ZVByb2ZpbGUoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgZm9ybURhdGE6IFNjYWxhYmxlUHJvZmlsZUZvcm1EYXRhXG4gICk6IFByb21pc2U8UHJvZmlsZVNlcnZpY2VSZXNwb25zZTxTY2FsYWJsZVByb2ZpbGU+PiB7XG4gICAgcmV0dXJuIFByb2ZpbGVXcml0ZXIuY3JlYXRlUHJvZmlsZSh1c2VySWQsIGZvcm1EYXRhKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVBbmFseXRpY3MoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgYW5hbHl0aWNzOiBQcm9maWxlQW5hbHl0aWNzXG4gICk6IFByb21pc2U8UHJvZmlsZVNlcnZpY2VSZXNwb25zZTx2b2lkPj4ge1xuICAgIHJldHVybiBQcm9maWxlV3JpdGVyLnVwZGF0ZUFuYWx5dGljcyh1c2VySWQsIGFuYWx5dGljcyk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgZGVsZXRlUHJvZmlsZSh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8UHJvZmlsZVNlcnZpY2VSZXNwb25zZTx2b2lkPj4ge1xuICAgIHJldHVybiBQcm9maWxlV3JpdGVyLmRlbGV0ZVByb2ZpbGUodXNlcklkKTtcbiAgfVxuXG4gIHN0YXRpYyBhc3luYyBmYWxsYmFja1Byb2ZpbGVVcGRhdGUoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUmVjb3JkPHN0cmluZywgYW55PlxuICApOiBQcm9taXNlPFByb2ZpbGVTZXJ2aWNlUmVzcG9uc2U8YW55Pj4ge1xuICAgIHJldHVybiBQcm9maWxlV3JpdGVyLmZhbGxiYWNrVXBkYXRlKHVzZXJJZCwgdXBkYXRlcyk7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g8J+UkCBMRUdBQ1kgQ09NUEFUSUJJTElUWSBNRVRIT0RTXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVQYXNzd29yZChuZXdQYXNzd29yZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC51cGRhdGVVc2VyKHsgcGFzc3dvcmQ6IG5ld1Bhc3N3b3JkIH0pXG5cbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogcmVzdWx0LmVycm9yLm1lc3NhZ2UgfHwgU3RyaW5nKHJlc3VsdC5lcnJvcikgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIE5ldHdvcmsvYXV0aGVudGljYXRpb24gb3Igb3RoZXIgcnVudGltZSBlcnJvcnNcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSAoZXJyIGFzIEVycm9yKT8ubWVzc2FnZSB8fCAnVW5leHBlY3RlZCBlcnJvcidcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogbWVzc2FnZSB9XG4gICAgfVxuICB9XG59ICJdLCJ2ZXJzaW9uIjozfQ==
30d3285ec2c089faf7ae12902ddd9bdb
"use strict";
/**
 * ASSOCIATION SERVICE - TESLA-GRADE SOCIAL CONNECTIONS
 *
 * This service implements the revolutionary association system that transforms
 * OrangeCat from individual profiles to a Bitcoin-native social platform.
 *
 * Key Features:
 * - Bitcoin-native value transfer in relationships
 * - Event-sourced architecture with full audit trails
 * - Real-time synchronization across the platform
 * - Masterful abstraction of complex relationships
 *
 * Created: 2025-01-08
 * Last Modified: 2025-01-08
 * Last Modified Summary: Enhanced error handling and method chaining
 */
Object.defineProperty(exports, "__esModule", { value: true });
const client_1 = require("./core/client");
const logger_1 = require("@/utils/logger");
// ==================================
// ðŸš€ CORE ASSOCIATION SERVICE
// ==================================
class AssociationService {
    // ==================================
    // âž• CREATE OPERATIONS
    // ==================================
    /**
     * Create a new association between a profile and an entity
     */
    static async createAssociation(input) {
        try {
            // Get authenticated user
            const { data: { user }, error: authError } = await client_1.supabase.auth.getUser();
            if (authError || !user) {
                throw new Error('Authentication required');
            }
            // Prepare association data
            const associationData = {
                source_profile_id: user.id,
                target_entity_id: input.target_entity_id,
                target_entity_type: input.target_entity_type,
                relationship_type: input.relationship_type,
                role: input.role,
                bitcoin_reward_address: input.bitcoin_reward_address,
                reward_percentage: input.reward_percentage || 0,
                permissions: input.permissions || {},
                metadata: input.metadata || {},
                visibility: input.visibility || 'public',
                starts_at: new Date().toISOString(),
                version: 1,
                created_by: user.id,
                last_modified_by: user.id
            };
            // Create association
            const { data, error } = await client_1.supabase
                .from('profile_associations')
                .insert(associationData)
                .select()
                .single();
            if (error) {
                logger_1.logger.error('Failed to create association', { error, input });
                throw new Error(`Failed to create association: ${error.message}`);
            }
            if (!data) {
                throw new Error('Failed to create association: No data returned');
            }
            logger_1.logger.info('Association created successfully', {
                associationId: data.id,
                profileId: user.id
            });
            return data;
        }
        catch (error) {
            logger_1.logger.error('Error in createAssociation', { error, input });
            throw error;
        }
    }
    /**
     * Create multiple associations in bulk
     */
    static async createBulkAssociations(inputs) {
        try {
            // Get authenticated user
            const { data: { user }, error: authError } = await client_1.supabase.auth.getUser();
            if (authError || !user) {
                throw new Error('Authentication required');
            }
            // Prepare all association data
            const associationsData = inputs.map(input => ({
                source_profile_id: user.id,
                target_entity_id: input.target_entity_id,
                target_entity_type: input.target_entity_type,
                relationship_type: input.relationship_type,
                role: input.role,
                bitcoin_reward_address: input.bitcoin_reward_address,
                reward_percentage: input.reward_percentage || 0,
                permissions: input.permissions || {},
                metadata: input.metadata || {},
                visibility: input.visibility || 'public',
                starts_at: new Date().toISOString(),
                version: 1,
                created_by: user.id,
                last_modified_by: user.id
            }));
            // Create associations
            const { data, error } = await client_1.supabase
                .from('profile_associations')
                .insert(associationsData)
                .select();
            if (error) {
                logger_1.logger.error('Failed to create bulk associations', { error, inputs });
                throw new Error(`Failed to create bulk associations: ${error.message}`);
            }
            if (!data) {
                throw new Error('Failed to create bulk associations: No data returned');
            }
            logger_1.logger.info('Bulk associations created successfully', {
                count: data.length,
                profileId: user.id
            });
            return data;
        }
        catch (error) {
            logger_1.logger.error('Error in createBulkAssociations', { error, inputs });
            throw error;
        }
    }
    // ==================================
    // ðŸ“– READ OPERATIONS
    // ==================================
    /**
     * Get associations for a specific profile with filtering and pagination
     */
    static async getProfileAssociations(profileId, filters, options) {
        var _a, _b, _c, _d;
        try {
            // Start building query
            let query = client_1.supabase
                .from('profile_associations')
                .select(this.buildSelectClause(options))
                .eq('source_profile_id', profileId);
            // Apply filters
            if (filters) {
                if ((_a = filters.relationship_type) === null || _a === void 0 ? void 0 : _a.length) {
                    query = query.in('relationship_type', filters.relationship_type);
                }
                if ((_b = filters.target_entity_type) === null || _b === void 0 ? void 0 : _b.length) {
                    query = query.in('target_entity_type', filters.target_entity_type);
                }
                if ((_c = filters.status) === null || _c === void 0 ? void 0 : _c.length) {
                    query = query.in('status', filters.status);
                }
                if ((_d = filters.visibility) === null || _d === void 0 ? void 0 : _d.length) {
                    query = query.in('visibility', filters.visibility);
                }
                if (filters.created_after) {
                    query = query.gte('created_at', filters.created_after);
                }
                if (filters.created_before) {
                    query = query.lte('created_at', filters.created_before);
                }
                if (filters.has_bitcoin_reward !== undefined) {
                    if (filters.has_bitcoin_reward) {
                        query = query.not('bitcoin_reward_address', 'is', null);
                    }
                    else {
                        query = query.is('bitcoin_reward_address', null);
                    }
                }
            }
            // Apply ordering
            const orderBy = (options === null || options === void 0 ? void 0 : options.order_by) || 'created_at';
            const ascending = (options === null || options === void 0 ? void 0 : options.order_direction) === 'asc';
            query = query.order(orderBy, { ascending });
            // Apply pagination
            if ((options === null || options === void 0 ? void 0 : options.limit) || (options === null || options === void 0 ? void 0 : options.offset)) {
                const limit = options.limit || 50;
                const offset = options.offset || 0;
                query = query.range(offset, offset + limit - 1);
            }
            const { data, error } = await query;
            if (error) {
                logger_1.logger.error('Failed to get profile associations', { error, profileId });
                throw new Error(`Failed to get profile associations: ${error.message}`);
            }
            return (data || []);
        }
        catch (error) {
            logger_1.logger.error('Error in getProfileAssociations', { error, profileId });
            throw error;
        }
    }
    /**
     * Get associations for a specific entity
     */
    static async getEntityAssociations(entityId, entityType, filters, options) {
        var _a, _b, _c;
        try {
            let query = client_1.supabase
                .from('profile_associations')
                .select(this.buildSelectClause(options))
                .eq('target_entity_id', entityId)
                .eq('target_entity_type', entityType);
            // Apply filters (same as getProfileAssociations)
            if (filters) {
                if ((_a = filters.relationship_type) === null || _a === void 0 ? void 0 : _a.length) {
                    query = query.in('relationship_type', filters.relationship_type);
                }
                if ((_b = filters.status) === null || _b === void 0 ? void 0 : _b.length) {
                    query = query.in('status', filters.status);
                }
                if ((_c = filters.visibility) === null || _c === void 0 ? void 0 : _c.length) {
                    query = query.in('visibility', filters.visibility);
                }
            }
            // Apply ordering
            const orderBy = (options === null || options === void 0 ? void 0 : options.order_by) || 'created_at';
            const ascending = (options === null || options === void 0 ? void 0 : options.order_direction) === 'asc';
            query = query.order(orderBy, { ascending });
            // Apply pagination
            if ((options === null || options === void 0 ? void 0 : options.limit) || (options === null || options === void 0 ? void 0 : options.offset)) {
                const limit = options.limit || 50;
                const offset = options.offset || 0;
                query = query.range(offset, offset + limit - 1);
            }
            const { data, error } = await query;
            if (error) {
                logger_1.logger.error('Failed to get entity associations', { error, entityId, entityType });
                throw new Error(`Failed to get entity associations: ${error.message}`);
            }
            return (data || []);
        }
        catch (error) {
            logger_1.logger.error('Error in getEntityAssociations', { error, entityId });
            throw error;
        }
    }
    // ==================================
    // âœï¸ UPDATE OPERATIONS
    // ==================================
    /**
     * Update an existing association
     */
    static async updateAssociation(associationId, updates) {
        try {
            const updateData = Object.assign(Object.assign({}, updates), { updated_at: new Date().toISOString(), version: updates.version ? updates.version + 1 : undefined });
            const { data, error } = await client_1.supabase
                .from('profile_associations')
                .update(updateData)
                .eq('id', associationId)
                .select()
                .single();
            if (error) {
                logger_1.logger.error('Failed to update association', { error, associationId, updates });
                throw new Error(`Failed to update association: ${error.message}`);
            }
            if (!data) {
                throw new Error('Failed to update association: No data returned');
            }
            logger_1.logger.info('Association updated successfully', { associationId });
            return data;
        }
        catch (error) {
            logger_1.logger.error('Error in updateAssociation', { error, associationId });
            throw error;
        }
    }
    // ==================================
    // âŒ DELETE OPERATIONS
    // ==================================
    /**
     * Delete an association
     */
    static async deleteAssociation(associationId) {
        try {
            const { error } = await client_1.supabase
                .from('profile_associations')
                .delete()
                .eq('id', associationId);
            if (error) {
                logger_1.logger.error('Failed to delete association', { error, associationId });
                throw new Error(`Failed to delete association: ${error.message}`);
            }
            logger_1.logger.info('Association deleted successfully', { associationId });
        }
        catch (error) {
            logger_1.logger.error('Error in deleteAssociation', { error, associationId });
            throw error;
        }
    }
    // ==================================
    // ðŸ“Š ANALYTICS OPERATIONS
    // ==================================
    /**
     * Get comprehensive association statistics for a profile
     */
    static async getAssociationStats(profileId) {
        try {
            const associations = await this.getProfileAssociations(profileId);
            const stats = {
                total_associations: associations.length,
                by_type: {},
                by_entity_type: {},
                recent_activity: associations.slice(0, 10),
                bitcoin_connections: 0,
                total_reward_percentage: 0
            };
            // Calculate statistics
            associations.forEach(association => {
                // Count by relationship type
                stats.by_type[association.relationship_type] =
                    (stats.by_type[association.relationship_type] || 0) + 1;
                // Count by entity type
                stats.by_entity_type[association.target_entity_type] =
                    (stats.by_entity_type[association.target_entity_type] || 0) + 1;
                // Count Bitcoin connections
                if (association.bitcoin_reward_address) {
                    stats.bitcoin_connections++;
                    stats.total_reward_percentage += association.reward_percentage;
                }
            });
            return stats;
        }
        catch (error) {
            logger_1.logger.error('Error in getAssociationStats', { error, profileId });
            throw error;
        }
    }
    // ==================================
    // ðŸ”§ UTILITY METHODS
    // ==================================
    /**
     * Build select clause based on options
     */
    static buildSelectClause(options) {
        // Default select all columns
        return '*';
    }
    /**
     * Get association by ID
     */
    static async getAssociationById(associationId) {
        try {
            const { data, error } = await client_1.supabase
                .from('profile_associations')
                .select('*')
                .eq('id', associationId)
                .single();
            if (error) {
                if (error.code === 'PGRST116') {
                    return null; // Not found
                }
                logger_1.logger.error('Failed to get association by ID', { error, associationId });
                throw new Error(`Failed to get association: ${error.message}`);
            }
            return data;
        }
        catch (error) {
            logger_1.logger.error('Error in getAssociationById', { error, associationId });
            throw error;
        }
    }
    /**
     * Check if association exists
     */
    static async associationExists(sourceProfileId, targetEntityId, relationshipType) {
        try {
            const { data, error } = await client_1.supabase
                .from('profile_associations')
                .select('id')
                .eq('source_profile_id', sourceProfileId)
                .eq('target_entity_id', targetEntityId)
                .eq('relationship_type', relationshipType)
                .limit(1);
            if (error) {
                logger_1.logger.error('Failed to check association existence', { error });
                return false;
            }
            return ((data === null || data === void 0 ? void 0 : data.length) || 0) > 0;
        }
        catch (error) {
            logger_1.logger.error('Error in associationExists', { error });
            return false;
        }
    }
}
exports.default = AssociationService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy9zZXJ2aWNlcy9zdXBhYmFzZS9hc3NvY2lhdGlvbnMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7R0FlRzs7QUFFSCwwQ0FBd0M7QUFFeEMsMkNBQXVDO0FBcUZ2QyxxQ0FBcUM7QUFDckMsOEJBQThCO0FBQzlCLHFDQUFxQztBQUVyQyxNQUFNLGtCQUFrQjtJQUV0QixxQ0FBcUM7SUFDckMsc0JBQXNCO0lBQ3RCLHFDQUFxQztJQUVyQzs7T0FFRztJQUNILE1BQU0sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsS0FBNkI7UUFDMUQsSUFBSSxDQUFDO1lBQ0gseUJBQXlCO1lBQ3pCLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLEdBQUcsTUFBTSxpQkFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtZQUMxRSxJQUFJLFNBQVMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUN2QixNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUE7WUFDNUMsQ0FBQztZQUVELDJCQUEyQjtZQUMzQixNQUFNLGVBQWUsR0FBRztnQkFDdEIsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUU7Z0JBQzFCLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxnQkFBZ0I7Z0JBQ3hDLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxrQkFBa0I7Z0JBQzVDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxpQkFBaUI7Z0JBQzFDLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSTtnQkFDaEIsc0JBQXNCLEVBQUUsS0FBSyxDQUFDLHNCQUFzQjtnQkFDcEQsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLGlCQUFpQixJQUFJLENBQUM7Z0JBQy9DLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVyxJQUFJLEVBQUU7Z0JBQ3BDLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUSxJQUFJLEVBQUU7Z0JBQzlC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LENBQUEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvZy9kZXYvb3JhbmdlY2F0L3NyYy9zZXJ2aWNlcy9zdXBhYmFzZS9hc3NvY2lhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBU1NPQ0lBVElPTiBTRVJWSUNFIC0gVEVTTEEtR1JBREUgU09DSUFMIENPTk5FQ1RJT05TXG4gKiBcbiAqIFRoaXMgc2VydmljZSBpbXBsZW1lbnRzIHRoZSByZXZvbHV0aW9uYXJ5IGFzc29jaWF0aW9uIHN5c3RlbSB0aGF0IHRyYW5zZm9ybXNcbiAqIE9yYW5nZUNhdCBmcm9tIGluZGl2aWR1YWwgcHJvZmlsZXMgdG8gYSBCaXRjb2luLW5hdGl2ZSBzb2NpYWwgcGxhdGZvcm0uXG4gKiBcbiAqIEtleSBGZWF0dXJlczpcbiAqIC0gQml0Y29pbi1uYXRpdmUgdmFsdWUgdHJhbnNmZXIgaW4gcmVsYXRpb25zaGlwc1xuICogLSBFdmVudC1zb3VyY2VkIGFyY2hpdGVjdHVyZSB3aXRoIGZ1bGwgYXVkaXQgdHJhaWxzXG4gKiAtIFJlYWwtdGltZSBzeW5jaHJvbml6YXRpb24gYWNyb3NzIHRoZSBwbGF0Zm9ybVxuICogLSBNYXN0ZXJmdWwgYWJzdHJhY3Rpb24gb2YgY29tcGxleCByZWxhdGlvbnNoaXBzXG4gKiBcbiAqIENyZWF0ZWQ6IDIwMjUtMDEtMDhcbiAqIExhc3QgTW9kaWZpZWQ6IDIwMjUtMDEtMDhcbiAqIExhc3QgTW9kaWZpZWQgU3VtbWFyeTogRW5oYW5jZWQgZXJyb3IgaGFuZGxpbmcgYW5kIG1ldGhvZCBjaGFpbmluZ1xuICovXG5cbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSAnLi9jb3JlL2NsaWVudCdcbmltcG9ydCB0eXBlIHsgRGF0YWJhc2UgfSBmcm9tICdAL3R5cGVzL2RhdGFiYXNlJ1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIPCfj5fvuI8gVFlQRSBERUZJTklUSU9OUzogQlVMTEVUUFJPT0YgQ09OVFJBQ1RTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8vIENvcmUgYXNzb2NpYXRpb24gZW50aXR5XG5leHBvcnQgaW50ZXJmYWNlIEFzc29jaWF0aW9uIHtcbiAgaWQ6IHN0cmluZ1xuICBzb3VyY2VfcHJvZmlsZV9pZDogc3RyaW5nXG4gIHRhcmdldF9lbnRpdHlfaWQ6IHN0cmluZ1xuICB0YXJnZXRfZW50aXR5X3R5cGU6ICdwcm9maWxlJyB8ICdjYW1wYWlnbicgfCAnb3JnYW5pemF0aW9uJyB8ICdjb2xsZWN0aXZlJyB8ICdwcm9qZWN0J1xuICByZWxhdGlvbnNoaXBfdHlwZTogJ2NyZWF0ZWQnIHwgJ2ZvdW5kZWQnIHwgJ3N1cHBvcnRzJyB8ICdjb2xsYWJvcmF0ZXMnIHwgJ21haW50YWlucycgfCBcbiAgICAgICAgICAgICAgICAgICAgICdtZW1iZXInIHwgJ2xlYWRlcicgfCAnbW9kZXJhdG9yJyB8ICdjb250cmlidXRvcicgfCAnYWR2aXNvcicgfFxuICAgICAgICAgICAgICAgICAgICAgJ2ludmVzdG9yJyB8ICdzcG9uc29yJyB8ICdwYXJ0bmVyJyB8ICdiZW5lZmljaWFyeSdcbiAgcm9sZT86IHN0cmluZ1xuICBzdGF0dXM6ICdhY3RpdmUnIHwgJ2luYWN0aXZlJyB8ICdwZW5kaW5nJyB8ICdjb21wbGV0ZWQnIHwgJ3N1c3BlbmRlZCcgfCAnZGlzcHV0ZWQnXG4gIGJpdGNvaW5fcmV3YXJkX2FkZHJlc3M/OiBzdHJpbmdcbiAgcmV3YXJkX3BlcmNlbnRhZ2U6IG51bWJlclxuICBwZXJtaXNzaW9uczogUmVjb3JkPHN0cmluZywgYW55PlxuICBtZXRhZGF0YTogUmVjb3JkPHN0cmluZywgYW55PlxuICB2aXNpYmlsaXR5OiAncHVibGljJyB8ICdtZW1iZXJzX29ubHknIHwgJ3ByaXZhdGUnIHwgJ2NvbmZpZGVudGlhbCdcbiAgc3RhcnRzX2F0OiBzdHJpbmdcbiAgZW5kc19hdD86IHN0cmluZ1xuICBjcmVhdGVkX2F0OiBzdHJpbmdcbiAgdXBkYXRlZF9hdDogc3RyaW5nXG4gIHZlcnNpb246IG51bWJlclxuICBjcmVhdGVkX2J5Pzogc3RyaW5nXG4gIGxhc3RfbW9kaWZpZWRfYnk/OiBzdHJpbmdcbn1cblxuLy8gSW5wdXQgZm9yIGNyZWF0aW5nIGFzc29jaWF0aW9uc1xuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVBc3NvY2lhdGlvbklucHV0IHtcbiAgdGFyZ2V0X2VudGl0eV9pZDogc3RyaW5nXG4gIHRhcmdldF9lbnRpdHlfdHlwZTogQXNzb2NpYXRpb25bJ3RhcmdldF9lbnRpdHlfdHlwZSddXG4gIHJlbGF0aW9uc2hpcF90eXBlOiBBc3NvY2lhdGlvblsncmVsYXRpb25zaGlwX3R5cGUnXVxuICByb2xlPzogc3RyaW5nXG4gIGJpdGNvaW5fcmV3YXJkX2FkZHJlc3M/OiBzdHJpbmdcbiAgcmV3YXJkX3BlcmNlbnRhZ2U/OiBudW1iZXJcbiAgcGVybWlzc2lvbnM/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuICB2aXNpYmlsaXR5PzogQXNzb2NpYXRpb25bJ3Zpc2liaWxpdHknXVxufVxuXG4vLyBJbnB1dCBmb3IgdXBkYXRpbmcgYXNzb2NpYXRpb25zXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZUFzc29jaWF0aW9uSW5wdXQge1xuICByb2xlPzogc3RyaW5nXG4gIHN0YXR1cz86IEFzc29jaWF0aW9uWydzdGF0dXMnXVxuICBiaXRjb2luX3Jld2FyZF9hZGRyZXNzPzogc3RyaW5nXG4gIHJld2FyZF9wZXJjZW50YWdlPzogbnVtYmVyXG4gIHBlcm1pc3Npb25zPzogUmVjb3JkPHN0cmluZywgYW55PlxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgdmlzaWJpbGl0eT86IEFzc29jaWF0aW9uWyd2aXNpYmlsaXR5J11cbiAgZW5kc19hdD86IHN0cmluZ1xufVxuXG4vLyBRdWVyeSBmaWx0ZXJzIGZvciBhc3NvY2lhdGlvbnNcbmV4cG9ydCBpbnRlcmZhY2UgQXNzb2NpYXRpb25GaWx0ZXJzIHtcbiAgcmVsYXRpb25zaGlwX3R5cGU/OiBBc3NvY2lhdGlvblsncmVsYXRpb25zaGlwX3R5cGUnXVtdXG4gIHRhcmdldF9lbnRpdHlfdHlwZT86IEFzc29jaWF0aW9uWyd0YXJnZXRfZW50aXR5X3R5cGUnXVtdXG4gIHN0YXR1cz86IEFzc29jaWF0aW9uWydzdGF0dXMnXVtdXG4gIHZpc2liaWxpdHk/OiBBc3NvY2lhdGlvblsndmlzaWJpbGl0eSddW11cbiAgY3JlYXRlZF9hZnRlcj86IHN0cmluZ1xuICBjcmVhdGVkX2JlZm9yZT86IHN0cmluZ1xuICBoYXNfYml0Y29pbl9yZXdhcmQ/OiBib29sZWFuXG59XG5cbi8vIFF1ZXJ5IG9wdGlvbnNcbmV4cG9ydCBpbnRlcmZhY2UgUXVlcnlPcHRpb25zIHtcbiAgbGltaXQ/OiBudW1iZXJcbiAgb2Zmc2V0PzogbnVtYmVyXG4gIG9yZGVyX2J5Pzogc3RyaW5nXG4gIG9yZGVyX2RpcmVjdGlvbj86ICdhc2MnIHwgJ2Rlc2MnXG59XG5cbi8vIEFzc29jaWF0aW9uIHN0YXRpc3RpY3NcbmV4cG9ydCBpbnRlcmZhY2UgQXNzb2NpYXRpb25TdGF0cyB7XG4gIHRvdGFsX2Fzc29jaWF0aW9uczogbnVtYmVyXG4gIGJ5X3R5cGU6IFJlY29yZDxzdHJpbmcsIG51bWJlcj5cbiAgYnlfZW50aXR5X3R5cGU6IFJlY29yZDxzdHJpbmcsIG51bWJlcj5cbiAgcmVjZW50X2FjdGl2aXR5OiBBc3NvY2lhdGlvbltdXG4gIGJpdGNvaW5fY29ubmVjdGlvbnM6IG51bWJlclxuICB0b3RhbF9yZXdhcmRfcGVyY2VudGFnZTogbnVtYmVyXG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIPCfmoAgQ09SRSBBU1NPQ0lBVElPTiBTRVJWSUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNsYXNzIEFzc29jaWF0aW9uU2VydmljZSB7XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDinpUgQ1JFQVRFIE9QRVJBVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgYXNzb2NpYXRpb24gYmV0d2VlbiBhIHByb2ZpbGUgYW5kIGFuIGVudGl0eVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNyZWF0ZUFzc29jaWF0aW9uKGlucHV0OiBDcmVhdGVBc3NvY2lhdGlvbklucHV0KTogUHJvbWlzZTxBc3NvY2lhdGlvbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgYXV0aGVudGljYXRlZCB1c2VyXG4gICAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9LCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKVxuICAgICAgaWYgKGF1dGhFcnJvciB8fCAhdXNlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJylcbiAgICAgIH1cblxuICAgICAgLy8gUHJlcGFyZSBhc3NvY2lhdGlvbiBkYXRhXG4gICAgICBjb25zdCBhc3NvY2lhdGlvbkRhdGEgPSB7XG4gICAgICAgIHNvdXJjZV9wcm9maWxlX2lkOiB1c2VyLmlkLFxuICAgICAgICB0YXJnZXRfZW50aXR5X2lkOiBpbnB1dC50YXJnZXRfZW50aXR5X2lkLFxuICAgICAgICB0YXJnZXRfZW50aXR5X3R5cGU6IGlucHV0LnRhcmdldF9lbnRpdHlfdHlwZSxcbiAgICAgICAgcmVsYXRpb25zaGlwX3R5cGU6IGlucHV0LnJlbGF0aW9uc2hpcF90eXBlLFxuICAgICAgICByb2xlOiBpbnB1dC5yb2xlLFxuICAgICAgICBiaXRjb2luX3Jld2FyZF9hZGRyZXNzOiBpbnB1dC5iaXRjb2luX3Jld2FyZF9hZGRyZXNzLFxuICAgICAgICByZXdhcmRfcGVyY2VudGFnZTogaW5wdXQucmV3YXJkX3BlcmNlbnRhZ2UgfHwgMCxcbiAgICAgICAgcGVybWlzc2lvbnM6IGlucHV0LnBlcm1pc3Npb25zIHx8IHt9LFxuICAgICAgICBtZXRhZGF0YTogaW5wdXQubWV0YWRhdGEgfHwge30sXG4gICAgICAgIHZpc2liaWxpdHk6IGlucHV0LnZpc2liaWxpdHkgfHwgJ3B1YmxpYycsXG4gICAgICAgIHN0YXJ0c19hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICB2ZXJzaW9uOiAxLFxuICAgICAgICBjcmVhdGVkX2J5OiB1c2VyLmlkLFxuICAgICAgICBsYXN0X21vZGlmaWVkX2J5OiB1c2VyLmlkXG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSBhc3NvY2lhdGlvblxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVfYXNzb2NpYXRpb25zJylcbiAgICAgICAgLmluc2VydChhc3NvY2lhdGlvbkRhdGEpXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuc2luZ2xlKClcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBhc3NvY2lhdGlvbicsIHsgZXJyb3IsIGlucHV0IH0pXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBhc3NvY2lhdGlvbjogJHtlcnJvci5tZXNzYWdlfWApXG4gICAgICB9XG5cbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgYXNzb2NpYXRpb246IE5vIGRhdGEgcmV0dXJuZWQnKVxuICAgICAgfVxuXG4gICAgICBsb2dnZXIuaW5mbygnQXNzb2NpYXRpb24gY3JlYXRlZCBzdWNjZXNzZnVsbHknLCB7IFxuICAgICAgICBhc3NvY2lhdGlvbklkOiBkYXRhLmlkLCBcbiAgICAgICAgcHJvZmlsZUlkOiB1c2VyLmlkIFxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGRhdGEgYXMgQXNzb2NpYXRpb25cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBjcmVhdGVBc3NvY2lhdGlvbicsIHsgZXJyb3IsIGlucHV0IH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgbXVsdGlwbGUgYXNzb2NpYXRpb25zIGluIGJ1bGtcbiAgICovXG4gIHN0YXRpYyBhc3luYyBjcmVhdGVCdWxrQXNzb2NpYXRpb25zKGlucHV0czogQ3JlYXRlQXNzb2NpYXRpb25JbnB1dFtdKTogUHJvbWlzZTxBc3NvY2lhdGlvbltdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBhdXRoZW50aWNhdGVkIHVzZXJcbiAgICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0sIGVycm9yOiBhdXRoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpXG4gICAgICBpZiAoYXV0aEVycm9yIHx8ICF1c2VyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXV0aGVudGljYXRpb24gcmVxdWlyZWQnKVxuICAgICAgfVxuXG4gICAgICAvLyBQcmVwYXJlIGFsbCBhc3NvY2lhdGlvbiBkYXRhXG4gICAgICBjb25zdCBhc3NvY2lhdGlvbnNEYXRhID0gaW5wdXRzLm1hcChpbnB1dCA9PiAoe1xuICAgICAgICBzb3VyY2VfcHJvZmlsZV9pZDogdXNlci5pZCxcbiAgICAgICAgdGFyZ2V0X2VudGl0eV9pZDogaW5wdXQudGFyZ2V0X2VudGl0eV9pZCxcbiAgICAgICAgdGFyZ2V0X2VudGl0eV90eXBlOiBpbnB1dC50YXJnZXRfZW50aXR5X3R5cGUsXG4gICAgICAgIHJlbGF0aW9uc2hpcF90eXBlOiBpbnB1dC5yZWxhdGlvbnNoaXBfdHlwZSxcbiAgICAgICAgcm9sZTogaW5wdXQucm9sZSxcbiAgICAgICAgYml0Y29pbl9yZXdhcmRfYWRkcmVzczogaW5wdXQuYml0Y29pbl9yZXdhcmRfYWRkcmVzcyxcbiAgICAgICAgcmV3YXJkX3BlcmNlbnRhZ2U6IGlucHV0LnJld2FyZF9wZXJjZW50YWdlIHx8IDAsXG4gICAgICAgIHBlcm1pc3Npb25zOiBpbnB1dC5wZXJtaXNzaW9ucyB8fCB7fSxcbiAgICAgICAgbWV0YWRhdGE6IGlucHV0Lm1ldGFkYXRhIHx8IHt9LFxuICAgICAgICB2aXNpYmlsaXR5OiBpbnB1dC52aXNpYmlsaXR5IHx8ICdwdWJsaWMnLFxuICAgICAgICBzdGFydHNfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdmVyc2lvbjogMSxcbiAgICAgICAgY3JlYXRlZF9ieTogdXNlci5pZCxcbiAgICAgICAgbGFzdF9tb2RpZmllZF9ieTogdXNlci5pZFxuICAgICAgfSkpXG5cbiAgICAgIC8vIENyZWF0ZSBhc3NvY2lhdGlvbnNcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlX2Fzc29jaWF0aW9ucycpXG4gICAgICAgIC5pbnNlcnQoYXNzb2NpYXRpb25zRGF0YSlcbiAgICAgICAgLnNlbGVjdCgpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgYnVsayBhc3NvY2lhdGlvbnMnLCB7IGVycm9yLCBpbnB1dHMgfSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gY3JlYXRlIGJ1bGsgYXNzb2NpYXRpb25zOiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgICAgIH1cblxuICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBidWxrIGFzc29jaWF0aW9uczogTm8gZGF0YSByZXR1cm5lZCcpXG4gICAgICB9XG5cbiAgICAgIGxvZ2dlci5pbmZvKCdCdWxrIGFzc29jaWF0aW9ucyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsIHsgXG4gICAgICAgIGNvdW50OiBkYXRhLmxlbmd0aCwgXG4gICAgICAgIHByb2ZpbGVJZDogdXNlci5pZCBcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBkYXRhIGFzIEFzc29jaWF0aW9uW11cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBjcmVhdGVCdWxrQXNzb2NpYXRpb25zJywgeyBlcnJvciwgaW5wdXRzIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g8J+TliBSRUFEIE9QRVJBVElPTlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBHZXQgYXNzb2NpYXRpb25zIGZvciBhIHNwZWNpZmljIHByb2ZpbGUgd2l0aCBmaWx0ZXJpbmcgYW5kIHBhZ2luYXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRQcm9maWxlQXNzb2NpYXRpb25zKFxuICAgIHByb2ZpbGVJZDogc3RyaW5nLFxuICAgIGZpbHRlcnM/OiBBc3NvY2lhdGlvbkZpbHRlcnMsXG4gICAgb3B0aW9ucz86IFF1ZXJ5T3B0aW9uc1xuICApOiBQcm9taXNlPEFzc29jaWF0aW9uW10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU3RhcnQgYnVpbGRpbmcgcXVlcnlcbiAgICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlX2Fzc29jaWF0aW9ucycpXG4gICAgICAgIC5zZWxlY3QodGhpcy5idWlsZFNlbGVjdENsYXVzZShvcHRpb25zKSlcbiAgICAgICAgLmVxKCdzb3VyY2VfcHJvZmlsZV9pZCcsIHByb2ZpbGVJZClcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgZmlsdGVyc1xuICAgICAgaWYgKGZpbHRlcnMpIHtcbiAgICAgICAgaWYgKGZpbHRlcnMucmVsYXRpb25zaGlwX3R5cGU/Lmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3JlbGF0aW9uc2hpcF90eXBlJywgZmlsdGVycy5yZWxhdGlvbnNoaXBfdHlwZSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVycy50YXJnZXRfZW50aXR5X3R5cGU/Lmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3RhcmdldF9lbnRpdHlfdHlwZScsIGZpbHRlcnMudGFyZ2V0X2VudGl0eV90eXBlKVxuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXJzLnN0YXR1cz8ubGVuZ3RoKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5pbignc3RhdHVzJywgZmlsdGVycy5zdGF0dXMpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMudmlzaWJpbGl0eT8ubGVuZ3RoKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5pbigndmlzaWJpbGl0eScsIGZpbHRlcnMudmlzaWJpbGl0eSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVycy5jcmVhdGVkX2FmdGVyKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS5ndGUoJ2NyZWF0ZWRfYXQnLCBmaWx0ZXJzLmNyZWF0ZWRfYWZ0ZXIpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMuY3JlYXRlZF9iZWZvcmUpIHtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5Lmx0ZSgnY3JlYXRlZF9hdCcsIGZpbHRlcnMuY3JlYXRlZF9iZWZvcmUpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMuaGFzX2JpdGNvaW5fcmV3YXJkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpZiAoZmlsdGVycy5oYXNfYml0Y29pbl9yZXdhcmQpIHtcbiAgICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkubm90KCdiaXRjb2luX3Jld2FyZF9hZGRyZXNzJywgJ2lzJywgbnVsbClcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcXVlcnkgPSBxdWVyeS5pcygnYml0Y29pbl9yZXdhcmRfYWRkcmVzcycsIG51bGwpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IG9yZGVyaW5nXG4gICAgICBjb25zdCBvcmRlckJ5ID0gb3B0aW9ucz8ub3JkZXJfYnkgfHwgJ2NyZWF0ZWRfYXQnXG4gICAgICBjb25zdCBhc2NlbmRpbmcgPSBvcHRpb25zPy5vcmRlcl9kaXJlY3Rpb24gPT09ICdhc2MnXG4gICAgICBxdWVyeSA9IHF1ZXJ5Lm9yZGVyKG9yZGVyQnksIHsgYXNjZW5kaW5nIH0pXG5cbiAgICAgIC8vIEFwcGx5IHBhZ2luYXRpb25cbiAgICAgIGlmIChvcHRpb25zPy5saW1pdCB8fCBvcHRpb25zPy5vZmZzZXQpIHtcbiAgICAgICAgY29uc3QgbGltaXQgPSBvcHRpb25zLmxpbWl0IHx8IDUwXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IG9wdGlvbnMub2Zmc2V0IHx8IDBcbiAgICAgICAgcXVlcnkgPSBxdWVyeS5yYW5nZShvZmZzZXQsIG9mZnNldCArIGxpbWl0IC0gMSlcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnlcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBwcm9maWxlIGFzc29jaWF0aW9ucycsIHsgZXJyb3IsIHByb2ZpbGVJZCB9KVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgcHJvZmlsZSBhc3NvY2lhdGlvbnM6ICR7ZXJyb3IubWVzc2FnZX1gKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gKGRhdGEgfHwgW10pIGFzIEFzc29jaWF0aW9uW11cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBnZXRQcm9maWxlQXNzb2NpYXRpb25zJywgeyBlcnJvciwgcHJvZmlsZUlkIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYXNzb2NpYXRpb25zIGZvciBhIHNwZWNpZmljIGVudGl0eVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldEVudGl0eUFzc29jaWF0aW9ucyhcbiAgICBlbnRpdHlJZDogc3RyaW5nLFxuICAgIGVudGl0eVR5cGU6IEFzc29jaWF0aW9uWyd0YXJnZXRfZW50aXR5X3R5cGUnXSxcbiAgICBmaWx0ZXJzPzogQXNzb2NpYXRpb25GaWx0ZXJzLFxuICAgIG9wdGlvbnM/OiBRdWVyeU9wdGlvbnNcbiAgKTogUHJvbWlzZTxBc3NvY2lhdGlvbltdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlX2Fzc29jaWF0aW9ucycpXG4gICAgICAgIC5zZWxlY3QodGhpcy5idWlsZFNlbGVjdENsYXVzZShvcHRpb25zKSlcbiAgICAgICAgLmVxKCd0YXJnZXRfZW50aXR5X2lkJywgZW50aXR5SWQpXG4gICAgICAgIC5lcSgndGFyZ2V0X2VudGl0eV90eXBlJywgZW50aXR5VHlwZSlcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgZmlsdGVycyAoc2FtZSBhcyBnZXRQcm9maWxlQXNzb2NpYXRpb25zKVxuICAgICAgaWYgKGZpbHRlcnMpIHtcbiAgICAgICAgaWYgKGZpbHRlcnMucmVsYXRpb25zaGlwX3R5cGU/Lmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3JlbGF0aW9uc2hpcF90eXBlJywgZmlsdGVycy5yZWxhdGlvbnNoaXBfdHlwZSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVycy5zdGF0dXM/Lmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIGZpbHRlcnMuc3RhdHVzKVxuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXJzLnZpc2liaWxpdHk/Lmxlbmd0aCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3Zpc2liaWxpdHknLCBmaWx0ZXJzLnZpc2liaWxpdHkpXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQXBwbHkgb3JkZXJpbmdcbiAgICAgIGNvbnN0IG9yZGVyQnkgPSBvcHRpb25zPy5vcmRlcl9ieSB8fCAnY3JlYXRlZF9hdCdcbiAgICAgIGNvbnN0IGFzY2VuZGluZyA9IG9wdGlvbnM/Lm9yZGVyX2RpcmVjdGlvbiA9PT0gJ2FzYydcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub3JkZXIob3JkZXJCeSwgeyBhc2NlbmRpbmcgfSlcblxuICAgICAgLy8gQXBwbHkgcGFnaW5hdGlvblxuICAgICAgaWYgKG9wdGlvbnM/LmxpbWl0IHx8IG9wdGlvbnM/Lm9mZnNldCkge1xuICAgICAgICBjb25zdCBsaW1pdCA9IG9wdGlvbnMubGltaXQgfHwgNTBcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gb3B0aW9ucy5vZmZzZXQgfHwgMFxuICAgICAgICBxdWVyeSA9IHF1ZXJ5LnJhbmdlKG9mZnNldCwgb2Zmc2V0ICsgbGltaXQgLSAxKVxuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGVudGl0eSBhc3NvY2lhdGlvbnMnLCB7IGVycm9yLCBlbnRpdHlJZCwgZW50aXR5VHlwZSB9KVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBnZXQgZW50aXR5IGFzc29jaWF0aW9uczogJHtlcnJvci5tZXNzYWdlfWApXG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoZGF0YSB8fCBbXSkgYXMgQXNzb2NpYXRpb25bXVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGluIGdldEVudGl0eUFzc29jaWF0aW9ucycsIHsgZXJyb3IsIGVudGl0eUlkIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g4pyP77iPIFVQREFURSBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogVXBkYXRlIGFuIGV4aXN0aW5nIGFzc29jaWF0aW9uXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgdXBkYXRlQXNzb2NpYXRpb24oXG4gICAgYXNzb2NpYXRpb25JZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IFVwZGF0ZUFzc29jaWF0aW9uSW5wdXRcbiAgKTogUHJvbWlzZTxBc3NvY2lhdGlvbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgICAuLi51cGRhdGVzLFxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHZlcnNpb246ICh1cGRhdGVzIGFzIGFueSkudmVyc2lvbiA/ICh1cGRhdGVzIGFzIGFueSkudmVyc2lvbiArIDEgOiB1bmRlZmluZWRcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3Byb2ZpbGVfYXNzb2NpYXRpb25zJylcbiAgICAgICAgLnVwZGF0ZSh1cGRhdGVEYXRhKVxuICAgICAgICAuZXEoJ2lkJywgYXNzb2NpYXRpb25JZClcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIGFzc29jaWF0aW9uJywgeyBlcnJvciwgYXNzb2NpYXRpb25JZCwgdXBkYXRlcyB9KVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgYXNzb2NpYXRpb246ICR7ZXJyb3IubWVzc2FnZX1gKVxuICAgICAgfVxuXG4gICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIGFzc29jaWF0aW9uOiBObyBkYXRhIHJldHVybmVkJylcbiAgICAgIH1cblxuICAgICAgbG9nZ2VyLmluZm8oJ0Fzc29jaWF0aW9uIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JywgeyBhc3NvY2lhdGlvbklkIH0pXG5cbiAgICAgIHJldHVybiBkYXRhIGFzIEFzc29jaWF0aW9uXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gdXBkYXRlQXNzb2NpYXRpb24nLCB7IGVycm9yLCBhc3NvY2lhdGlvbklkIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g4p2MIERFTEVURSBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAvKipcbiAgICogRGVsZXRlIGFuIGFzc29jaWF0aW9uXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZGVsZXRlQXNzb2NpYXRpb24oYXNzb2NpYXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlX2Fzc29jaWF0aW9ucycpXG4gICAgICAgIC5kZWxldGUoKVxuICAgICAgICAuZXEoJ2lkJywgYXNzb2NpYXRpb25JZClcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGRlbGV0ZSBhc3NvY2lhdGlvbicsIHsgZXJyb3IsIGFzc29jaWF0aW9uSWQgfSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZGVsZXRlIGFzc29jaWF0aW9uOiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgICAgIH1cblxuICAgICAgbG9nZ2VyLmluZm8oJ0Fzc29jaWF0aW9uIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JywgeyBhc3NvY2lhdGlvbklkIH0pXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gZGVsZXRlQXNzb2NpYXRpb24nLCB7IGVycm9yLCBhc3NvY2lhdGlvbklkIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8g8J+TiiBBTkFMWVRJQ1MgT1BFUkFUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEdldCBjb21wcmVoZW5zaXZlIGFzc29jaWF0aW9uIHN0YXRpc3RpY3MgZm9yIGEgcHJvZmlsZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldEFzc29jaWF0aW9uU3RhdHMocHJvZmlsZUlkOiBzdHJpbmcpOiBQcm9taXNlPEFzc29jaWF0aW9uU3RhdHM+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYXNzb2NpYXRpb25zID0gYXdhaXQgdGhpcy5nZXRQcm9maWxlQXNzb2NpYXRpb25zKHByb2ZpbGVJZClcblxuICAgICAgY29uc3Qgc3RhdHM6IEFzc29jaWF0aW9uU3RhdHMgPSB7XG4gICAgICAgIHRvdGFsX2Fzc29jaWF0aW9uczogYXNzb2NpYXRpb25zLmxlbmd0aCxcbiAgICAgICAgYnlfdHlwZToge30sXG4gICAgICAgIGJ5X2VudGl0eV90eXBlOiB7fSxcbiAgICAgICAgcmVjZW50X2FjdGl2aXR5OiBhc3NvY2lhdGlvbnMuc2xpY2UoMCwgMTApLFxuICAgICAgICBiaXRjb2luX2Nvbm5lY3Rpb25zOiAwLFxuICAgICAgICB0b3RhbF9yZXdhcmRfcGVyY2VudGFnZTogMFxuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgc3RhdGlzdGljc1xuICAgICAgYXNzb2NpYXRpb25zLmZvckVhY2goYXNzb2NpYXRpb24gPT4ge1xuICAgICAgICAvLyBDb3VudCBieSByZWxhdGlvbnNoaXAgdHlwZVxuICAgICAgICBzdGF0cy5ieV90eXBlW2Fzc29jaWF0aW9uLnJlbGF0aW9uc2hpcF90eXBlXSA9IFxuICAgICAgICAgIChzdGF0cy5ieV90eXBlW2Fzc29jaWF0aW9uLnJlbGF0aW9uc2hpcF90eXBlXSB8fCAwKSArIDFcblxuICAgICAgICAvLyBDb3VudCBieSBlbnRpdHkgdHlwZVxuICAgICAgICBzdGF0cy5ieV9lbnRpdHlfdHlwZVthc3NvY2lhdGlvbi50YXJnZXRfZW50aXR5X3R5cGVdID0gXG4gICAgICAgICAgKHN0YXRzLmJ5X2VudGl0eV90eXBlW2Fzc29jaWF0aW9uLnRhcmdldF9lbnRpdHlfdHlwZV0gfHwgMCkgKyAxXG5cbiAgICAgICAgLy8gQ291bnQgQml0Y29pbiBjb25uZWN0aW9uc1xuICAgICAgICBpZiAoYXNzb2NpYXRpb24uYml0Y29pbl9yZXdhcmRfYWRkcmVzcykge1xuICAgICAgICAgIHN0YXRzLmJpdGNvaW5fY29ubmVjdGlvbnMrK1xuICAgICAgICAgIHN0YXRzLnRvdGFsX3Jld2FyZF9wZXJjZW50YWdlICs9IGFzc29jaWF0aW9uLnJld2FyZF9wZXJjZW50YWdlXG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiBzdGF0c1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGluIGdldEFzc29jaWF0aW9uU3RhdHMnLCB7IGVycm9yLCBwcm9maWxlSWQgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyDwn5SnIFVUSUxJVFkgTUVUSE9EU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIEJ1aWxkIHNlbGVjdCBjbGF1c2UgYmFzZWQgb24gb3B0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYnVpbGRTZWxlY3RDbGF1c2Uob3B0aW9ucz86IFF1ZXJ5T3B0aW9ucyk6IHN0cmluZyB7XG4gICAgLy8gRGVmYXVsdCBzZWxlY3QgYWxsIGNvbHVtbnNcbiAgICByZXR1cm4gJyonXG4gIH1cblxuICAvKipcbiAgICogR2V0IGFzc29jaWF0aW9uIGJ5IElEXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0QXNzb2NpYXRpb25CeUlkKGFzc29jaWF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8QXNzb2NpYXRpb24gfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdwcm9maWxlX2Fzc29jaWF0aW9ucycpXG4gICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAuZXEoJ2lkJywgYXNzb2NpYXRpb25JZClcbiAgICAgICAgLnNpbmdsZSgpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2Jykge1xuICAgICAgICAgIHJldHVybiBudWxsIC8vIE5vdCBmb3VuZFxuICAgICAgICB9XG4gICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGdldCBhc3NvY2lhdGlvbiBieSBJRCcsIHsgZXJyb3IsIGFzc29jaWF0aW9uSWQgfSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0IGFzc29jaWF0aW9uOiAke2Vycm9yLm1lc3NhZ2V9YClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRhdGEgYXMgQXNzb2NpYXRpb25cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBnZXRBc3NvY2lhdGlvbkJ5SWQnLCB7IGVycm9yLCBhc3NvY2lhdGlvbklkIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhc3NvY2lhdGlvbiBleGlzdHNcbiAgICovXG4gIHN0YXRpYyBhc3luYyBhc3NvY2lhdGlvbkV4aXN0cyhcbiAgICBzb3VyY2VQcm9maWxlSWQ6IHN0cmluZyxcbiAgICB0YXJnZXRFbnRpdHlJZDogc3RyaW5nLFxuICAgIHJlbGF0aW9uc2hpcFR5cGU6IEFzc29jaWF0aW9uWydyZWxhdGlvbnNoaXBfdHlwZSddXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgncHJvZmlsZV9hc3NvY2lhdGlvbnMnKVxuICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgIC5lcSgnc291cmNlX3Byb2ZpbGVfaWQnLCBzb3VyY2VQcm9maWxlSWQpXG4gICAgICAgIC5lcSgndGFyZ2V0X2VudGl0eV9pZCcsIHRhcmdldEVudGl0eUlkKVxuICAgICAgICAuZXEoJ3JlbGF0aW9uc2hpcF90eXBlJywgcmVsYXRpb25zaGlwVHlwZSlcbiAgICAgICAgLmxpbWl0KDEpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBjaGVjayBhc3NvY2lhdGlvbiBleGlzdGVuY2UnLCB7IGVycm9yIH0pXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gKGRhdGE/Lmxlbmd0aCB8fCAwKSA+IDBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBhc3NvY2lhdGlvbkV4aXN0cycsIHsgZXJyb3IgfSlcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFzc29jaWF0aW9uU2VydmljZVxuZXhwb3J0IHR5cGUgeyBDcmVhdGVBc3NvY2lhdGlvbklucHV0LCBVcGRhdGVBc3NvY2lhdGlvbklucHV0LCBBc3NvY2lhdGlvbkZpbHRlcnMsIFF1ZXJ5T3B0aW9ucyB9Il0sInZlcnNpb24iOjN9